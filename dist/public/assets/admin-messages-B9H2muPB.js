import{c as S,a as D,r as W,h as A,j as e,B as M,C as r,q as l,t as n,b as d,v as b,aK as E,aL as P,aM as j,d as Q,a5 as L,O as F,Q as T}from"./index-B6B5-wqG.js";import{u as K}from"./useMutation-DUKQItlV.js";import{B as p}from"./badge-BCk9M62I.js";import{T as O,a as V,b as C,c as i,d as $,e as c}from"./table-Cr9KXtoW.js";import{S as x}from"./skeleton-QnbRUKoU.js";import{R as z}from"./refresh-cw-Rle-BtDm.js";import{M as f}from"./message-square-Dnn5Ptsj.js";import{M as k}from"./mail-jQLz4Ma3.js";import{C as U}from"./circle-check-vxY-lgNo.js";import{S as G}from"./send-BV-BHk2s.js";import{f as N}from"./format-CoLFXwEe.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=S("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=S("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);function X(t,o){if(o)return e.jsx(Y,{className:"h-4 w-4 text-blue-500"});switch(t){case"queued":return e.jsx(L,{className:"h-4 w-4 text-yellow-500"});case"sent":return e.jsx(G,{className:"h-4 w-4 text-orange-500"});case"delivered":return e.jsx(U,{className:"h-4 w-4 text-green-500"});case"failed":return e.jsx(Q,{className:"h-4 w-4 text-red-500"});default:return e.jsx(f,{className:"h-4 w-4 text-gray-500"})}}function Z(t,o){if(o)return e.jsx(p,{className:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100",children:"Read"});switch(t){case"queued":return e.jsx(p,{className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-100",children:"Queued"});case"sent":return e.jsx(p,{className:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-100",children:"Sent"});case"delivered":return e.jsx(p,{className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100",children:"Delivered"});case"failed":return e.jsx(p,{className:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-100",children:"Failed"});default:return e.jsx(p,{variant:"outline",children:t})}}function _(t){switch(t){case"whatsapp":return e.jsx(f,{className:"h-4 w-4 text-green-600"});case"email":return e.jsx(k,{className:"h-4 w-4 text-blue-600"});default:return e.jsx(f,{className:"h-4 w-4 text-gray-500"})}}function oe(){var y,v,w;const{toast:t}=D(),[o,q]=W.useState("all"),{data:s,isLoading:h,refetch:R}=A({queryKey:["/api/admin/messages/stats"]}),{data:m,isLoading:H,refetch:B}=A({queryKey:["/api/admin/messages"]}),g=K({mutationFn:a=>F("POST",`/api/admin/messages/${a}/retry`),onSuccess:()=>{t({title:"Retry Initiated",description:"Message has been queued for retry"}),T.invalidateQueries({queryKey:["/api/admin/messages"]}),T.invalidateQueries({queryKey:["/api/admin/messages/stats"]})},onError:a=>{t({title:"Retry Failed",description:a.message||"Failed to retry message",variant:"destructive"})}}),I=()=>{R(),B(),t({title:"Refreshed",description:"Message data has been refreshed"})},u=m==null?void 0:m.filter(a=>{switch(o){case"queued":return a.status==="queued";case"sent":return a.status==="sent";case"delivered":return a.status==="delivered";case"read":return a.readAt!==null;case"failed":return a.status==="failed";default:return!0}});return e.jsxs("div",{className:"container mx-auto p-6 max-w-7xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"WhatsApp Messages"}),e.jsx("p",{className:"text-muted-foreground",children:"Monitor message delivery status and manage failed messages"})]}),e.jsxs(M,{onClick:I,variant:"outline","data-testid":"button-refresh-messages",children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Refresh"]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-6 mb-6",children:[e.jsxs(r,{children:[e.jsx(l,{className:"pb-2",children:e.jsx(n,{className:"text-sm font-medium text-muted-foreground",children:"Total"})}),e.jsx(d,{children:h?e.jsx(x,{className:"h-8 w-16"}):e.jsx("div",{className:"text-2xl font-bold",children:(s==null?void 0:s.total)||0})})]}),e.jsxs(r,{children:[e.jsx(l,{className:"pb-2",children:e.jsx(n,{className:"text-sm font-medium text-yellow-600",children:"Queued"})}),e.jsx(d,{children:h?e.jsx(x,{className:"h-8 w-16"}):e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:(s==null?void 0:s.queued)||0})})]}),e.jsxs(r,{children:[e.jsx(l,{className:"pb-2",children:e.jsx(n,{className:"text-sm font-medium text-orange-600",children:"Sent"})}),e.jsx(d,{children:h?e.jsx(x,{className:"h-8 w-16"}):e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:(s==null?void 0:s.sent)||0})})]}),e.jsxs(r,{children:[e.jsx(l,{className:"pb-2",children:e.jsx(n,{className:"text-sm font-medium text-green-600",children:"Delivered"})}),e.jsx(d,{children:h?e.jsx(x,{className:"h-8 w-16"}):e.jsx("div",{className:"text-2xl font-bold text-green-600",children:(s==null?void 0:s.delivered)||0})})]}),e.jsxs(r,{children:[e.jsx(l,{className:"pb-2",children:e.jsx(n,{className:"text-sm font-medium text-blue-600",children:"Read"})}),e.jsx(d,{children:h?e.jsx(x,{className:"h-8 w-16"}):e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:(s==null?void 0:s.read)||0})})]}),e.jsxs(r,{children:[e.jsx(l,{className:"pb-2",children:e.jsx(n,{className:"text-sm font-medium text-red-600",children:"Failed"})}),e.jsx(d,{children:h?e.jsx(x,{className:"h-8 w-16"}):e.jsx("div",{className:"text-2xl font-bold text-red-600",children:(s==null?void 0:s.failed)||0})})]})]}),e.jsxs(r,{className:"mb-6",children:[e.jsxs(l,{children:[e.jsx(n,{children:"Messages by Type"}),e.jsx(b,{children:"Distribution of messages across different channels"})]}),e.jsx(d,{children:e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"font-medium",children:"WhatsApp:"}),e.jsx("span",{className:"text-muted-foreground",children:((y=s==null?void 0:s.byType)==null?void 0:y.whatsapp)||0})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"font-medium",children:"Email:"}),e.jsx("span",{className:"text-muted-foreground",children:((v=s==null?void 0:s.byType)==null?void 0:v.email)||0})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"h-5 w-5 text-purple-600"}),e.jsx("span",{className:"font-medium",children:"LINE:"}),e.jsx("span",{className:"text-muted-foreground",children:((w=s==null?void 0:s.byType)==null?void 0:w.line)||0})]})]})})]}),e.jsxs(r,{children:[e.jsxs(l,{children:[e.jsx(n,{children:"Message History"}),e.jsx(b,{children:"View and manage all broadcast messages"})]}),e.jsxs(d,{children:[e.jsx(E,{value:o,onValueChange:q,className:"mb-4",children:e.jsxs(P,{children:[e.jsxs(j,{value:"all","data-testid":"tab-all",children:["All (",(m==null?void 0:m.length)||0,")"]}),e.jsxs(j,{value:"queued","data-testid":"tab-queued",children:["Queued (",(s==null?void 0:s.queued)||0,")"]}),e.jsxs(j,{value:"sent","data-testid":"tab-sent",children:["Sent (",(s==null?void 0:s.sent)||0,")"]}),e.jsxs(j,{value:"delivered","data-testid":"tab-delivered",children:["Delivered (",(s==null?void 0:s.delivered)||0,")"]}),e.jsxs(j,{value:"read","data-testid":"tab-read",children:["Read (",(s==null?void 0:s.read)||0,")"]}),e.jsxs(j,{value:"failed","data-testid":"tab-failed",children:["Failed (",(s==null?void 0:s.failed)||0,")"]})]})}),H?e.jsx("div",{className:"space-y-2",children:[1,2,3,4,5].map(a=>e.jsx(x,{className:"h-16 w-full"},a))}):(u==null?void 0:u.length)===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No messages found in this category"}):e.jsx("div",{className:"rounded-md border",children:e.jsxs(O,{children:[e.jsx(V,{children:e.jsxs(C,{children:[e.jsx(i,{className:"w-12",children:"Type"}),e.jsx(i,{children:"Hospital"}),e.jsx(i,{children:"Recipient"}),e.jsx(i,{children:"Pet"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Timestamps"}),e.jsx(i,{className:"w-24",children:"Actions"})]})}),e.jsx($,{children:u==null?void 0:u.map(a=>e.jsxs(C,{"data-testid":`row-message-${a.id}`,children:[e.jsx(c,{children:_(a.messageType)}),e.jsx(c,{className:"font-medium",children:a.hospitalName}),e.jsx(c,{className:"font-mono text-sm",children:a.recipient}),e.jsx(c,{children:a.petInfo?e.jsxs("span",{className:"text-sm",children:[a.petInfo.name," (",a.petInfo.species,")"]}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"-"})}),e.jsx(c,{children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[X(a.status,a.readAt),Z(a.status,a.readAt)]}),a.errorMessage&&e.jsx("span",{className:"text-xs text-red-500 max-w-xs truncate",title:a.errorMessage,children:a.errorMessage})]})}),e.jsx(c,{children:e.jsxs("div",{className:"flex flex-col text-xs text-muted-foreground gap-0.5",children:[e.jsxs("span",{children:["Created: ",N(new Date(a.createdAt),"MMM d, HH:mm")]}),a.sentAt&&e.jsxs("span",{children:["Sent: ",N(new Date(a.sentAt),"HH:mm:ss")]}),a.deliveredAt&&e.jsxs("span",{children:["Delivered: ",N(new Date(a.deliveredAt),"HH:mm:ss")]}),a.readAt&&e.jsxs("span",{className:"text-blue-600",children:["Read: ",N(new Date(a.readAt),"HH:mm:ss")]})]})}),e.jsx(c,{children:a.status==="failed"&&e.jsxs(M,{size:"sm",variant:"outline",onClick:()=>g.mutate(a.id),disabled:g.isPending,"data-testid":`button-retry-${a.id}`,children:[e.jsx(J,{className:"h-3 w-3 mr-1"}),"Retry"]})})]},a.id))})]})})]})]}),e.jsxs(r,{className:"mt-6",children:[e.jsxs(l,{children:[e.jsx(n,{children:"Manual Engagement with WhatsApp Coexistence"}),e.jsx(b,{children:"Use the same WhatsApp number for automated broadcasts and manual follow-ups"})]}),e.jsxs(d,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"WhatsApp Coexistence (launched 2024) allows you to use the WhatsApp Business App on your phone simultaneously with the API automation. This means you can:"}),e.jsxs("ul",{className:"list-disc list-inside text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:"Receive reply messages from hospitals in your phone's WhatsApp Business App"}),e.jsx("li",{children:"Manually respond to hospital inquiries and coordinate care"}),e.jsx("li",{children:"Continue automated emergency broadcasts via the API"}),e.jsx("li",{children:"View full conversation history on your phone"})]}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Setup Steps:"}),e.jsxs("ol",{className:"list-decimal list-inside text-sm space-y-1",children:[e.jsx("li",{children:"Open Meta Business Suite → WhatsApp Manager"}),e.jsx("li",{children:"Go to Phone Numbers → Your business number"}),e.jsx("li",{children:'Enable "Use WhatsApp Business app" toggle'}),e.jsx("li",{children:"Scan QR code with WhatsApp Business App on your phone"}),e.jsx("li",{children:"Messages sent via API will appear in your app; you can reply manually"})]})]})]})]})]})}export{oe as default};
