import{a2 as q,h as o,j as e,a3 as g,B as h,C as a,q as i,t as l,b as r,v as C,d as I,a5 as M}from"./index-B6B5-wqG.js";import{B as x}from"./badge-BCk9M62I.js";import{S}from"./skeleton-QnbRUKoU.js";import{A}from"./arrow-left-BpE3PuIj.js";import{R as j}from"./refresh-cw-Rle-BtDm.js";import{C as R}from"./circle-x-CX15qlya.js";import{C as B}from"./circle-check-big-CQAn4pXr.js";import{M as L}from"./message-circle-Bdx785iQ.js";import{M as T}from"./mail-jQLz4Ma3.js";function P(){const[,t]=q("/emergency-results/:requestId/messages"),{data:u,isLoading:y}=o({queryKey:["/api/emergency-requests",t==null?void 0:t.requestId],enabled:!!(t!=null&&t.requestId)}),{data:d=[],isLoading:N,refetch:f}=o({queryKey:["/api/emergency-requests",t==null?void 0:t.requestId,"messages"],enabled:!!(t!=null&&t.requestId),refetchInterval:5e3}),{data:p=[]}=o({queryKey:["/api/clinics"]}),b=s=>{const c=p.find(w=>w.id===s);return(c==null?void 0:c.name)||"Unknown Clinic"},k=s=>{switch(s){case"sent":case"delivered":return e.jsxs(x,{className:"bg-green-600","data-testid":`badge-status-${s}`,children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),s==="delivered"?"Delivered":"Sent"]});case"queued":return e.jsxs(x,{className:"bg-blue-600","data-testid":"badge-status-queued",children:[e.jsx(M,{className:"h-3 w-3 mr-1"}),"Queued"]});case"failed":return e.jsxs(x,{variant:"destructive","data-testid":"badge-status-failed",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),"Failed"]});default:return e.jsxs(x,{variant:"outline","data-testid":"badge-status-unknown",children:[e.jsx(I,{className:"h-3 w-3 mr-1"}),s]})}},v=s=>s==="whatsapp"?e.jsx(L,{className:"h-4 w-4 text-green-600"}):e.jsx(T,{className:"h-4 w-4 text-blue-600"}),m=s=>s?new Date(s).toLocaleString():"N/A",n={total:d.length,sent:d.filter(s=>s.status==="sent"||s.status==="delivered").length,queued:d.filter(s=>s.status==="queued").length,failed:d.filter(s=>s.status==="failed").length};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-white to-gray-50 dark:from-gray-900 dark:to-gray-800",children:[e.jsx("header",{className:"border-b border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 sticky top-0 z-10",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{href:`/emergency-results/${t==null?void 0:t.requestId}`,children:e.jsx(h,{variant:"ghost",size:"icon","data-testid":"button-back",children:e.jsx(A,{className:"h-5 w-5"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Broadcast Status"}),u&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Emergency Request: ",u.symptom.substring(0,50),"..."]})]}),e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>f(),"data-testid":"button-refresh",children:[e.jsx(j,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})})}),e.jsxs("main",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs(a,{children:[e.jsx(i,{className:"pb-3",children:e.jsx(l,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Total Sent"})}),e.jsx(r,{children:e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white","data-testid":"text-total",children:n.total})})]}),e.jsxs(a,{children:[e.jsx(i,{className:"pb-3",children:e.jsx(l,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Successfully Sent"})}),e.jsx(r,{children:e.jsx("p",{className:"text-3xl font-bold text-green-600","data-testid":"text-sent",children:n.sent})})]}),e.jsxs(a,{children:[e.jsx(i,{className:"pb-3",children:e.jsx(l,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Queued"})}),e.jsx(r,{children:e.jsx("p",{className:"text-3xl font-bold text-blue-600","data-testid":"text-queued",children:n.queued})})]}),e.jsxs(a,{children:[e.jsx(i,{className:"pb-3",children:e.jsx(l,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Failed"})}),e.jsx(r,{children:e.jsx("p",{className:"text-3xl font-bold text-red-600","data-testid":"text-failed",children:n.failed})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Message Details"}),N||y?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(s=>e.jsx(a,{children:e.jsx(r,{className:"p-6",children:e.jsx(S,{className:"h-24 w-full"})})},s))}):d.length===0?e.jsx(a,{children:e.jsxs(r,{className:"p-8 text-center",children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No broadcast messages found for this emergency request."}),e.jsx(g,{href:`/emergency-results/${t==null?void 0:t.requestId}`,children:e.jsx(h,{className:"mt-4","data-testid":"button-go-back",children:"Go Back to Results"})})]})}):d.map(s=>e.jsxs(a,{className:"hover:shadow-md transition-shadow","data-testid":`card-message-${s.id}`,children:[e.jsx(i,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(l,{className:"text-lg flex items-center gap-2",children:[v(s.messageType),b(s.clinicId)]}),e.jsxs(C,{className:"mt-1",children:["To: ",s.recipient]})]}),k(s.status)]})}),e.jsx(r,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600 dark:text-gray-400",children:"Created:"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:m(s.createdAt)})]}),s.sentAt&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600 dark:text-gray-400",children:"Sent:"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:m(s.sentAt)})]}),s.failedAt&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600 dark:text-gray-400",children:"Failed:"}),e.jsx("p",{className:"text-red-600",children:m(s.failedAt)})]})]}),s.retryCount>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(j,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["Retry attempts: ",e.jsx("span",{className:"font-medium",children:s.retryCount})]})]}),s.errorMessage&&e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-950 rounded-lg",children:e.jsxs("p",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:["Error: ",s.errorMessage]})}),e.jsxs("details",{className:"mt-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:"View Message Content"}),e.jsx("div",{className:"mt-2 p-3 bg-gray-100 dark:bg-gray-800 rounded-lg",children:e.jsx("pre",{className:"text-xs text-gray-900 dark:text-gray-100 whitespace-pre-wrap font-sans",children:s.content})})]})]})})]},s.id))]})]})]})}export{P as default};
