import{a as R,Y as z,r as w,h as S,g as k,j as e,C as m,b as j,q as g,t as f,v as B,F,w as n,x as i,y as t,z as o,I as h,A as l,B as C,_ as K,a0 as $,a1 as Q,a2 as D,a3 as G,a4 as J,a5 as U,X as W,o as T,s as d,aB as X,a7 as H,G as Y,H as I}from"./index-DSfXJrMH.js";import{u as V}from"./useMutation-Cr219pYB.js";import{T as q}from"./textarea-BoweR-O6.js";import{S as _}from"./switch-Cwa_8bCq.js";import{f as ee}from"./dateFormat-B3M36iqg.js";import{L as A}from"./loader-circle-DJFh7Kw2.js";import{L as se}from"./lock-D_FqPpCa.js";import{A as ae}from"./arrow-left-B5_XZNND.js";const re=T({verificationCode:d().length(6,"Verification code must be 6 digits").regex(/^\d+$/,"Must be 6 digits")}),ne=T({nameEn:d().min(1,"Hospital name (English) is required"),nameZh:d().min(1,"Hospital name (Chinese) is required"),addressEn:d().min(1,"Address (English) is required"),addressZh:d().min(1,"Address (Chinese) is required"),phone:d().optional(),whatsapp:d().optional(),email:d().optional(),regionId:d().min(1,"Region is required"),open247:X().default(!0)});function me(){const{toast:p}=R(),[L,y]=z("/hospital/edit/:slug"),[Z,P]=w.useState(!1),[M,E]=w.useState(!1),x=y==null?void 0:y.slug,{data:a,isLoading:O}=S({queryKey:["/api/hospitals",x],queryFn:async()=>{if(!x)return null;const s=await fetch(`/api/hospitals/slug/${x}`);return s.ok?s.json():null},enabled:!!x}),{data:v}=S({queryKey:["/api/regions"]}),u=k({resolver:H(re),defaultValues:{verificationCode:""}}),r=k({resolver:H(ne),defaultValues:{nameEn:"",nameZh:"",addressEn:"",addressZh:"",phone:"",whatsapp:"",email:"",regionId:"",open247:!0}});w.useEffect(()=>{a&&r.reset({nameEn:a.nameEn||"",nameZh:a.nameZh||"",addressEn:a.addressEn||"",addressZh:a.addressZh||"",phone:a.phone||"",whatsapp:a.whatsapp||"",email:a.email||"",regionId:a.regionId||"",open247:a.open247||!0})},[a]);const N=V({mutationFn:async s=>{if(!(a!=null&&a.id))throw new Error("Hospital not found");const c=await fetch(`/api/hospitals/${a.id}/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({verificationCode:s.verificationCode})});if(!c.ok)throw new Error("Invalid verification code");return c.json()},onSuccess:()=>{P(!0),p({title:"Verified successfully!"})},onError:()=>{p({title:"Invalid verification code",variant:"destructive"})}}),b=V({mutationFn:async s=>{if(!(a!=null&&a.id))throw new Error("Hospital not found");const c=u.getValues("verificationCode");return Y("PATCH",`/api/hospitals/${a.id}/update-owner`,{...s,verificationCode:c})},onSuccess:()=>{E(!0),p({title:"Hospital information saved successfully!"}),I.invalidateQueries({queryKey:["/api/hospitals",x]}),I.invalidateQueries({queryKey:["/api/hospitals"]}),setTimeout(()=>E(!1),3e3)},onError:s=>{p({title:"Error saving hospital",description:s.message,variant:"destructive"})}});return L?O?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsx(A,{className:"h-8 w-8 animate-spin"})}):a?Z?e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"container mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(K,{href:"/",children:e.jsx(C,{variant:"ghost",size:"icon",children:e.jsx(ae,{className:"h-5 w-5"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Edit Hospital Information"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Update your hospital details"})]})]}),(a==null?void 0:a.updatedAt)&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx($,{className:"h-4 w-4"}),"Last updated: ",ee(a.updatedAt)]})]})}),e.jsx("div",{className:"container mx-auto px-4 py-6 max-w-2xl",children:e.jsx(F,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(s=>b.mutate(s)),className:"space-y-6",children:[e.jsxs(m,{children:[e.jsx(g,{children:e.jsx(f,{children:"Basic Information"})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(n,{control:r.control,name:"nameEn",render:({field:s})=>e.jsxs(i,{children:[e.jsx(t,{children:"Hospital Name (English) *"}),e.jsx(o,{children:e.jsx(h,{...s})}),e.jsx(l,{})]})}),e.jsx(n,{control:r.control,name:"nameZh",render:({field:s})=>e.jsxs(i,{children:[e.jsx(t,{children:"Hospital Name (Chinese) *"}),e.jsx(o,{children:e.jsx(h,{...s})}),e.jsx(l,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(n,{control:r.control,name:"addressEn",render:({field:s})=>e.jsxs(i,{children:[e.jsx(t,{children:"Address (English) *"}),e.jsx(o,{children:e.jsx(q,{...s,rows:2})}),e.jsx(l,{})]})}),e.jsx(n,{control:r.control,name:"addressZh",render:({field:s})=>e.jsxs(i,{children:[e.jsx(t,{children:"Address (Chinese) *"}),e.jsx(o,{children:e.jsx(q,{...s,rows:2})}),e.jsx(l,{})]})})]}),e.jsx(n,{control:r.control,name:"regionId",render:({field:s})=>e.jsxs(i,{children:[e.jsx(t,{children:"Region *"}),e.jsxs(Q,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(o,{children:e.jsx(D,{children:e.jsx(G,{})})}),e.jsx(J,{children:v==null?void 0:v.map(c=>e.jsx(U,{value:c.id,children:c.nameEn},c.id))})]}),e.jsx(l,{})]})})]})]}),e.jsxs(m,{children:[e.jsx(g,{children:e.jsx(f,{children:"Contact Information"})}),e.jsx(j,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(n,{control:r.control,name:"phone",render:({field:s})=>e.jsxs(i,{children:[e.jsx(t,{children:"Phone"}),e.jsx(o,{children:e.jsx(h,{...s,value:s.value||""})}),e.jsx(l,{})]})}),e.jsx(n,{control:r.control,name:"whatsapp",render:({field:s})=>e.jsxs(i,{children:[e.jsx(t,{children:"WhatsApp"}),e.jsx(o,{children:e.jsx(h,{...s,value:s.value||""})}),e.jsx(l,{})]})}),e.jsx(n,{control:r.control,name:"email",render:({field:s})=>e.jsxs(i,{children:[e.jsx(t,{children:"Email"}),e.jsx(o,{children:e.jsx(h,{...s,value:s.value||"",type:"email"})}),e.jsx(l,{})]})})]})})]}),e.jsxs(m,{children:[e.jsx(g,{children:e.jsx(f,{children:"Operations"})}),e.jsx(j,{children:e.jsx(n,{control:r.control,name:"open247",render:({field:s})=>e.jsxs(i,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsx("div",{className:"space-y-0.5",children:e.jsx(t,{className:"text-base",children:"24-Hour Operation"})}),e.jsx(o,{children:e.jsx(_,{checked:s.value||!0,onCheckedChange:s.onChange})})]})})})]}),e.jsx(C,{type:"submit",disabled:b.isPending,className:"w-full",size:"lg",children:b.isPending?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):M?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Saved!"]}):"Save Changes"})]})})})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:e.jsx("div",{className:"container mx-auto px-4 py-12 max-w-md",children:e.jsxs(m,{children:[e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5"}),"Verify Access"]}),e.jsx(B,{children:"Enter the 6-digit verification code to edit hospital information"})]}),e.jsx(j,{children:e.jsx(F,{...u,children:e.jsxs("form",{onSubmit:u.handleSubmit(s=>N.mutate(s)),className:"space-y-4",children:[e.jsx(n,{control:u.control,name:"verificationCode",render:({field:s})=>e.jsxs(i,{children:[e.jsx(t,{children:"Verification Code"}),e.jsx(o,{children:e.jsx(h,{...s,type:"text",placeholder:"000000",maxLength:6,className:"text-center text-2xl tracking-widest"})}),e.jsx(l,{})]})}),e.jsx(C,{type:"submit",className:"w-full",disabled:N.isPending,children:N.isPending?"Verifying...":"Verify"})]})})})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:e.jsx("div",{className:"container mx-auto px-4 py-12",children:e.jsx(m,{children:e.jsxs(j,{className:"py-12 text-center",children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Hospital not found"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Please check the hospital link and try again."})]})})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"Hospital not found"})})}export{me as default};
