import{r as y,h as P,j as e,a3 as r,B as t,ae as V,C as n,b as d,d as b,a5 as D,I as R,E as C,G as S,H as T,J as A,K as l,q as G,t as J,M as O,N as X,Q as _}from"./index-B6B5-wqG.js";import{T as $,a as W,b as E,c as h,d as Y,e as j}from"./table-Cr9KXtoW.js";import{B as f}from"./badge-BCk9M62I.js";import{S as Z}from"./skeleton-QnbRUKoU.js";import{A as q}from"./arrow-left-BpE3PuIj.js";import{R as ee}from"./refresh-cw-Rle-BtDm.js";import{U as se}from"./users-d7mTDrPY.js";import{H as ae}from"./heart-YQ3YutCQ.js";import{B as F}from"./building-2-BRlfl8Dq.js";import{S as te}from"./stethoscope-Br3VtJzY.js";import{M as le}from"./message-square-Dnn5Ptsj.js";import{T as re}from"./trending-up-Cm1JfJv6.js";import{S as ie}from"./settings-hQnBrW0F.js";import{C as U}from"./circle-check-vxY-lgNo.js";import{C as ne}from"./calendar-BCAUg3Hi.js";import{S as de}from"./search-DTxsAJDX.js";import{C as ce}from"./circle-x-CX15qlya.js";import{f as xe}from"./format-CoLFXwEe.js";function Le(){const[N,L]=y.useState(""),[v,z]=y.useState("all"),[w,H]=y.useState("all"),[c,B]=y.useState("all"),{data:a,isLoading:x}=P({queryKey:["/api/emergency-requests"],refetchInterval:1e4}),{data:o}=P({queryKey:["/api/regions"]}),m={total:(a==null?void 0:a.length)??0,pending:((a==null?void 0:a.filter(s=>s.status==="pending"))??[]).length,active:((a==null?void 0:a.filter(s=>s.status==="broadcasting"))??[]).length,completed:((a==null?void 0:a.filter(s=>s.status==="completed"))??[]).length,last24Hours:((a==null?void 0:a.filter(s=>{const i=new Date(s.createdAt);return new Date().getTime()-i.getTime()<24*60*60*1e3}))??[]).length},k=(a==null?void 0:a.filter(s=>{var i,g;if(N){const u=N.toLowerCase(),M=(i=s.symptom)==null?void 0:i.toLowerCase().includes(u),p=(g=s.manualLocation)==null?void 0:g.toLowerCase().includes(u);if(!M&&!p)return!1}if(v!=="all"&&s.status!==v||w!=="all"&&s.regionId!==w)return!1;if(c!=="all"){const u=new Date(s.createdAt),p=new Date().getTime()-u.getTime();if(c==="1h"&&p>60*60*1e3||c==="24h"&&p>24*60*60*1e3||c==="7d"&&p>7*24*60*60*1e3)return!1}return!0}))??[],I=()=>{_.invalidateQueries({queryKey:["/api/emergency-requests"]})},K=s=>{switch(s){case"pending":return e.jsxs(f,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",children:[e.jsx(D,{className:"h-3 w-3 mr-1"}),"Pending"]});case"broadcasting":return e.jsxs(f,{variant:"secondary",className:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",children:[e.jsx(b,{className:"h-3 w-3 mr-1"}),"Broadcasting"]});case"completed":return e.jsxs(f,{variant:"secondary",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[e.jsx(U,{className:"h-3 w-3 mr-1"}),"Completed"]});case"cancelled":return e.jsxs(f,{variant:"secondary",className:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200",children:[e.jsx(ce,{className:"h-3 w-3 mr-1"}),"Cancelled"]});default:return e.jsx(f,{variant:"outline",children:s})}},Q=s=>{if(!s)return"Unknown";const i=o==null?void 0:o.find(g=>g.id===s);return i?i.nameEn:s};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-white to-gray-50 dark:from-gray-900 dark:to-gray-800",children:[e.jsx("header",{className:"border-b border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 sticky top-0 z-10",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(r,{href:"/",children:e.jsx(t,{variant:"ghost",size:"icon","data-testid":"button-back",children:e.jsx(q,{className:"h-5 w-5"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Admin: Emergency Queue"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Monitor and manage active emergency requests"})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(t,{onClick:I,variant:"outline",size:"sm","data-testid":"button-refresh",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsx(r,{href:"/admin/users",children:e.jsxs(t,{variant:"outline",size:"sm","data-testid":"button-admin-users",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Users"]})}),e.jsx(r,{href:"/admin/pets",children:e.jsxs(t,{variant:"outline",size:"sm","data-testid":"button-admin-pets",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Pets"]})}),e.jsx(r,{href:"/admin/clinics",children:e.jsxs(t,{variant:"outline",size:"sm","data-testid":"button-admin-clinics",children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Clinics"]})}),e.jsx(r,{href:"/admin/hospitals",children:e.jsxs(t,{variant:"outline",size:"sm","data-testid":"button-admin-hospitals",children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Hospitals"]})}),e.jsx(r,{href:"/admin/diagnostics",children:e.jsxs(t,{variant:"outline",size:"sm","data-testid":"button-admin-diagnostics",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Diagnostics"]})}),e.jsx(r,{href:"/admin/notifications",children:e.jsxs(t,{variant:"outline",size:"sm","data-testid":"button-admin-notifications",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Notifications"]})}),e.jsx(r,{href:"/admin/messages",children:e.jsxs(t,{variant:"outline",size:"sm","data-testid":"button-admin-messages",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Messages"]})}),e.jsx(r,{href:"/admin/analytics",children:e.jsxs(t,{variant:"outline",size:"sm","data-testid":"button-admin-analytics",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Analytics"]})}),e.jsx(r,{href:"/admin/config",children:e.jsxs(t,{variant:"outline",size:"sm","data-testid":"button-admin-config",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Config"]})})]})]})})}),e.jsxs("main",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"max-w-7xl mx-auto mb-8",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(n,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900 rounded-lg",children:e.jsx(b,{className:"h-8 w-8 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Requests"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white","data-testid":"text-total-requests",children:x?"...":m.total})]})]})})}),e.jsx(n,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-yellow-100 dark:bg-yellow-900 rounded-lg",children:e.jsx(D,{className:"h-8 w-8 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Pending"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white","data-testid":"text-pending-requests",children:x?"...":m.pending})]})]})})}),e.jsx(n,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-red-100 dark:bg-red-900 rounded-lg",children:e.jsx(b,{className:"h-8 w-8 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Broadcasting"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white","data-testid":"text-active-requests",children:x?"...":m.active})]})]})})}),e.jsx(n,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900 rounded-lg",children:e.jsx(U,{className:"h-8 w-8 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Completed"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:x?"...":m.completed})]})]})})}),e.jsx(n,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-purple-100 dark:bg-purple-900 rounded-lg",children:e.jsx(ne,{className:"h-8 w-8 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Last 24h"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:x?"...":m.last24Hours})]})]})})})]})}),e.jsx("div",{className:"max-w-7xl mx-auto mb-6",children:e.jsx(n,{children:e.jsxs(d,{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(R,{placeholder:"Search symptoms, location...",value:N,onChange:s=>L(s.target.value),className:"pl-10","data-testid":"input-search"})]}),e.jsxs(C,{value:v,onValueChange:z,children:[e.jsx(S,{"data-testid":"select-status",children:e.jsx(T,{placeholder:"All Statuses"})}),e.jsxs(A,{children:[e.jsx(l,{value:"all",children:"All Statuses"}),e.jsx(l,{value:"pending",children:"Pending"}),e.jsx(l,{value:"broadcasting",children:"Broadcasting"}),e.jsx(l,{value:"completed",children:"Completed"}),e.jsx(l,{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs(C,{value:w,onValueChange:H,children:[e.jsx(S,{"data-testid":"select-region",children:e.jsx(T,{placeholder:"All Regions"})}),e.jsxs(A,{children:[e.jsx(l,{value:"all",children:"All Regions"}),o==null?void 0:o.map(s=>e.jsx(l,{value:s.id,children:s.nameEn},s.id))]})]}),e.jsxs(C,{value:c,onValueChange:B,children:[e.jsx(S,{"data-testid":"select-time",children:e.jsx(T,{placeholder:"All Time"})}),e.jsxs(A,{children:[e.jsx(l,{value:"all",children:"All Time"}),e.jsx(l,{value:"1h",children:"Last Hour"}),e.jsx(l,{value:"24h",children:"Last 24 Hours"}),e.jsx(l,{value:"7d",children:"Last 7 Days"})]})]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{children:["Showing ",k.length," of ",m.total," requests"]}),(N||v!=="all"||w!=="all"||c!=="all")&&e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>{L(""),z("all"),H("all"),B("all")},children:"Clear Filters"})]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs(n,{children:[e.jsx(G,{children:e.jsx(J,{children:"Emergency Requests"})}),e.jsx(d,{children:x?e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((s,i)=>e.jsx(Z,{className:"h-16 w-full"},i))}):k.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(b,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No emergency requests found"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs($,{children:[e.jsx(W,{children:e.jsxs(E,{children:[e.jsx(h,{children:"Created"}),e.jsx(h,{children:"Status"}),e.jsx(h,{children:"Symptom"}),e.jsx(h,{children:"Region"}),e.jsx(h,{children:"Location"}),e.jsx(h,{children:"Contact"})]})}),e.jsx(Y,{children:k.map(s=>e.jsxs(E,{"data-testid":`row-request-${s.id}`,children:[e.jsx(j,{className:"font-medium whitespace-nowrap",children:xe(new Date(s.createdAt),"MMM d, HH:mm")}),e.jsx(j,{children:K(s.status)}),e.jsx(j,{className:"max-w-xs truncate",children:s.symptom||"N/A"}),e.jsx(j,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{className:"h-3 w-3 text-gray-400"}),Q(s.regionId)]})}),e.jsx(j,{className:"max-w-xs truncate",children:s.manualLocation||"GPS Only"}),e.jsx(j,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(X,{className:"h-3 w-3 text-gray-400"}),s.contactPhone||"N/A"]})})]},s.id))})]})})})]})})]})]})}export{Le as default};
