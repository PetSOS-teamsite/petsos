import{a as Y,r as m,g as z,j as e,X as A,B as n,C as v,v as S,w as k,y as $,b as N,F as L,z as i,A as c,D as o,E as l,I as h,G as u,L as B,R as G,_ as K,H as U,a9 as D,o as Z,s as p,af as X,b5 as _,ah as V,T as H}from"./index-yGPiJpIr.js";import{u as P}from"./useMutation-g6oReyS0.js";import{S as J}from"./switch-BdZ2xI1R.js";import{A as Q}from"./arrow-left-BVTF3Tl5.js";import{B as ee}from"./building-2-Bk6ymILd.js";import{M as se}from"./mail-CLLlllUf.js";import{U as ae}from"./user-CcdmAbwc.js";const te={en:{title:"Hospital Update Portal",subtitle:"Verify and update your hospital information",accessCodeLabel:"Access Code",accessCodePlaceholder:"Enter your 8-character access code",accessCodeHelp:"Enter the access code provided to your hospital",verifyButton:"Verify Access Code",verifying:"Verifying...",invalidCode:"Invalid access code. Please check and try again.",hospitalInfo:"Hospital Information",currentInfo:"Current Information",editInfo:"Edit Information",nameEn:"Name (English)",nameZh:"Name (Chinese)",phone:"Phone Number",whatsapp:"WhatsApp",email:"Email",is24Hour:"24-Hour Service",is24HourDesc:"Hospital provides 24-hour emergency services",confirmedBy:"Your Name",confirmedByPlaceholder:"Enter your name",confirmedByHelp:"Name of the person confirming/updating this information",lastConfirmed:"Last Confirmed",neverConfirmed:"Never confirmed",confirmOnly:"Information is Correct",updateInfo:"Update Information",saving:"Saving...",successTitle:"Update Successful!",successMessage:"Your hospital information has been updated and confirmed.",confirmSuccessTitle:"Confirmation Successful!",confirmSuccessMessage:"Your hospital information has been confirmed as correct.",backToHome:"Back to Home",startOver:"Submit Another Update",updateError:"Failed to update information. Please try again."},zh:{title:"醫院資料更新",subtitle:"驗證並更新您的醫院資料",accessCodeLabel:"訪問碼",accessCodePlaceholder:"輸入您的8位訪問碼",accessCodeHelp:"輸入發送給您醫院的訪問碼",verifyButton:"驗證訪問碼",verifying:"驗證中...",invalidCode:"訪問碼無效，請檢查後重試。",hospitalInfo:"醫院資料",currentInfo:"現有資料",editInfo:"編輯資料",nameEn:"名稱（英文）",nameZh:"名稱（中文）",phone:"電話號碼",whatsapp:"WhatsApp",email:"電郵",is24Hour:"24小時服務",is24HourDesc:"醫院提供24小時急症服務",confirmedBy:"您的姓名",confirmedByPlaceholder:"輸入您的姓名",confirmedByHelp:"確認/更新此資料的人員姓名",lastConfirmed:"上次確認",neverConfirmed:"從未確認",confirmOnly:"資料正確無誤",updateInfo:"更新資料",saving:"儲存中...",successTitle:"更新成功！",successMessage:"您的醫院資料已更新並確認。",confirmSuccessTitle:"確認成功！",confirmSuccessMessage:"您的醫院資料已確認為正確。",backToHome:"返回首頁",startOver:"提交另一項更新",updateError:"無法更新資料，請重試。"}},ne=Z({accessCode:p().length(8,"Access code must be 8 characters")}),re=Z({phone:p().optional(),whatsapp:p().optional(),email:p().email().optional().or(X("")),open247:_(),confirmedByName:p().min(1,"Name is required")});function ue(){const{toast:C}=Y(),[x,E]=m.useState("en"),[b,f]=m.useState("verify"),[r,F]=m.useState(null),[I,T]=m.useState(""),[M,O]=m.useState(!1),s=te[x],d=z({resolver:V(ne),defaultValues:{accessCode:""}}),t=z({resolver:V(re),defaultValues:{phone:"",whatsapp:"",email:"",open247:!0,confirmedByName:""}}),w=P({mutationFn:async a=>(await H("POST","/api/hospitals/verify-code",a)).json(),onSuccess:a=>{F(a),T(d.getValues("accessCode").toUpperCase()),t.reset({phone:a.phone||"",whatsapp:a.whatsapp||"",email:a.email||"",open247:a.open247,confirmedByName:""}),f("edit")},onError:()=>{C({title:s.invalidCode,variant:"destructive"})}}),j=P({mutationFn:async a=>(await H("POST","/api/hospitals/update-by-code",{accessCode:I,...a})).json(),onSuccess:()=>{O(!1),f("success")},onError:()=>{C({title:s.updateError,variant:"destructive"})}}),g=P({mutationFn:async a=>(await H("POST","/api/hospitals/confirm-info",{accessCode:I,confirmedByName:a})).json(),onSuccess:()=>{O(!0),f("success")},onError:()=>{C({title:s.updateError,variant:"destructive"})}}),q=()=>{const a=t.getValues("confirmedByName");if(!a){t.setError("confirmedByName",{message:"Name is required"});return}g.mutate(a)},R=()=>{f("verify"),F(null),T(""),d.reset(),t.reset()},W=a=>a?new Date(a).toLocaleDateString(x==="zh"?"zh-HK":"en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):s.neverConfirmed;return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{href:"/",children:e.jsx(n,{variant:"ghost",size:"icon","data-testid":"button-back",children:e.jsx(Q,{className:"h-5 w-5"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-white",children:s.title}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.subtitle})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:x==="en"?"default":"outline",size:"sm",onClick:()=>E("en"),"data-testid":"button-language-en",children:"EN"}),e.jsx(n,{variant:x==="zh"?"default":"outline",size:"sm",onClick:()=>E("zh"),"data-testid":"button-language-zh",children:"中文"})]})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-lg",children:[b==="verify"&&e.jsxs(v,{children:[e.jsxs(S,{children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5"}),s.title]}),e.jsx($,{children:s.accessCodeHelp})]}),e.jsx(N,{children:e.jsx(L,{...d,children:e.jsxs("form",{onSubmit:d.handleSubmit(a=>w.mutate(a)),className:"space-y-4",children:[e.jsx(i,{control:d.control,name:"accessCode",render:({field:a})=>e.jsxs(c,{children:[e.jsx(o,{children:s.accessCodeLabel}),e.jsx(l,{children:e.jsx(h,{...a,placeholder:s.accessCodePlaceholder,maxLength:8,className:"text-center text-2xl tracking-widest uppercase",onChange:y=>a.onChange(y.target.value.toUpperCase()),"data-testid":"input-access-code"})}),e.jsx(u,{})]})}),e.jsx(n,{type:"submit",className:"w-full",disabled:w.isPending,"data-testid":"button-verify",children:w.isPending?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"mr-2 h-4 w-4 animate-spin"}),s.verifying]}):s.verifyButton})]})})})]}),b==="edit"&&r&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(v,{children:[e.jsx(S,{children:e.jsx(k,{children:s.currentInfo})}),e.jsxs(N,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:s.nameEn}),e.jsx("p",{className:"font-medium","data-testid":"text-hospital-name-en",children:r.nameEn})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:s.nameZh}),e.jsx("p",{className:"font-medium","data-testid":"text-hospital-name-zh",children:r.nameZh})]}),r.lastConfirmedAt&&e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx("p",{className:"text-sm text-gray-500",children:s.lastConfirmed}),e.jsxs("p",{className:"text-sm","data-testid":"text-last-confirmed",children:[W(r.lastConfirmedAt),r.confirmedByName&&` • ${r.confirmedByName}`]})]})]})]}),e.jsxs(v,{children:[e.jsx(S,{children:e.jsx(k,{children:s.editInfo})}),e.jsx(N,{children:e.jsx(L,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(a=>j.mutate(a)),className:"space-y-4",children:[e.jsx(i,{control:t.control,name:"phone",render:({field:a})=>e.jsxs(c,{children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),s.phone]}),e.jsx(l,{children:e.jsx(h,{...a,"data-testid":"input-phone"})}),e.jsx(u,{})]})}),e.jsx(i,{control:t.control,name:"whatsapp",render:({field:a})=>e.jsxs(c,{children:[e.jsx(o,{children:s.whatsapp}),e.jsx(l,{children:e.jsx(h,{...a,"data-testid":"input-whatsapp"})}),e.jsx(u,{})]})}),e.jsx(i,{control:t.control,name:"email",render:({field:a})=>e.jsxs(c,{children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4"}),s.email]}),e.jsx(l,{children:e.jsx(h,{...a,type:"email","data-testid":"input-email"})}),e.jsx(u,{})]})}),e.jsx(i,{control:t.control,name:"open247",render:({field:a})=>e.jsxs(c,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),s.is24Hour]}),e.jsx(U,{children:s.is24HourDesc})]}),e.jsx(l,{children:e.jsx(J,{checked:a.value,onCheckedChange:a.onChange,"data-testid":"switch-24hour"})})]})}),e.jsx(i,{control:t.control,name:"confirmedByName",render:({field:a})=>e.jsxs(c,{children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4"}),s.confirmedBy," *"]}),e.jsx(l,{children:e.jsx(h,{...a,placeholder:s.confirmedByPlaceholder,"data-testid":"input-confirmed-by"})}),e.jsx(U,{children:s.confirmedByHelp}),e.jsx(u,{})]})}),e.jsxs("div",{className:"flex flex-col gap-3 pt-4",children:[e.jsx(n,{type:"button",variant:"outline",className:"w-full",onClick:q,disabled:g.isPending||j.isPending,"data-testid":"button-confirm-only",children:g.isPending?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"mr-2 h-4 w-4 animate-spin"}),s.saving]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"mr-2 h-4 w-4"}),s.confirmOnly]})}),e.jsx(n,{type:"submit",className:"w-full",disabled:j.isPending||g.isPending,"data-testid":"button-update",children:j.isPending?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"mr-2 h-4 w-4 animate-spin"}),s.saving]}):s.updateInfo})]})]})})})]})]}),b==="success"&&e.jsx(v,{children:e.jsxs(N,{className:"py-12 text-center space-y-6",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center mx-auto",children:e.jsx(D,{className:"h-8 w-8 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white","data-testid":"text-success-title",children:M?s.confirmSuccessTitle:s.successTitle}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2","data-testid":"text-success-message",children:M?s.confirmSuccessMessage:s.successMessage})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(A,{href:"/",children:e.jsx(n,{className:"w-full","data-testid":"button-back-home",children:s.backToHome})}),e.jsx(n,{variant:"outline",onClick:R,"data-testid":"button-start-over",children:s.startOver})]})]})})]})]})}export{ue as default};
