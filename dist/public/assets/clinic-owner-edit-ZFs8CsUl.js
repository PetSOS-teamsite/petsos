import{a as T,T as Z,r as b,h as w,g as L,j as e,C as m,b as j,U as P,B as E,W as R,F as H,q as y,t as f,v as C,w as r,x as i,y as l,z as c,I as x,A as t,E as z,G as K,H as O,J as Q,K as V,a7 as B,o as M,s as d,aS as U,a3 as D,O as W,Q as $}from"./index-Dv-87GdI.js";import{u as G}from"./useMutation-DhbY-5L1.js";import{T as k}from"./textarea-CXxlry72.js";import{S as J}from"./switch-DNY1qyBa.js";import{f as X}from"./dateFormat-B3M36iqg.js";import{L as S}from"./loader-circle-B-JBmTN-.js";import{A as Y}from"./arrow-left-BiOU8dRi.js";const _=M({nameEn:d().min(1,"Clinic name (English) is required"),nameZh:d().min(1,"Clinic name (Chinese) is required"),addressEn:d().min(1,"Address (English) is required"),addressZh:d().min(1,"Address (Chinese) is required"),phone:d().min(1,"Phone is required"),whatsapp:d().optional(),email:d().optional(),regionId:d().min(1,"Region is required"),open247:U().default(!1)});function ce(){const{toast:v}=T(),[F,u]=Z("/clinic/edit/:slug"),[q,N]=b.useState(!1),o=u==null?void 0:u.slug,{data:a,isLoading:A}=w({queryKey:["/api/clinics",o],queryFn:async()=>{if(!o)return null;const s=await fetch(`/api/clinics?slug=${o}`);return s.ok&&(await s.json()).find(I=>I.slug===o)||null},enabled:!!o}),{data:p}=w({queryKey:["/api/regions"]}),n=L({resolver:D(_),defaultValues:{nameEn:"",nameZh:"",addressEn:"",addressZh:"",phone:"",whatsapp:"",email:"",regionId:"",open247:!1}});b.useEffect(()=>{a&&n.reset({nameEn:a.nameEn||"",nameZh:a.nameZh||"",addressEn:a.addressEn||"",addressZh:a.addressZh||"",phone:a.phone||"",whatsapp:a.whatsapp||"",email:a.email||"",regionId:a.regionId||"",open247:a.open247||!1})},[a]);const g=G({mutationFn:async s=>{if(!(a!=null&&a.id))throw new Error("Clinic not found");return W("PATCH",`/api/clinics/${a.id}`,s)},onSuccess:()=>{N(!0),v({title:"Clinic information saved successfully!"}),$.invalidateQueries({queryKey:["/api/clinics"]}),setTimeout(()=>N(!1),3e3)},onError:s=>{v({title:"Error saving clinic",description:s.message,variant:"destructive"})}});return F?A?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsx(S,{className:"h-8 w-8 animate-spin"})}):a?e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"container mx-auto px-4 py-4",children:[e.jsx("div",{className:"flex items-center justify-between gap-3 mb-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{href:"/",children:e.jsx(E,{variant:"ghost",size:"icon","data-testid":"button-back",children:e.jsx(Y,{className:"h-5 w-5"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Edit Clinic Information"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Update your clinic details"})]})]})}),(a==null?void 0:a.updatedAt)&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(R,{className:"h-4 w-4"}),"Last updated: ",X(a.updatedAt)]})]})}),e.jsx("div",{className:"container mx-auto px-4 py-6 max-w-2xl",children:e.jsx(H,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(s=>g.mutate(s)),className:"space-y-6",children:[e.jsxs(m,{children:[e.jsxs(y,{children:[e.jsx(f,{children:"Basic Information"}),e.jsx(C,{children:"Update your clinic name and address"})]}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(r,{control:n.control,name:"nameEn",render:({field:s})=>e.jsxs(i,{children:[e.jsx(l,{children:"Clinic Name (English) *"}),e.jsx(c,{children:e.jsx(x,{...s,placeholder:"Central Animal Clinic"})}),e.jsx(t,{})]})}),e.jsx(r,{control:n.control,name:"nameZh",render:({field:s})=>e.jsxs(i,{children:[e.jsx(l,{children:"Clinic Name (Chinese) *"}),e.jsx(c,{children:e.jsx(x,{...s,placeholder:"中環動物診所"})}),e.jsx(t,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(r,{control:n.control,name:"addressEn",render:({field:s})=>e.jsxs(i,{children:[e.jsx(l,{children:"Address (English) *"}),e.jsx(c,{children:e.jsx(k,{...s,placeholder:"123 Queen's Road Central",rows:2})}),e.jsx(t,{})]})}),e.jsx(r,{control:n.control,name:"addressZh",render:({field:s})=>e.jsxs(i,{children:[e.jsx(l,{children:"Address (Chinese) *"}),e.jsx(c,{children:e.jsx(k,{...s,placeholder:"皇后大道中123號",rows:2})}),e.jsx(t,{})]})})]}),e.jsx(r,{control:n.control,name:"regionId",render:({field:s})=>e.jsxs(i,{children:[e.jsx(l,{children:"Region *"}),e.jsxs(z,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(c,{children:e.jsx(K,{children:e.jsx(O,{placeholder:"Select region"})})}),e.jsx(Q,{children:p==null?void 0:p.map(h=>e.jsx(V,{value:h.id,children:h.nameEn},h.id))})]}),e.jsx(t,{})]})})]})]}),e.jsxs(m,{children:[e.jsxs(y,{children:[e.jsx(f,{children:"Contact Information"}),e.jsx(C,{children:"How customers can reach you"})]}),e.jsx(j,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(r,{control:n.control,name:"phone",render:({field:s})=>e.jsxs(i,{children:[e.jsx(l,{children:"Phone *"}),e.jsx(c,{children:e.jsx(x,{...s,placeholder:"+852 1234 5678"})}),e.jsx(t,{})]})}),e.jsx(r,{control:n.control,name:"whatsapp",render:({field:s})=>e.jsxs(i,{children:[e.jsx(l,{children:"WhatsApp"}),e.jsx(c,{children:e.jsx(x,{...s,value:s.value||"",placeholder:"+852 1234 5678"})}),e.jsx(t,{})]})}),e.jsx(r,{control:n.control,name:"email",render:({field:s})=>e.jsxs(i,{children:[e.jsx(l,{children:"Email"}),e.jsx(c,{children:e.jsx(x,{...s,value:s.value||"",placeholder:"info@clinic.com",type:"email"})}),e.jsx(t,{})]})})]})})]}),e.jsxs(m,{children:[e.jsxs(y,{children:[e.jsx(f,{children:"Operations"}),e.jsx(C,{children:"Set your operating hours"})]}),e.jsx(j,{children:e.jsx(r,{control:n.control,name:"open247",render:({field:s})=>e.jsxs(i,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(l,{className:"text-base",children:"24-Hour Operation"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Enable if your clinic operates 24/7"})]}),e.jsx(c,{children:e.jsx(J,{checked:s.value||!1,onCheckedChange:s.onChange})})]})})})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(E,{type:"submit",disabled:g.isPending,className:"flex-1",size:"lg",children:g.isPending?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):q?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Saved!"]}):"Save Changes"})})]})})})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:e.jsx("div",{className:"container mx-auto px-4 py-12",children:e.jsx(m,{children:e.jsxs(j,{className:"py-12 text-center",children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Clinic not found"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Please check the clinic link and try again."})]})})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"Clinic not found"})})}export{ce as default};
