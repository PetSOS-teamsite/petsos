import{c as we,u as Ve,W as Ue,r as u,a as Ye,h as ie,j as e,S as Ze,X as Ne,B as b,C as _,v as le,d as Qe,w as ne,b as k,L as O,I as B,Y as N,_ as ye,J as L,K as I,N as K,O as W,P as x,M as Xe,R as Je,$ as qe,a0 as Re,a1 as et,a2 as tt,a3 as st,a4 as at,V as G,T as re,U as ce}from"./index-yGPiJpIr.js";import{u as de}from"./useMutation-g6oReyS0.js";import{B as S}from"./badge-4zSkoC7y.js";import{S as oe}from"./switch-BdZ2xI1R.js";import{C as it}from"./checkbox-ZqlGbjLG.js";import{A as lt,a as nt,b as rt,c as ct,d as dt,e as ot,f as ht,g as ut}from"./alert-dialog-CbtaLizn.js";import{S as he}from"./send-C40fC5Tu.js";import{F as xt}from"./filter-DaTYLTkf.js";import{S as mt}from"./search-DPDD1EGd.js";import{M as ve}from"./message-circle-DqTg9Vop.js";import{N as _e}from"./navigation-Dxq60WD7.js";import{C as pt}from"./circle-check-D4zmYIzY.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=we("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=we("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);function ft(s){if(!s)return"";const a=s.replace(/\D/g,"");if(!a)return s;if(a.startsWith("852")&&a.length===11)return`+852 ${a.slice(3,7)} ${a.slice(7)}`;if(a.length===8&&!a.startsWith("0"))return`+852 ${a.slice(0,4)} ${a.slice(4)}`;if(a.startsWith("86")&&a.length===13)return`+86 ${a.slice(2,5)} ${a.slice(5,9)} ${a.slice(9)}`;if(a.startsWith("1")&&a.length===11)return`+1 ${a.slice(1,4)} ${a.slice(4,7)} ${a.slice(7)}`;if(a.startsWith("44")&&a.length>=12)return`+44 ${a.slice(2,6)} ${a.slice(6)}`;if(a.length>10){const n=a.slice(0,a.length-10),i=a.slice(a.length-10);return`+${n} ${i.slice(0,3)} ${i.slice(3,6)} ${i.slice(6)}`}return a.length>=10?`+${a}`:s}const jt=(s,a,n)=>{switch(s){case"normal":return{label:n==="zh-HK"?"æ­£å¸¸æœå‹™":"Available",className:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400 border-green-300",icon:"âœ“"};case"busy":return{label:n==="zh-HK"?"ç¹å¿™":"Busy",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400 border-yellow-300",icon:"â³"};case"critical_only":return{label:n==="zh-HK"?"åªæ”¶ç·Šæ€¥":"Critical Only",className:"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400 border-orange-300",icon:"âš ï¸"};case"full":return{label:n==="zh-HK"?"å·²æ»¿":"Full",className:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400 border-red-300",icon:"ğŸš«"};case null:default:return{label:n==="zh-HK"?"æœªçŸ¥":"Unknown",className:"bg-gray-100 text-gray-600 dark:bg-gray-800/30 dark:text-gray-400 border-gray-300",icon:"?"}}};function ue(s,a,n){var f;if(!s)return a("clinic_results.emergency_care_needed","Emergency pet care needed");const i=[];if(i.push(`ğŸš¨ ${a("clinic_results.broadcast_alert_title","PET EMERGENCY ALERT")} ğŸš¨`),i.push(""),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`ğŸ“‹ ${a("clinic_results.pet_info_section","PET INFORMATION")}`),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),s.pet){const o=s.pet;o.name&&i.push(`${a("clinic_results.name","Name")}: ${o.name}`);let j=s.petSpecies||"";s.petBreed&&(j+=`, ${s.petBreed}`),s.petAge&&(j+=`, ${s.petAge} ${a("common.years","years")}`),o.weight&&(j+=`, ${o.weight}${a("clinic_results.weight_kg","kg")}`),j&&i.push(`${a("clinic_results.details","Details")}: ${j}`),o.medicalNotes&&o.medicalNotes.trim()&&i.push(`âš ï¸ ${a("clinic_results.medical_history","Medical History")}: ${o.medicalNotes}`)}else{let o=s.petSpecies||"";s.petBreed&&(o+=`, ${s.petBreed}`),s.petAge&&(o+=`, ${s.petAge} ${a("common.years","years")}`),i.push(`${a("clinic_results.pet","Pet")}: ${o}`)}i.push(""),s.voiceTranscript&&s.aiAnalyzedSymptoms?(i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`ğŸ¤– ${a("clinic_results.ai_analysis_section","AI EMERGENCY ANALYSIS")}`),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(s.aiAnalyzedSymptoms),i.push(""),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`ğŸ¤ ${a("clinic_results.owner_description","OWNER'S DESCRIPTION")}`),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`"${s.voiceTranscript}"`),i.push(""),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`ğŸ“ ${a("clinic_results.summary_section","SYMPTOM SUMMARY")}`),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(s.symptom),i.push("")):s.voiceTranscript?(i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`ğŸ¤ ${a("clinic_results.voice_description","VOICE DESCRIPTION")}`),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`"${s.voiceTranscript}"`),i.push(""),i.push(`${a("clinic_results.symptoms","Symptoms")}: ${s.symptom}`),i.push("")):(i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`ğŸš¨ ${a("clinic_results.emergency_section","EMERGENCY DETAILS")}`),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`${a("clinic_results.symptoms","Symptoms")}: ${s.symptom}`),i.push("")),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`ğŸ“ ${a("clinic_results.contact_section","CONTACT INFORMATION")}`),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");const V=ft(s.contactPhone);if(i.push(`${a("clinic_results.phone","Phone")}: ${V}`),s.contactEmail&&i.push(`${a("common.email","Email")}: ${s.contactEmail}`),s.contactName&&i.push(`${a("clinic_results.name","Name")}: ${s.contactName}`),i.push(""),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`ğŸ“ ${a("clinic_results.location_section","LOCATION")}`),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),s.locationLatitude&&s.locationLongitude){const o=`https://www.google.com/maps?q=${s.locationLatitude},${s.locationLongitude}`;s.locationText&&i.push(s.locationText),i.push(`GPS: ${s.locationLatitude}, ${s.locationLongitude}`),i.push(`${a("clinic_results.map","Map")}: ${o}`)}else s.locationText?i.push(s.locationText):i.push(a("clinic_results.location_not_provided","Location not provided"));if((f=s==null?void 0:s.pet)!=null&&f.lastVisitHospitalId){const o=n.find(j=>j.id===s.pet.lastVisitHospitalId);if(o){if(i.push(""),i.push(`ğŸ“‹ ${a("clinic_results.regular_clinic_note","NOTE: This pet is a registered patient at")} ${o.nameEn}`),s.pet.lastVisitDate){const j=new Date(s.pet.lastVisitDate).toLocaleDateString();i.push(`${a("clinic_results.last_visit","Last visit")}: ${j}`)}i.push(a("clinic_results.medical_records_available","Medical records may be available there for reference."))}}return i.push(""),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(a("clinic_results.broadcast_alert_footer","Please respond urgently if you can help.")),i.join(`
`)}function Ht(){const{t:s,language:a}=Ve(),[,n]=Ue("/emergency-results/:requestId"),[i,V]=u.useState("all"),[f,o]=u.useState(null),[j,U]=u.useState(!1),[Y,ke]=u.useState(""),[A,xe]=u.useState("all"),[Z,me]=u.useState(!0),[pe,Se]=u.useState(!1),[E,$e]=u.useState("all"),[D,Ce]=u.useState("all"),[g,Q]=u.useState(new Set),[X,ze]=u.useState(!1),[Ae,M]=u.useState(!1),[m,H]=u.useState({contactName:"",contactPhone:"",symptom:"",manualLocation:"",locationLatitude:void 0,locationLongitude:void 0}),[ge,J]=u.useState(!1),[be,P]=u.useState(null),{toast:$}=Ye(),{data:l}=ie({queryKey:["/api/emergency-requests",n==null?void 0:n.requestId],enabled:!!(n!=null&&n.requestId)}),{data:fe=[]}=ie({queryKey:["/api/regions"]}),{data:C=[]}=ie({queryKey:["/api/hospitals"]});u.useEffect(()=>{l!=null&&l.locationLatitude&&(l!=null&&l.locationLongitude)&&o({lat:parseFloat(l.locationLatitude),lng:parseFloat(l.locationLongitude)})},[l]);const Ee=(t,r,c,d)=>{const v=(c-t)*Math.PI/180,p=(d-r)*Math.PI/180,w=Math.sin(v/2)*Math.sin(v/2)+Math.cos(t*Math.PI/180)*Math.cos(c*Math.PI/180)*Math.sin(p/2)*Math.sin(p/2);return 6371*(2*Math.atan2(Math.sqrt(w),Math.sqrt(1-w)))},y=C.filter(t=>{var r,c;if(!t.isAvailable)return!1;if(i!=="all"){const d=fe.find(h=>h.code===i);if(d&&t.regionId!==d.id)return!1}if(Z&&!t.open247||pe&&!t.whatsapp)return!1;if(Y){const d=Y.toLowerCase(),h=t.nameEn.toLowerCase().includes(d),v=(r=t.nameZh)==null?void 0:r.toLowerCase().includes(d),p=t.addressEn.toLowerCase().includes(d),w=(c=t.addressZh)==null?void 0:c.toLowerCase().includes(d);if(!h&&!v&&!p&&!w)return!1}return!0}).map(t=>{if(f&&t.latitude&&t.longitude){const r=parseFloat(t.latitude),c=parseFloat(t.longitude);if(!isNaN(r)&&!isNaN(c)){const d=Ee(f.lat,f.lng,r,c);return{...t,distance:d}}}return t}).filter(t=>{if(A!=="all"){if(t.distance===void 0)return!1;const r=parseFloat(A);if(t.distance>r)return!1}if(E!=="all"){if(E==="unknown"){if(t.liveStatus!==null)return!1}else if(E==="available"){if(t.liveStatus!=="normal")return!1}else if(t.liveStatus!==E)return!1}if(D!=="all"){const r=t.lastInboundReplyAt;if(D==="none"){if(r)return!1}else{if(!r)return!1;const c=Date.now(),d=new Date(r).getTime(),h=c-d;switch(D){case"1h":if(h>60*60*1e3)return!1;break;case"24h":if(h>24*60*60*1e3)return!1;break;case"7d":if(h>7*24*60*60*1e3)return!1;break}}}return!0}).sort((t,r)=>{var w;const c=(w=l==null?void 0:l.pet)==null?void 0:w.lastVisitHospitalId,d=c===t.id,h=c===r.id;if(d&&!h)return-1;if(!d&&h)return 1;if(t.isPartner&&!r.isPartner)return-1;if(!t.isPartner&&r.isPartner)return 1;const v=t.distance!==void 0?t.distance:1/0,p=r.distance!==void 0?r.distance:1/0;return v!==p?v-p:t.open247&&!r.open247?-1:!t.open247&&r.open247?1:0}),He=(t,r,c)=>{G.trackClinicContact({clinicId:r,contactMethod:"call",clinicName:c}),window.location.href=`tel:${t}`},Pe=(t,r,c)=>{G.trackClinicContact({clinicId:r,contactMethod:"whatsapp",clinicName:c});const d=l?`${s("clinic_results.whatsapp_message_emergency","Emergency")}: ${l.symptom}. ${s("clinic_results.whatsapp_message_contact","Contact")}: ${l.contactPhone}`:s("clinic_results.whatsapp_message_request","I need emergency pet care"),h=encodeURIComponent(d);window.open(`https://wa.me/${t.replace(/[^0-9]/g,"")}?text=${h}`,"_blank")},Le=(t,r,c)=>{const d=`https://www.google.com/maps/search/?api=1&query=${t},${r}`;window.open(d,"_blank")},Ie=t=>{Q(r=>{const c=new Set(r);return c.has(t)?c.delete(t):c.add(t),c})},Ke=()=>{Q(new Set)},De=y.filter(t=>t.distance!==void 0&&t.distance<=5).length,Me=y.filter(t=>t.open247).length,Fe=y.filter(t=>t.whatsapp).length,je=!!(f!=null&&f.lat&&(f!=null&&f.lng)),Te=C.filter(t=>t.latitude&&t.longitude).length,q=je&&Te>0;u.useEffect(()=>{!q&&A!=="all"&&xe("all")},[q,A]);const R=de({mutationFn:async()=>{const t=g.size>0?Array.from(g):y.filter(d=>d.whatsapp).map(d=>d.id),r=ue(l,s,C);return await(await re("POST",`/api/emergency-requests/${n==null?void 0:n.requestId}/broadcast`,{clinicIds:t,message:r})).json()},onSuccess:t=>{ce.invalidateQueries({queryKey:["/api/emergency-requests",n==null?void 0:n.requestId]}),G.trackBroadcast({requestId:(n==null?void 0:n.requestId)||"",clinicsCount:t.count,petType:(l==null?void 0:l.petSpecies)||"unknown"}),$({title:s("clinic_results.broadcast_success","Broadcast sent successfully!"),description:a==="zh-HK"?`âœ… æ¯›å­©ç·Šæ€¥é€šçŸ¥å·²ç™¼é€è‡³ ${t.count} é–“è¨ºæ‰€ã€‚é»æ“Šã€ŒæŸ¥çœ‹å»£æ’­ç‹€æ…‹ã€è¿½è¹¤ç™¼é€æƒ…æ³ã€‚`:`âœ… Sent to ${t.count} ${t.count===1?"clinic":"clinics"}. Click "View Broadcast Status" to track delivery.`,duration:8e3}),U(!1),Q(new Set),window.scrollTo({top:0,behavior:"smooth"})},onError:t=>{$({title:s("clinic_results.broadcast_failed","Broadcast failed"),description:t.message,variant:"destructive"})}}),Oe=()=>{R.mutate()},z=g.size>0?g.size:y.filter(t=>t.whatsapp).length,F=C.filter(t=>t.isAvailable&&t.isPartner&&t.open247&&t.whatsapp),ee=de({mutationFn:async()=>{const t=F.map(d=>d.id);if(t.length===0)throw new Error("No 24-hour support hospitals available");const r=ue(l,s,C);return await(await re("POST",`/api/emergency-requests/${n==null?void 0:n.requestId}/broadcast`,{clinicIds:t,message:r})).json()},onSuccess:t=>{n!=null&&n.requestId&&ce.invalidateQueries({queryKey:["/api/emergency-requests",n.requestId]}),G.trackBroadcast({requestId:(n==null?void 0:n.requestId)||"",clinicsCount:t.count,petType:(l==null?void 0:l.petSpecies)||"unknown"}),$({title:s("clinic_results.broadcast_success","Emergency Alert Sent!"),description:a==="zh-HK"?`âœ… æ¯›å­©ç·Šæ€¥é€šçŸ¥å·²ç™¼é€è‡³ ${t.count} é–“24å°æ™‚è¨ºæ‰€ã€‚é»æ“Šã€ŒæŸ¥çœ‹å»£æ’­ç‹€æ…‹ã€è¿½è¹¤ç™¼é€æƒ…æ³ã€‚`:`âœ… Broadcast sent to ${t.count} 24-hour support ${t.count===1?"hospital":"hospitals"}. Click "View Broadcast Status" to track delivery.`,duration:8e3}),window.scrollTo({top:0,behavior:"smooth"})},onError:t=>{$({title:s("clinic_results.broadcast_failed","Broadcast failed"),description:t.message,variant:"destructive"})}}),te=de({mutationFn:async t=>await(await re("PATCH",`/api/emergency-requests/${n==null?void 0:n.requestId}`,t)).json(),onSuccess:()=>{ce.invalidateQueries({queryKey:["/api/emergency-requests",n==null?void 0:n.requestId]}),$({title:s("clinic_results.edit_success","Emergency request updated"),description:s("clinic_results.edit_success_description","Your changes have been saved successfully.")}),M(!1)},onError:t=>{$({title:s("clinic_results.edit_failed","Update failed"),description:t.message,variant:"destructive"})}}),Be=()=>{l&&(H({contactName:l.contactName||"",contactPhone:l.contactPhone||"",symptom:l.symptom||"",manualLocation:l.manualLocation||"",locationLatitude:l.locationLatitude?parseFloat(l.locationLatitude):void 0,locationLongitude:l.locationLongitude?parseFloat(l.locationLongitude):void 0}),P(null),M(!0))},We=()=>{"geolocation"in navigator?(J(!0),P(null),navigator.geolocation.getCurrentPosition(t=>{H(r=>({...r,locationLatitude:t.coords.latitude,locationLongitude:t.coords.longitude,manualLocation:""})),J(!1),P(null),$({title:s("emergency.gps.success","Location Detected"),description:s("emergency.gps.success_desc","Your GPS location has been detected successfully")})},t=>{J(!1),P(s("emergency.gps.error","Unable to detect location. Please check your location permissions."))})):P(s("emergency.gps.not_supported","Geolocation is not supported by this browser"))},Ge=()=>{te.mutate(m)};return e.jsxs(e.Fragment,{children:[e.jsx(Ze,{title:a==="zh-HK"?"ç·Šæ€¥è¨ºæ‰€çµæœ - PetSOS":"Emergency Clinic Results - PetSOS",description:a==="zh-HK"?"æŸ¥çœ‹é™„è¿‘è¨ºæ‰€åŠç™¼é€ç·Šæ€¥æ±‚åŠ©":"View nearby clinics and send emergency requests",language:a,noindex:!0}),e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 overflow-y-auto",children:[e.jsx("header",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 sticky top-0 z-10",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s("clinic_results.title","Emergency Clinic Results")}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[y.length," ",s("clinic_results.clinics_found",y.length===1?"clinic found":"clinics found")]})]}),e.jsx(Ne,{href:"/",children:e.jsx(b,{variant:"outline","data-testid":"button-home",children:s("common.home","Home")})})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-6 space-y-6",children:[l&&e.jsx(_,{className:"bg-red-50 dark:bg-red-950 border-red-200 dark:border-red-800","data-testid":"card-emergency-summary",children:e.jsx(le,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Qe,{className:"h-6 w-6 text-red-600 dark:text-red-400 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(ne,{className:"text-lg text-red-900 dark:text-red-100",children:s("clinic_results.emergency_request","Emergency Request")}),e.jsxs(b,{variant:"ghost",size:"sm",onClick:Be,className:"text-red-700 dark:text-red-300 hover:text-red-900 dark:hover:text-red-100","data-testid":"button-edit-request",children:[e.jsx(bt,{className:"h-4 w-4 mr-1"}),s("common.edit","Edit")]})]}),e.jsxs("p",{className:"text-sm text-red-700 dark:text-red-300 mt-2",children:[e.jsxs("strong",{children:[s("clinic_results.symptoms","Symptoms"),":"]})," ",l.symptom]}),l.petSpecies&&e.jsxs("p",{className:"text-sm text-red-700 dark:text-red-300 mt-1","data-testid":"text-pet-details",children:[e.jsxs("strong",{children:[s("clinic_results.pet","Pet"),":"]})," ",l.petSpecies,l.petBreed&&`, ${l.petBreed}`,l.petAge&&` (${l.petAge} ${s("common.years","years")})`]}),l.manualLocation&&e.jsxs("p",{className:"text-sm text-red-700 dark:text-red-300 mt-1",children:[e.jsxs("strong",{children:[s("clinic_results.location","Location"),":"]})," ",l.manualLocation]}),e.jsxs("p",{className:"text-sm text-red-700 dark:text-red-300 mt-1",children:[e.jsxs("strong",{children:[s("clinic_results.contact","Contact"),":"]})," ",l.contactPhone,l.contactName&&` (${l.contactName})`]})]})]})})}),l&&F.length>0&&(n==null?void 0:n.requestId)&&e.jsx(_,{className:"bg-gradient-to-r from-red-600 to-red-700 dark:from-red-700 dark:to-red-800 border-0 shadow-lg","data-testid":"card-quick-broadcast",children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-4 text-white",children:[e.jsx(he,{className:"h-10 w-10 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold mb-1",children:["ğŸš¨ ",s("emergency.instant_broadcast_title","INSTANT EMERGENCY BROADCAST")]}),e.jsx("p",{className:"text-sm text-red-50",children:s("emergency.instant_broadcast_desc","Send alert to {count} available 24-hour support {plural} NOW").replace("{count}",String(F.length)).replace("{plural}",F.length===1?"hospital":"hospitals")}),e.jsxs("p",{className:"text-xs text-red-100 mt-2",children:["âš¡ ",s("emergency.instant_broadcast_tip","Fastest way to get help - One click to reach all partner hospitals")]})]})]}),e.jsx(b,{size:"lg",onClick:()=>ee.mutate(),disabled:ee.isPending,className:"bg-white text-red-600 hover:bg-red-50 font-bold text-lg px-8 py-6 shadow-xl hover:shadow-2xl transition-all","data-testid":"button-quick-broadcast",children:ee.isPending?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"h-5 w-5 mr-2 animate-spin"}),s("common.sending","Sending...")]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"h-5 w-5 mr-2"}),s("emergency.instant_broadcast_button","BROADCAST NOW")]})})]})})}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[e.jsx(_,{"data-testid":"stat-total",className:"shadow-sm",children:e.jsx(k,{className:"pt-4 pb-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:y.length}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-0.5",children:s("clinic_results.total_clinics","Total Clinics")})]})})}),e.jsx(_,{"data-testid":"stat-24hour",className:"shadow-sm",children:e.jsx(k,{className:"pt-4 pb-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:Me}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-0.5",children:s("clinic_results.24hour","24-Hour")})]})})}),e.jsx(_,{"data-testid":"stat-whatsapp",className:"shadow-sm",children:e.jsx(k,{className:"pt-4 pb-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:Fe}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-0.5",children:s("clinic_results.whatsapp","WhatsApp")})]})})}),e.jsx(_,{"data-testid":"stat-nearby",className:"shadow-sm",children:e.jsx(k,{className:"pt-4 pb-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:De}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-0.5",children:s("clinic_results.within_5km","Within 5km")})]})})})]}),e.jsxs(_,{"data-testid":"card-filters",children:[e.jsx(le,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ne,{className:"text-lg",children:s("clinic_results.filters_search","Filters & Search")}),e.jsxs(b,{variant:"ghost",size:"sm",onClick:()=>ze(!X),"data-testid":"button-toggle-filters",children:[e.jsx(xt,{className:"h-4 w-4 mr-2"}),X?s("clinic_results.hide_filters","Hide Filters"):s("clinic_results.show_filters","Show Filters")]})]})}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(mt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(B,{placeholder:s("clinic_results.search_placeholder","Search clinics by name or address..."),value:Y,onChange:t=>ke(t.target.value),className:"pl-10","data-testid":"input-search"})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-1",children:[e.jsx(oe,{id:"24hour-quick-filter",checked:Z,onCheckedChange:me,"data-testid":"switch-24hour-quick"}),e.jsxs(N,{htmlFor:"24hour-quick-filter",className:"cursor-pointer font-medium",children:[e.jsx(ye,{className:"inline h-4 w-4 mr-1.5 text-green-600"}),s("clinic_results.24hour_only","24-Hour Clinics Only")]})]}),X&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 pt-2",children:[e.jsxs("div",{children:[e.jsx(N,{className:"text-sm mb-2 block",children:s("clinic_results.region","Region")}),e.jsxs(L,{value:i,onValueChange:V,children:[e.jsx(I,{"data-testid":"select-region",children:e.jsx(K,{placeholder:s("clinic_results.all_regions","All Regions")})}),e.jsxs(W,{children:[e.jsx(x,{value:"all",children:s("clinic_results.all_regions","All Regions")}),fe.map(t=>e.jsx(x,{value:t.code,children:a==="zh-HK"?t.nameZh:t.nameEn},t.id))]})]})]}),e.jsxs("div",{children:[e.jsx(N,{className:"text-sm mb-2 block",children:s("clinic_results.distance","Distance")}),q?e.jsxs(L,{value:A,onValueChange:xe,children:[e.jsx(I,{"data-testid":"select-distance",children:e.jsx(K,{placeholder:s("clinic_results.any_distance","Any Distance")})}),e.jsxs(W,{children:[e.jsx(x,{value:"all",children:s("clinic_results.any_distance","Any Distance")}),e.jsx(x,{value:"5",children:s("clinic_results.within_5km","Within 5 km")}),e.jsx(x,{value:"10",children:s("clinic_results.within_10km","Within 10 km")}),e.jsx(x,{value:"15",children:s("clinic_results.within_15km","Within 15 km")})]})]}):e.jsxs("div",{children:[e.jsx(L,{disabled:!0,value:"all",children:e.jsx(I,{"data-testid":"select-distance-disabled",className:"opacity-50",children:e.jsx(K,{placeholder:s("clinic_results.gps_not_available","GPS Not Available")})})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:je?s("clinic_results.no_gps_data","No clinic GPS data available"):s("clinic_results.enable_gps","Enable GPS on Step 2 for distance filtering")})]})]}),e.jsxs("div",{children:[e.jsx(N,{className:"text-sm mb-2 block",children:a==="zh-HK"?"è¨ºæ‰€ç‹€æ…‹":"Status"}),e.jsxs(L,{value:E,onValueChange:$e,children:[e.jsx(I,{"data-testid":"select-status",children:e.jsx(K,{placeholder:a==="zh-HK"?"å…¨éƒ¨ç‹€æ…‹":"All Status"})}),e.jsxs(W,{children:[e.jsx(x,{value:"all",children:a==="zh-HK"?"å…¨éƒ¨ç‹€æ…‹":"All Status"}),e.jsx(x,{value:"unknown",children:a==="zh-HK"?"? æœªçŸ¥":"? Unknown"}),e.jsx(x,{value:"available",children:a==="zh-HK"?"âœ“ æ­£å¸¸æœå‹™":"âœ“ Available"}),e.jsx(x,{value:"busy",children:a==="zh-HK"?"â³ ç¹å¿™":"â³ Busy"}),e.jsx(x,{value:"critical_only",children:a==="zh-HK"?"âš ï¸ åªæ”¶ç·Šæ€¥":"âš ï¸ Critical Only"}),e.jsx(x,{value:"full",children:a==="zh-HK"?"ğŸš« å·²æ»¿":"ğŸš« Full"})]})]})]}),e.jsxs("div",{children:[e.jsx(N,{className:"text-sm mb-2 block",children:a==="zh-HK"?"æœ€è¿‘å›è¦†":"Last Response"}),e.jsxs(L,{value:D,onValueChange:Ce,children:[e.jsx(I,{"data-testid":"select-reply",children:e.jsx(K,{placeholder:a==="zh-HK"?"å…¨éƒ¨":"Any"})}),e.jsxs(W,{children:[e.jsx(x,{value:"all",children:a==="zh-HK"?"å…¨éƒ¨":"Any"}),e.jsx(x,{value:"1h",children:a==="zh-HK"?"1å°æ™‚å…§":"Within 1 hour"}),e.jsx(x,{value:"24h",children:a==="zh-HK"?"24å°æ™‚å…§":"Within 24 hours"}),e.jsx(x,{value:"7d",children:a==="zh-HK"?"7å¤©å…§":"Within 7 days"}),e.jsx(x,{value:"none",children:a==="zh-HK"?"å¾æœªå›è¦†":"No Response"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-6",children:[e.jsx(oe,{id:"24hour-filter",checked:Z,onCheckedChange:me,"data-testid":"switch-24hour"}),e.jsx(N,{htmlFor:"24hour-filter",className:"cursor-pointer",children:s("clinic_results.24hour_only_short","24-Hour Only")})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-6",children:[e.jsx(oe,{id:"whatsapp-filter",checked:pe,onCheckedChange:Se,"data-testid":"switch-whatsapp"}),e.jsx(N,{htmlFor:"whatsapp-filter",className:"cursor-pointer",children:s("clinic_results.whatsapp_only","WhatsApp Only")})]})]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsx("div",{className:"flex-1",children:g.size>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(S,{variant:"secondary",className:"text-sm",children:[g.size," ",s("clinic_results.clinics_selected",g.size!==1?"clinics selected":"clinic selected")]}),e.jsx(b,{variant:"ghost",size:"sm",onClick:Ke,"data-testid":"button-deselect-all",children:s("clinic_results.clear_selection","Clear Selection")})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Ne,{href:`/emergency-results/${n==null?void 0:n.requestId}/messages`,children:e.jsxs(b,{variant:"outline",className:"border-blue-500 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-950","data-testid":"button-view-status",children:[e.jsx(gt,{className:"h-4 w-4 mr-2"}),s("clinic_results.view_status","View Broadcast Status")]})}),e.jsxs(b,{onClick:()=>U(!0),className:"bg-orange-600 hover:bg-orange-700",disabled:z===0,"data-testid":"button-broadcast",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),s("clinic_results.broadcast","Broadcast")," ",g.size>0?`(${g.size})`:s("clinic_results.to_all","to All")]})]})]}),e.jsx("div",{className:"space-y-4",children:y.length===0?e.jsx(_,{children:e.jsxs(k,{className:"p-12 text-center",children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-lg mb-2",children:s("clinic_results.no_clinics","No clinics found")}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:s("clinic_results.adjust_filters","Try adjusting your filters or search criteria")})]})}):y.map((t,r)=>{var v;const c=g.has(t.id),d=!!t.whatsapp,h=((v=l==null?void 0:l.pet)==null?void 0:v.lastVisitHospitalId)===t.id;return e.jsxs(_,{className:`hover:shadow-lg transition-all border-l-4 border-l-red-600 ${c?"ring-2 ring-orange-500":""} ${h?"ring-2 ring-amber-400 dark:ring-amber-500":""}`,"data-testid":`card-clinic-${t.id}`,children:[e.jsx(le,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[d&&e.jsx("div",{className:"pt-1",children:e.jsx(it,{checked:c,onCheckedChange:()=>Ie(t.id),"data-testid":`checkbox-clinic-${t.id}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[h&&e.jsxs(S,{className:"bg-gradient-to-r from-amber-500 to-orange-500 mb-2 font-bold","data-testid":`badge-existing-patient-${t.id}`,children:["â­ ",s("clinic_results.existing_patient_badge","EXISTING PATIENT - Medical Records Available")]}),t.isPartner&&!h&&e.jsx(S,{className:"bg-gradient-to-r from-purple-600 to-blue-600 mb-2 font-bold","data-testid":`badge-partner-${t.id}`,children:"â­ PetSOS Partner"}),e.jsxs(ne,{className:"text-lg mb-1 leading-tight",children:[a==="zh-HK"&&t.nameZh?t.nameZh:t.nameEn,a==="zh-HK"&&t.nameZh&&e.jsx("span",{className:"block text-sm font-normal text-gray-500 dark:text-gray-400 mt-0.5",children:t.nameEn})]}),t.distance!==void 0&&e.jsxs("div",{className:"inline-flex items-center gap-1 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 px-2 py-0.5 rounded-full text-xs font-semibold mb-2","data-testid":`text-clinic-distance-${t.id}`,children:[e.jsx(Xe,{className:"h-3 w-3"}),t.distance.toFixed(1)," km ",a==="zh-HK"?"è·é›¢":"away"]}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 truncate mb-2","data-testid":`text-clinic-address-${t.id}`,children:a==="zh-HK"&&t.addressZh?t.addressZh:t.addressEn}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[(()=>{const p=jt(t.liveStatus,s,a);return e.jsxs(S,{variant:"outline",className:`text-xs border ${p.className}`,"data-testid":`badge-status-${t.id}`,children:[p.icon," ",p.label]})})(),t.whatsapp&&e.jsxs(S,{variant:"outline",className:"bg-green-50 dark:bg-green-950 text-xs",children:[e.jsx(ve,{className:"h-3 w-3 mr-1"}),"WhatsApp"]}),t.lastInboundReplyAt&&e.jsxs(S,{variant:"outline",className:"bg-blue-50 dark:bg-blue-950 text-blue-700 dark:text-blue-300 text-xs","data-testid":`badge-last-reply-${t.id}`,children:["âœ“ ",a==="zh-HK"?"å·²å›è¦†":"Replied"," ",(()=>{const p=new Date(t.lastInboundReplyAt),se=Date.now()-p.getTime(),T=Math.floor(se/(60*60*1e3)),ae=Math.floor(se/(24*60*60*1e3));return T<1?a==="zh-HK"?"å‰›æ‰":"just now":T<24?a==="zh-HK"?`${T}å°æ™‚å‰`:`${T}h ago`:ae<7?a==="zh-HK"?`${ae}å¤©å‰`:`${ae}d ago`:p.toLocaleDateString()})()]}),t.replyStatus==="unresponsive"&&e.jsx(S,{variant:"outline",className:"bg-gray-100 dark:bg-gray-800 text-gray-500 dark:text-gray-400 text-xs","data-testid":`badge-unresponsive-${t.id}`,children:a==="zh-HK"?"æœªå›è¦†":"No reply"})]})]}),t.open247&&e.jsxs(S,{className:"bg-red-600 hover:bg-red-700 shrink-0","data-testid":`badge-24hour-${t.id}`,children:[e.jsx(ye,{className:"h-3 w-3 mr-1"}),a==="zh-HK"?"24å°æ™‚":"24hrs"]})]})}),e.jsx(k,{className:"pt-0",children:e.jsxs("div",{className:"flex gap-2",children:[t.phone&&e.jsxs(b,{onClick:()=>He(t.phone,t.id,t.nameEn),size:"sm",className:"flex-1 bg-red-600 hover:bg-red-700","data-testid":`button-call-${t.id}`,children:[e.jsx(Je,{className:"h-4 w-4 mr-1"}),a==="zh-HK"?"è‡´é›»":"Call"]}),t.whatsapp&&e.jsxs(b,{onClick:()=>Pe(t.whatsapp,t.id,t.nameEn),variant:"outline",size:"sm",className:"flex-1 border-red-600 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20","data-testid":`button-whatsapp-${t.id}`,children:[e.jsx(ve,{className:"h-4 w-4 mr-1"}),"WhatsApp"]}),t.latitude&&t.longitude&&e.jsxs(b,{onClick:()=>Le(t.latitude,t.longitude,t.nameEn),variant:"outline",size:"sm",className:"flex-1 border-red-600 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20","data-testid":`button-maps-${t.id}`,children:[e.jsx(_e,{className:"h-4 w-4 mr-1"}),a==="zh-HK"?"å°èˆª":"Maps"]})]})})]},t.id)})}),e.jsx("div",{className:"mt-8 p-4 bg-amber-50 dark:bg-amber-950 rounded-lg text-center",children:e.jsx("p",{className:"text-amber-800 dark:text-amber-200 text-sm",children:s("app.disclaimer","âš ï¸ PetSOS provides emergency guidance only and is not medical advice. If in doubt, contact a vet immediately.")})})]}),e.jsx(lt,{open:j,onOpenChange:U,children:e.jsxs(nt,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(rt,{children:[e.jsx(ct,{children:g.size>0?s("clinic_results.broadcast_to_selected","Broadcast to Selected Clinics"):s("clinic_results.broadcast_emergency","Broadcast Emergency Alert")}),e.jsx(dt,{asChild:!0,children:e.jsxs("div",{children:[e.jsx("p",{className:"mb-4",children:g.size>0?e.jsx(e.Fragment,{children:s("clinic_results.broadcast_desc_selected",`This will send your emergency alert to ${z} selected ${z===1?"clinic":"clinics"} via WhatsApp and email.`)}):e.jsx(e.Fragment,{children:s("clinic_results.broadcast_desc_all",`This will send your emergency alert to all ${z} clinics via WhatsApp and email.`)})}),g.size===0&&e.jsx("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-950 rounded border border-blue-200 dark:border-blue-800",children:e.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:s("clinic_results.broadcast_tip","ğŸ’¡ Tip: Select specific clinics using the checkboxes to send a targeted broadcast")})}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-4 rounded-lg overflow-x-auto",children:[e.jsxs("strong",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:[s("clinic_results.message_preview","Message Preview"),":"]}),e.jsx("pre",{className:"mt-2 text-sm text-gray-900 dark:text-gray-100 whitespace-pre-wrap font-sans break-all",children:ue(l,s,C)})]})]})})]}),e.jsxs(ot,{children:[e.jsx(ht,{"data-testid":"button-cancel-broadcast",children:s("common.cancel","Cancel")}),e.jsxs(ut,{onClick:Oe,disabled:R.isPending,className:"bg-orange-600 hover:bg-orange-700","data-testid":"button-confirm-broadcast",children:[R.isPending&&e.jsx(O,{className:"h-4 w-4 mr-2 animate-spin"}),s("clinic_results.send_to_clinics",`Send to ${z} ${z===1?"Clinic":"Clinics"}`)]})]})]})}),e.jsx(qe,{open:Ae,onOpenChange:M,children:e.jsxs(Re,{className:"max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs(et,{children:[e.jsx(tt,{children:a==="zh-HK"?"ç·¨è¼¯ç·Šæ€¥æ±‚åŠ©è³‡æ–™":"Edit Emergency Request"}),e.jsx(st,{children:a==="zh-HK"?"æ›´æ–°æ‚¨çš„ç·Šæ€¥æ±‚åŠ©è³‡æ–™ã€‚è®Šæ›´å°‡åæ˜ åœ¨æœªä¾†çš„å»£æ’­è¨Šæ¯ä¸­ã€‚":"Update your emergency request details. Changes will be reflected in future broadcasts."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"edit-contact-name",children:a==="zh-HK"?"è¯çµ¡äººå§“å":"Contact Name"}),e.jsx(B,{id:"edit-contact-name",value:m.contactName,onChange:t=>H({...m,contactName:t.target.value}),placeholder:s("emergency.name_placeholder","Your name"),"data-testid":"input-edit-contact-name"})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"edit-contact-phone",children:a==="zh-HK"?"è¯çµ¡é›»è©±":"Contact Phone"}),e.jsx(B,{id:"edit-contact-phone",value:m.contactPhone,onChange:t=>H({...m,contactPhone:t.target.value}),placeholder:s("emergency.phone_placeholder","+852 1234 5678"),"data-testid":"input-edit-contact-phone"})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"edit-symptom",className:"text-gray-700 dark:text-gray-300",children:a==="zh-HK"?"ç—‡ç‹€":"Symptoms"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:m.symptom})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"edit-location",className:"text-gray-700 dark:text-gray-300",children:a==="zh-HK"?"ä½ç½®":"Location"}),e.jsx(b,{type:"button",variant:"outline",className:"w-full mt-2 mb-2",onClick:We,disabled:ge,"data-testid":"button-use-gps",children:ge?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"h-4 w-4 mr-2 animate-spin"}),a==="zh-HK"?"åµæ¸¬ä½ç½®ä¸­...":"Detecting location..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),a==="zh-HK"?"ä½¿ç”¨ GPS å®šä½":"Use GPS Location"]})}),m.locationLatitude&&m.locationLongitude&&e.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400 mb-2 flex items-center gap-1",children:[e.jsx(pt,{className:"h-3 w-3"}),a==="zh-HK"?`GPS ä½ç½®å·²åµæ¸¬: ${m.locationLatitude.toFixed(6)}, ${m.locationLongitude.toFixed(6)}`:`GPS location detected: ${m.locationLatitude.toFixed(6)}, ${m.locationLongitude.toFixed(6)}`]}),be&&e.jsx("div",{className:"text-xs text-red-600 dark:text-red-400 mb-2",children:be}),e.jsx(B,{id:"edit-location",value:m.manualLocation,onChange:t=>H({...m,manualLocation:t.target.value}),placeholder:a==="zh-HK"?"åœ°å€æˆ–åœ°å€":"Area or address","data-testid":"input-edit-location"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:a==="zh-HK"?"ä½¿ç”¨ GPS æˆ–æ‰‹å‹•è¼¸å…¥åœ°å€":"Use GPS or manually enter address"})]})]}),e.jsxs(at,{children:[e.jsx(b,{variant:"outline",onClick:()=>M(!1),"data-testid":"button-cancel-edit",children:a==="zh-HK"?"å–æ¶ˆ":"Cancel"}),e.jsxs(b,{onClick:Ge,disabled:te.isPending,"data-testid":"button-save-edit",children:[te.isPending&&e.jsx(O,{className:"h-4 w-4 mr-2 animate-spin"}),a==="zh-HK"?"å„²å­˜è®Šæ›´":"Save Changes"]})]})]})})]})]})}export{Ht as default};
