import{a as M,W as R,r as b,h as S,g as E,j as e,L as F,C as h,b as m,v as f,w as p,a8 as z,y as K,F as I,z as a,A as n,D as t,E as c,I as x,G as d,B as w,X as $,_ as B,J as D,K as J,N as Q,O as U,P as W,a9 as G,o as A,s as l,b5 as X,ah as V,T as _,U as Y}from"./index-yGPiJpIr.js";import{u as T}from"./useMutation-g6oReyS0.js";import{T as q}from"./textarea-B-COFCfx.js";import{S as ee}from"./switch-BdZ2xI1R.js";import{f as se}from"./dateFormat-B3M36iqg.js";import{A as ie}from"./arrow-left-BVTF3Tl5.js";const re=A({verificationCode:l().length(6,"Verification code must be 6 digits").regex(/^\d+$/,"Must be 6 digits")}),ae=A({name:l().min(1,"Clinic name (English) is required"),nameZh:l().min(1,"Clinic name (Chinese) is required"),address:l().min(1,"Address (English) is required"),addressZh:l().min(1,"Address (Chinese) is required"),phone:l().min(1,"Phone is required"),whatsapp:l().optional(),email:l().optional(),regionId:l().min(1,"Region is required"),is24Hour:X().default(!1)});function xe(){const{toast:j}=M(),[P,y]=R("/clinic/edit/:id"),[Z,L]=b.useState(!1),[H,k]=b.useState(!1),u=y==null?void 0:y.id,{data:i,isLoading:O}=S({queryKey:["/api/clinics",u],queryFn:async()=>{if(!u)return null;const s=await fetch(`/api/clinics/${u}`);return s.ok?s.json():null},enabled:!!u}),{data:v}=S({queryKey:["/api/regions"]}),g=E({resolver:V(re),defaultValues:{verificationCode:""}}),r=E({resolver:V(ae),defaultValues:{name:"",nameZh:"",address:"",addressZh:"",phone:"",whatsapp:"",email:"",regionId:"",is24Hour:!1}});b.useEffect(()=>{i&&r.reset({name:i.name||"",nameZh:i.nameZh||"",address:i.address||"",addressZh:i.addressZh||"",phone:i.phone||"",whatsapp:i.whatsapp||"",email:i.email||"",regionId:i.regionId||"",is24Hour:i.is24Hour||!1})},[i,r]);const C=T({mutationFn:async s=>{if(!(i!=null&&i.id))throw new Error("Clinic not found");const o=await fetch(`/api/clinics/${i.id}/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({verificationCode:s.verificationCode})});if(!o.ok)throw new Error("Invalid verification code");return o.json()},onSuccess:()=>{L(!0),j({title:"Verified successfully!"})},onError:()=>{j({title:"Invalid verification code",variant:"destructive"})}}),N=T({mutationFn:async s=>{if(!(i!=null&&i.id))throw new Error("Clinic not found");const o=g.getValues("verificationCode");return _("PATCH",`/api/clinics/${i.id}/update-owner`,{...s,verificationCode:o})},onSuccess:()=>{k(!0),j({title:"Clinic information saved successfully!"}),Y.invalidateQueries({queryKey:["/api/clinics"]}),setTimeout(()=>k(!1),3e3)},onError:s=>{j({title:"Error saving clinic",description:s.message,variant:"destructive"})}});return P?O?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsx(F,{className:"h-8 w-8 animate-spin"})}):i?Z?e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"container mx-auto px-4 py-4",children:[e.jsx("div",{className:"flex items-center justify-between gap-3 mb-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{href:"/",children:e.jsx(w,{variant:"ghost",size:"icon",children:e.jsx(ie,{className:"h-5 w-5"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Edit Clinic Information"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Update your clinic details"})]})]})}),(i==null?void 0:i.createdAt)&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(B,{className:"h-4 w-4"}),"Created: ",se(i.createdAt)]})]})}),e.jsx("div",{className:"container mx-auto px-4 py-6 max-w-2xl",children:e.jsx(I,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(s=>N.mutate(s)),className:"space-y-6",children:[e.jsxs(h,{children:[e.jsx(f,{children:e.jsx(p,{children:"Basic Information"})}),e.jsxs(m,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(a,{control:r.control,name:"name",render:({field:s})=>e.jsxs(n,{children:[e.jsx(t,{children:"Clinic Name (English) *"}),e.jsx(c,{children:e.jsx(x,{...s})}),e.jsx(d,{})]})}),e.jsx(a,{control:r.control,name:"nameZh",render:({field:s})=>e.jsxs(n,{children:[e.jsx(t,{children:"Clinic Name (Chinese) *"}),e.jsx(c,{children:e.jsx(x,{...s})}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(a,{control:r.control,name:"address",render:({field:s})=>e.jsxs(n,{children:[e.jsx(t,{children:"Address (English) *"}),e.jsx(c,{children:e.jsx(q,{...s,rows:2})}),e.jsx(d,{})]})}),e.jsx(a,{control:r.control,name:"addressZh",render:({field:s})=>e.jsxs(n,{children:[e.jsx(t,{children:"Address (Chinese) *"}),e.jsx(c,{children:e.jsx(q,{...s,rows:2})}),e.jsx(d,{})]})})]}),e.jsx(a,{control:r.control,name:"regionId",render:({field:s})=>e.jsxs(n,{children:[e.jsx(t,{children:"Region *"}),e.jsxs(D,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(c,{children:e.jsx(J,{children:e.jsx(Q,{})})}),e.jsx(U,{children:v==null?void 0:v.map(o=>e.jsx(W,{value:o.id,children:o.nameEn},o.id))})]}),e.jsx(d,{})]})})]})]}),e.jsxs(h,{children:[e.jsx(f,{children:e.jsx(p,{children:"Contact Information"})}),e.jsx(m,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(a,{control:r.control,name:"phone",render:({field:s})=>e.jsxs(n,{children:[e.jsx(t,{children:"Phone *"}),e.jsx(c,{children:e.jsx(x,{...s})}),e.jsx(d,{})]})}),e.jsx(a,{control:r.control,name:"whatsapp",render:({field:s})=>e.jsxs(n,{children:[e.jsx(t,{children:"WhatsApp"}),e.jsx(c,{children:e.jsx(x,{...s,value:s.value||""})}),e.jsx(d,{})]})}),e.jsx(a,{control:r.control,name:"email",render:({field:s})=>e.jsxs(n,{children:[e.jsx(t,{children:"Email"}),e.jsx(c,{children:e.jsx(x,{...s,value:s.value||"",type:"email"})}),e.jsx(d,{})]})})]})})]}),e.jsxs(h,{children:[e.jsx(f,{children:e.jsx(p,{children:"Operations"})}),e.jsx(m,{children:e.jsx(a,{control:r.control,name:"is24Hour",render:({field:s})=>e.jsxs(n,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsx("div",{className:"space-y-0.5",children:e.jsx(t,{className:"text-base",children:"24-Hour Operation"})}),e.jsx(c,{children:e.jsx(ee,{checked:s.value||!1,onCheckedChange:s.onChange})})]})})})]}),e.jsx(w,{type:"submit",disabled:N.isPending,className:"w-full",size:"lg",children:N.isPending?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):H?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Saved!"]}):"Save Changes"})]})})})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:e.jsx("div",{className:"container mx-auto px-4 py-12 max-w-md",children:e.jsxs(h,{children:[e.jsxs(f,{children:[e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5"}),"Verify Access"]}),e.jsx(K,{children:"Enter the 6-digit verification code to edit clinic information"})]}),e.jsx(m,{children:e.jsx(I,{...g,children:e.jsxs("form",{onSubmit:g.handleSubmit(s=>C.mutate(s)),className:"space-y-4",children:[e.jsx(a,{control:g.control,name:"verificationCode",render:({field:s})=>e.jsxs(n,{children:[e.jsx(t,{children:"Verification Code"}),e.jsx(c,{children:e.jsx(x,{...s,type:"text",placeholder:"000000",maxLength:6,className:"text-center text-2xl tracking-widest"})}),e.jsx(d,{})]})}),e.jsx(w,{type:"submit",className:"w-full",disabled:C.isPending,children:C.isPending?"Verifying...":"Verify"})]})})})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:e.jsx("div",{className:"container mx-auto px-4 py-12",children:e.jsx(h,{children:e.jsxs(m,{className:"py-12 text-center",children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Clinic not found"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Please check the clinic link and try again."})]})})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"Clinic not found"})})}export{xe as default};
