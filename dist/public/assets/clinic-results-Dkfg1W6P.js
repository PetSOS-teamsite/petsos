import{c as pe,K as Qe,r as d,N as Xe,O as Je,j as e,Q as $e,R as _e,T as qe,U as Re,V as et,W as ve,X as tt,u as st,Y as at,a as it,h as ae,_ as ye,B as b,C as k,q as ie,d as nt,t as ne,b as E,I as Q,$ as w,a0 as ke,a1 as ce,a2 as re,a3 as le,a4 as we,a5 as B,M as ct,E as rt,J as X,G as oe,H as de}from"./index-DSfXJrMH.js";import{u as he}from"./useMutation-Cr219pYB.js";import{B as V}from"./badge-i4G4T4_i.js";import{S as ue}from"./switch-Cwa_8bCq.js";import{A as lt,a as ot,b as dt,c as ht,d as ut,e as mt,f as xt,g as pt}from"./alert-dialog-wxMcagxD.js";import{D as gt,a as ft,b as bt,c as jt,d as Nt,e as _t}from"./dialog-DVNSF8fN.js";import{S as me}from"./send-CGAKeUTK.js";import{L as J}from"./loader-circle-DJFh7Kw2.js";import{S as vt}from"./search-qxig8uw6.js";import{M as Ce}from"./message-circle-G0fVud4W.js";import{N as Se}from"./navigation-B4IaJzIy.js";import{C as yt}from"./circle-check-D_uZXrGr.js";import"./index-BKY5CHHC.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=pe("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=pe("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ct=pe("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);var ge="Checkbox",[St,Yt]=Qe(ge),[$t,Et]=St(ge),Ee=d.forwardRef((t,a)=>{const{__scopeCheckbox:n,name:i,checked:v,defaultChecked:u,required:h,disabled:x,value:C="on",onCheckedChange:A,form:S,...y}=t,[j,$]=d.useState(null),z=Xe(a,g=>$(g)),F=d.useRef(!1),U=j?S||!!j.closest("form"):!0,[m=!1,I]=Je({prop:v,defaultProp:u,onChange:A}),K=d.useRef(m);return d.useEffect(()=>{const g=j==null?void 0:j.form;if(g){const L=()=>I(K.current);return g.addEventListener("reset",L),()=>g.removeEventListener("reset",L)}},[j,I]),e.jsxs($t,{scope:n,state:m,disabled:x,children:[e.jsx($e.button,{type:"button",role:"checkbox","aria-checked":P(m)?"mixed":m,"aria-required":h,"data-state":Ie(m),"data-disabled":x?"":void 0,disabled:x,value:C,...y,ref:z,onKeyDown:_e(t.onKeyDown,g=>{g.key==="Enter"&&g.preventDefault()}),onClick:_e(t.onClick,g=>{I(L=>P(L)?!0:!L),U&&(F.current=g.isPropagationStopped(),F.current||g.stopPropagation())})}),U&&e.jsx(Pt,{control:j,bubbles:!F.current,name:i,value:C,checked:m,required:h,disabled:x,form:S,style:{transform:"translateX(-100%)"},defaultChecked:P(u)?!1:u})]})});Ee.displayName=ge;var Pe="CheckboxIndicator",Ae=d.forwardRef((t,a)=>{const{__scopeCheckbox:n,forceMount:i,...v}=t,u=Et(Pe,n);return e.jsx(qe,{present:i||P(u.state)||u.state===!0,children:e.jsx($e.span,{"data-state":Ie(u.state),"data-disabled":u.disabled?"":void 0,...v,ref:a,style:{pointerEvents:"none",...t.style}})})});Ae.displayName=Pe;var Pt=t=>{const{control:a,checked:n,bubbles:i=!0,defaultChecked:v,...u}=t,h=d.useRef(null),x=Re(n),C=et(a);d.useEffect(()=>{const S=h.current,y=window.HTMLInputElement.prototype,$=Object.getOwnPropertyDescriptor(y,"checked").set;if(x!==n&&$){const z=new Event("click",{bubbles:i});S.indeterminate=P(n),$.call(S,P(n)?!1:n),S.dispatchEvent(z)}},[x,n,i]);const A=d.useRef(P(n)?!1:n);return e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:v??A.current,...u,tabIndex:-1,ref:h,style:{...t.style,...C,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function P(t){return t==="indeterminate"}function Ie(t){return P(t)?"indeterminate":t?"checked":"unchecked"}var Le=Ee,At=Ae;const De=d.forwardRef(({className:t,...a},n)=>e.jsx(Le,{ref:n,className:ve("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...a,children:e.jsx(At,{className:ve("flex items-center justify-center text-current"),children:e.jsx(tt,{className:"h-4 w-4"})})}));De.displayName=Le.displayName;function It(t){if(!t)return"";const a=t.replace(/\D/g,"");if(!a)return t;if(a.startsWith("852")&&a.length===11)return`+852 ${a.slice(3,7)} ${a.slice(7)}`;if(a.length===8&&!a.startsWith("0"))return`+852 ${a.slice(0,4)} ${a.slice(4)}`;if(a.startsWith("86")&&a.length===13)return`+86 ${a.slice(2,5)} ${a.slice(5,9)} ${a.slice(9)}`;if(a.startsWith("1")&&a.length===11)return`+1 ${a.slice(1,4)} ${a.slice(4,7)} ${a.slice(7)}`;if(a.startsWith("44")&&a.length>=12)return`+44 ${a.slice(2,6)} ${a.slice(6)}`;if(a.length>10){const n=a.slice(0,a.length-10),i=a.slice(a.length-10);return`+${n} ${i.slice(0,3)} ${i.slice(3,6)} ${i.slice(6)}`}return a.length>=10?`+${a}`:t}function xe(t,a,n){var u;if(!t)return a("clinic_results.emergency_care_needed","Emergency pet care needed");const i=[];if(i.push(`ğŸš¨ ${a("clinic_results.broadcast_alert_title","PET EMERGENCY ALERT")} ğŸš¨`),i.push(""),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`ğŸ“‹ ${a("clinic_results.pet_info_section","PET INFORMATION")}`),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),t.pet){const h=t.pet;h.name&&i.push(`${a("clinic_results.name","Name")}: ${h.name}`);let x=t.petSpecies||"";t.petBreed&&(x+=`, ${t.petBreed}`),t.petAge&&(x+=`, ${t.petAge} ${a("common.years","years")}`),h.weight&&(x+=`, ${h.weight}${a("clinic_results.weight_kg","kg")}`),x&&i.push(`${a("clinic_results.details","Details")}: ${x}`),h.medicalNotes&&h.medicalNotes.trim()&&i.push(`âš ï¸ ${a("clinic_results.medical_history","Medical History")}: ${h.medicalNotes}`)}else{let h=t.petSpecies||"";t.petBreed&&(h+=`, ${t.petBreed}`),t.petAge&&(h+=`, ${t.petAge} ${a("common.years","years")}`),i.push(`${a("clinic_results.pet","Pet")}: ${h}`)}i.push(""),t.voiceTranscript&&t.aiAnalyzedSymptoms?(i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`ğŸ¤– ${a("clinic_results.ai_analysis_section","AI EMERGENCY ANALYSIS")}`),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(t.aiAnalyzedSymptoms),i.push(""),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`ğŸ¤ ${a("clinic_results.owner_description","OWNER'S DESCRIPTION")}`),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`"${t.voiceTranscript}"`),i.push(""),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`ğŸ“ ${a("clinic_results.summary_section","SYMPTOM SUMMARY")}`),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(t.symptom),i.push("")):t.voiceTranscript?(i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`ğŸ¤ ${a("clinic_results.voice_description","VOICE DESCRIPTION")}`),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`"${t.voiceTranscript}"`),i.push(""),i.push(`${a("clinic_results.symptoms","Symptoms")}: ${t.symptom}`),i.push("")):(i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`ğŸš¨ ${a("clinic_results.emergency_section","EMERGENCY DETAILS")}`),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`${a("clinic_results.symptoms","Symptoms")}: ${t.symptom}`),i.push("")),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`ğŸ“ ${a("clinic_results.contact_section","CONTACT INFORMATION")}`),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");const v=It(t.contactPhone);if(i.push(`${a("clinic_results.phone","Phone")}: ${v}`),t.contactEmail&&i.push(`${a("common.email","Email")}: ${t.contactEmail}`),t.contactName&&i.push(`${a("clinic_results.name","Name")}: ${t.contactName}`),i.push(""),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`ğŸ“ ${a("clinic_results.location_section","LOCATION")}`),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),t.locationLatitude&&t.locationLongitude){const h=`https://www.google.com/maps?q=${t.locationLatitude},${t.locationLongitude}`;t.locationText&&i.push(t.locationText),i.push(`GPS: ${t.locationLatitude}, ${t.locationLongitude}`),i.push(`${a("clinic_results.map","Map")}: ${h}`)}else t.locationText?i.push(t.locationText):i.push(a("clinic_results.location_not_provided","Location not provided"));if((u=t==null?void 0:t.pet)!=null&&u.lastVisitHospitalId){const h=n.find(x=>x.id===t.pet.lastVisitHospitalId);if(h){if(i.push(""),i.push(`ğŸ“‹ ${a("clinic_results.regular_clinic_note","NOTE: This pet is a registered patient at")} ${h.nameEn}`),t.pet.lastVisitDate){const x=new Date(t.pet.lastVisitDate).toLocaleDateString();i.push(`${a("clinic_results.last_visit","Last visit")}: ${x}`)}i.push(a("clinic_results.medical_records_available","Medical records may be available there for reference."))}}return i.push(""),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(a("clinic_results.broadcast_alert_footer","Please respond urgently if you can help.")),i.join(`
`)}function Zt(){const{t,language:a}=st(),[,n]=at("/emergency-results/:requestId"),[i,v]=d.useState("all"),[u,h]=d.useState(null),[x,C]=d.useState(!1),[A,S]=d.useState(""),[y,j]=d.useState("all"),[$,z]=d.useState(!0),[F,U]=d.useState(!1),[m,I]=d.useState(new Set),[K,g]=d.useState(!1),[L,Y]=d.useState(!1),[p,W]=d.useState({contactName:"",contactPhone:"",symptom:"",manualLocation:"",locationLatitude:void 0,locationLongitude:void 0}),[fe,q]=d.useState(!1),[be,G]=d.useState(null),{toast:D}=it(),{data:c}=ae({queryKey:["/api/emergency-requests",n==null?void 0:n.requestId],enabled:!!(n!=null&&n.requestId)}),{data:je=[]}=ae({queryKey:["/api/regions"]}),{data:H=[]}=ae({queryKey:["/api/hospitals"]});d.useEffect(()=>{c!=null&&c.locationLatitude&&(c!=null&&c.locationLongitude)&&h({lat:parseFloat(c.locationLatitude),lng:parseFloat(c.locationLongitude)})},[c]);const Me=(s,r,l,o)=>{const _=(l-s)*Math.PI/180,M=(o-r)*Math.PI/180,T=Math.sin(_/2)*Math.sin(_/2)+Math.cos(s*Math.PI/180)*Math.cos(l*Math.PI/180)*Math.sin(M/2)*Math.sin(M/2);return 6371*(2*Math.atan2(Math.sqrt(T),Math.sqrt(1-T)))},N=H.filter(s=>{var r,l;if(!s.isAvailable)return!1;if(i!=="all"){const o=je.find(f=>f.code===i);if(o&&s.regionId!==o.id)return!1}if($&&!s.open247||F&&!s.whatsapp)return!1;if(A){const o=A.toLowerCase(),f=s.nameEn.toLowerCase().includes(o),_=(r=s.nameZh)==null?void 0:r.toLowerCase().includes(o),M=s.addressEn.toLowerCase().includes(o),T=(l=s.addressZh)==null?void 0:l.toLowerCase().includes(o);if(!f&&!_&&!M&&!T)return!1}return!0}).map(s=>{if(u&&s.latitude&&s.longitude){const r=parseFloat(s.latitude),l=parseFloat(s.longitude);if(!isNaN(r)&&!isNaN(l)){const o=Me(u.lat,u.lng,r,l);return{...s,distance:o}}}return s}).filter(s=>{if(y!=="all"){if(s.distance===void 0)return!1;const r=parseFloat(y);if(s.distance>r)return!1}return!0}).sort((s,r)=>{var T;const l=(T=c==null?void 0:c.pet)==null?void 0:T.lastVisitHospitalId,o=l===s.id,f=l===r.id;if(o&&!f)return-1;if(!o&&f)return 1;if(s.isPartner&&!r.isPartner)return-1;if(!s.isPartner&&r.isPartner)return 1;const _=s.distance!==void 0?s.distance:1/0,M=r.distance!==void 0?r.distance:1/0;return _!==M?_-M:s.open247&&!r.open247?-1:!s.open247&&r.open247?1:0}),Te=(s,r,l)=>{X.trackClinicContact({clinicId:r,contactMethod:"call",clinicName:l}),window.location.href=`tel:${s}`},ze=(s,r,l)=>{X.trackClinicContact({clinicId:r,contactMethod:"whatsapp",clinicName:l});const o=c?`${t("clinic_results.whatsapp_message_emergency","Emergency")}: ${c.symptom}. ${t("clinic_results.whatsapp_message_contact","Contact")}: ${c.contactPhone}`:t("clinic_results.whatsapp_message_request","I need emergency pet care"),f=encodeURIComponent(o);window.open(`https://wa.me/${s.replace(/[^0-9]/g,"")}?text=${f}`,"_blank")},Fe=(s,r,l)=>{const o=`https://www.google.com/maps/search/?api=1&query=${s},${r}`;window.open(o,"_blank")},He=s=>{I(r=>{const l=new Set(r);return l.has(s)?l.delete(s):l.add(s),l})},Oe=()=>{I(new Set)},Be=N.filter(s=>s.distance!==void 0&&s.distance<=5).length,Ke=N.filter(s=>s.open247).length,We=N.filter(s=>s.whatsapp).length,Ne=!!(u!=null&&u.lat&&(u!=null&&u.lng)),Ge=H.filter(s=>s.latitude&&s.longitude).length,R=Ne&&Ge>0;d.useEffect(()=>{!R&&y!=="all"&&j("all")},[R,y]);const ee=he({mutationFn:async()=>{const s=m.size>0?Array.from(m):N.filter(o=>o.whatsapp).map(o=>o.id),r=xe(c,t,H);return await(await oe("POST",`/api/emergency-requests/${n==null?void 0:n.requestId}/broadcast`,{clinicIds:s,message:r})).json()},onSuccess:s=>{de.invalidateQueries({queryKey:["/api/emergency-requests",n==null?void 0:n.requestId]}),X.trackBroadcast({requestId:(n==null?void 0:n.requestId)||"",clinicsCount:s.count,petType:(c==null?void 0:c.petSpecies)||"unknown"}),D({title:t("clinic_results.broadcast_success","Broadcast sent successfully!"),description:a==="zh-HK"?`âœ… æ¯›å­©ç·Šæ€¥é€šçŸ¥å·²ç™¼é€è‡³ ${s.count} é–“è¨ºæ‰€ã€‚é»æ“Šã€ŒæŸ¥çœ‹å»£æ’­ç‹€æ…‹ã€è¿½è¹¤ç™¼é€æƒ…æ³ã€‚`:`âœ… Sent to ${s.count} ${s.count===1?"clinic":"clinics"}. Click "View Broadcast Status" to track delivery.`,duration:8e3}),C(!1),I(new Set),window.scrollTo({top:0,behavior:"smooth"})},onError:s=>{D({title:t("clinic_results.broadcast_failed","Broadcast failed"),description:s.message,variant:"destructive"})}}),Ve=()=>{ee.mutate()},O=m.size>0?m.size:N.filter(s=>s.whatsapp).length,Z=H.filter(s=>s.isAvailable&&s.isPartner&&s.open247&&s.whatsapp),te=he({mutationFn:async()=>{const s=Z.map(o=>o.id);if(s.length===0)throw new Error("No 24-hour support hospitals available");const r=xe(c,t,H);return await(await oe("POST",`/api/emergency-requests/${n==null?void 0:n.requestId}/broadcast`,{clinicIds:s,message:r})).json()},onSuccess:s=>{n!=null&&n.requestId&&de.invalidateQueries({queryKey:["/api/emergency-requests",n.requestId]}),X.trackBroadcast({requestId:(n==null?void 0:n.requestId)||"",clinicsCount:s.count,petType:(c==null?void 0:c.petSpecies)||"unknown"}),D({title:t("clinic_results.broadcast_success","Emergency Alert Sent!"),description:a==="zh-HK"?`âœ… æ¯›å­©ç·Šæ€¥é€šçŸ¥å·²ç™¼é€è‡³ ${s.count} é–“24å°æ™‚è¨ºæ‰€ã€‚é»æ“Šã€ŒæŸ¥çœ‹å»£æ’­ç‹€æ…‹ã€è¿½è¹¤ç™¼é€æƒ…æ³ã€‚`:`âœ… Broadcast sent to ${s.count} 24-hour support ${s.count===1?"hospital":"hospitals"}. Click "View Broadcast Status" to track delivery.`,duration:8e3}),window.scrollTo({top:0,behavior:"smooth"})},onError:s=>{D({title:t("clinic_results.broadcast_failed","Broadcast failed"),description:s.message,variant:"destructive"})}}),se=he({mutationFn:async s=>await(await oe("PATCH",`/api/emergency-requests/${n==null?void 0:n.requestId}`,s)).json(),onSuccess:()=>{de.invalidateQueries({queryKey:["/api/emergency-requests",n==null?void 0:n.requestId]}),D({title:t("clinic_results.edit_success","Emergency request updated"),description:t("clinic_results.edit_success_description","Your changes have been saved successfully.")}),Y(!1)},onError:s=>{D({title:t("clinic_results.edit_failed","Update failed"),description:s.message,variant:"destructive"})}}),Ue=()=>{c&&(W({contactName:c.contactName||"",contactPhone:c.contactPhone||"",symptom:c.symptom||"",manualLocation:c.manualLocation||"",locationLatitude:c.locationLatitude?parseFloat(c.locationLatitude):void 0,locationLongitude:c.locationLongitude?parseFloat(c.locationLongitude):void 0}),G(null),Y(!0))},Ye=()=>{"geolocation"in navigator?(q(!0),G(null),navigator.geolocation.getCurrentPosition(s=>{W(r=>({...r,locationLatitude:s.coords.latitude,locationLongitude:s.coords.longitude,manualLocation:""})),q(!1),G(null),D({title:t("emergency.gps.success","Location Detected"),description:t("emergency.gps.success_desc","Your GPS location has been detected successfully")})},s=>{q(!1),G(t("emergency.gps.error","Unable to detect location. Please check your location permissions."))})):G(t("emergency.gps.not_supported","Geolocation is not supported by this browser"))},Ze=()=>{se.mutate(p)};return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx("header",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 sticky top-0 z-10",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:t("clinic_results.title","Emergency Clinic Results")}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[N.length," ",t("clinic_results.clinics_found",N.length===1?"clinic found":"clinics found")]})]}),e.jsx(ye,{href:"/",children:e.jsx(b,{variant:"outline","data-testid":"button-home",children:t("common.home","Home")})})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-6 space-y-6",children:[c&&e.jsx(k,{className:"bg-red-50 dark:bg-red-950 border-red-200 dark:border-red-800","data-testid":"card-emergency-summary",children:e.jsx(ie,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(nt,{className:"h-6 w-6 text-red-600 dark:text-red-400 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(ne,{className:"text-lg text-red-900 dark:text-red-100",children:t("clinic_results.emergency_request","Emergency Request")}),e.jsxs(b,{variant:"ghost",size:"sm",onClick:Ue,className:"text-red-700 dark:text-red-300 hover:text-red-900 dark:hover:text-red-100","data-testid":"button-edit-request",children:[e.jsx(Ct,{className:"h-4 w-4 mr-1"}),t("common.edit","Edit")]})]}),e.jsxs("p",{className:"text-sm text-red-700 dark:text-red-300 mt-2",children:[e.jsxs("strong",{children:[t("clinic_results.symptoms","Symptoms"),":"]})," ",c.symptom]}),c.petSpecies&&e.jsxs("p",{className:"text-sm text-red-700 dark:text-red-300 mt-1","data-testid":"text-pet-details",children:[e.jsxs("strong",{children:[t("clinic_results.pet","Pet"),":"]})," ",c.petSpecies,c.petBreed&&`, ${c.petBreed}`,c.petAge&&` (${c.petAge} ${t("common.years","years")})`]}),c.manualLocation&&e.jsxs("p",{className:"text-sm text-red-700 dark:text-red-300 mt-1",children:[e.jsxs("strong",{children:[t("clinic_results.location","Location"),":"]})," ",c.manualLocation]}),e.jsxs("p",{className:"text-sm text-red-700 dark:text-red-300 mt-1",children:[e.jsxs("strong",{children:[t("clinic_results.contact","Contact"),":"]})," ",c.contactPhone,c.contactName&&` (${c.contactName})`]})]})]})})}),c&&Z.length>0&&(n==null?void 0:n.requestId)&&e.jsx(k,{className:"bg-gradient-to-r from-red-600 to-red-700 dark:from-red-700 dark:to-red-800 border-0 shadow-lg","data-testid":"card-quick-broadcast",children:e.jsx(E,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-4 text-white",children:[e.jsx(me,{className:"h-10 w-10 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold mb-1",children:["ğŸš¨ ",t("emergency.instant_broadcast_title","INSTANT EMERGENCY BROADCAST")]}),e.jsx("p",{className:"text-sm text-red-50",children:t("emergency.instant_broadcast_desc","Send alert to {count} available 24-hour support {plural} NOW").replace("{count}",String(Z.length)).replace("{plural}",Z.length===1?"hospital":"hospitals")}),e.jsxs("p",{className:"text-xs text-red-100 mt-2",children:["âš¡ ",t("emergency.instant_broadcast_tip","Fastest way to get help - One click to reach all partner hospitals")]})]})]}),e.jsx(b,{size:"lg",onClick:()=>te.mutate(),disabled:te.isPending,className:"bg-white text-red-600 hover:bg-red-50 font-bold text-lg px-8 py-6 shadow-xl hover:shadow-2xl transition-all","data-testid":"button-quick-broadcast",children:te.isPending?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-5 w-5 mr-2 animate-spin"}),t("common.sending","Sending...")]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"h-5 w-5 mr-2"}),t("emergency.instant_broadcast_button","BROADCAST NOW")]})})]})})}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[e.jsx(k,{"data-testid":"stat-total",className:"shadow-sm",children:e.jsx(E,{className:"pt-4 pb-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:N.length}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-0.5",children:t("clinic_results.total_clinics","Total Clinics")})]})})}),e.jsx(k,{"data-testid":"stat-24hour",className:"shadow-sm",children:e.jsx(E,{className:"pt-4 pb-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:Ke}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-0.5",children:t("clinic_results.24hour","24-Hour")})]})})}),e.jsx(k,{"data-testid":"stat-whatsapp",className:"shadow-sm",children:e.jsx(E,{className:"pt-4 pb-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:We}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-0.5",children:t("clinic_results.whatsapp","WhatsApp")})]})})}),e.jsx(k,{"data-testid":"stat-nearby",className:"shadow-sm",children:e.jsx(E,{className:"pt-4 pb-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:Be}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-0.5",children:t("clinic_results.within_5km","Within 5km")})]})})})]}),e.jsxs(k,{"data-testid":"card-filters",children:[e.jsx(ie,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ne,{className:"text-lg",children:t("clinic_results.filters_search","Filters & Search")}),e.jsxs(b,{variant:"ghost",size:"sm",onClick:()=>g(!K),"data-testid":"button-toggle-filters",children:[e.jsx(wt,{className:"h-4 w-4 mr-2"}),K?t("clinic_results.hide_filters","Hide Filters"):t("clinic_results.show_filters","Show Filters")]})]})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(vt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(Q,{placeholder:t("clinic_results.search_placeholder","Search clinics by name or address..."),value:A,onChange:s=>S(s.target.value),className:"pl-10","data-testid":"input-search"})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-1",children:[e.jsx(ue,{id:"24hour-quick-filter",checked:$,onCheckedChange:z,"data-testid":"switch-24hour-quick"}),e.jsxs(w,{htmlFor:"24hour-quick-filter",className:"cursor-pointer font-medium",children:[e.jsx(ke,{className:"inline h-4 w-4 mr-1.5 text-green-600"}),t("clinic_results.24hour_only","24-Hour Clinics Only")]})]}),K&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 pt-2",children:[e.jsxs("div",{children:[e.jsx(w,{className:"text-sm mb-2 block",children:t("clinic_results.region","Region")}),e.jsxs(ce,{value:i,onValueChange:v,children:[e.jsx(re,{"data-testid":"select-region",children:e.jsx(le,{placeholder:t("clinic_results.all_regions","All Regions")})}),e.jsxs(we,{children:[e.jsx(B,{value:"all",children:t("clinic_results.all_regions","All Regions")}),je.map(s=>e.jsx(B,{value:s.code,children:a==="zh-HK"?s.nameZh:s.nameEn},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx(w,{className:"text-sm mb-2 block",children:t("clinic_results.distance","Distance")}),R?e.jsxs(ce,{value:y,onValueChange:j,children:[e.jsx(re,{"data-testid":"select-distance",children:e.jsx(le,{placeholder:t("clinic_results.any_distance","Any Distance")})}),e.jsxs(we,{children:[e.jsx(B,{value:"all",children:t("clinic_results.any_distance","Any Distance")}),e.jsx(B,{value:"5",children:t("clinic_results.within_5km","Within 5 km")}),e.jsx(B,{value:"10",children:t("clinic_results.within_10km","Within 10 km")}),e.jsx(B,{value:"15",children:t("clinic_results.within_15km","Within 15 km")})]})]}):e.jsxs("div",{children:[e.jsx(ce,{disabled:!0,value:"all",children:e.jsx(re,{"data-testid":"select-distance-disabled",className:"opacity-50",children:e.jsx(le,{placeholder:t("clinic_results.gps_not_available","GPS Not Available")})})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:Ne?t("clinic_results.no_gps_data","No clinic GPS data available"):t("clinic_results.enable_gps","Enable GPS on Step 2 for distance filtering")})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-6",children:[e.jsx(ue,{id:"24hour-filter",checked:$,onCheckedChange:z,"data-testid":"switch-24hour"}),e.jsx(w,{htmlFor:"24hour-filter",className:"cursor-pointer",children:t("clinic_results.24hour_only_short","24-Hour Only")})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-6",children:[e.jsx(ue,{id:"whatsapp-filter",checked:F,onCheckedChange:U,"data-testid":"switch-whatsapp"}),e.jsx(w,{htmlFor:"whatsapp-filter",className:"cursor-pointer",children:t("clinic_results.whatsapp_only","WhatsApp Only")})]})]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsx("div",{className:"flex-1",children:m.size>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(V,{variant:"secondary",className:"text-sm",children:[m.size," ",t("clinic_results.clinics_selected",m.size!==1?"clinics selected":"clinic selected")]}),e.jsx(b,{variant:"ghost",size:"sm",onClick:Oe,"data-testid":"button-deselect-all",children:t("clinic_results.clear_selection","Clear Selection")})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(ye,{href:`/emergency-results/${n==null?void 0:n.requestId}/messages`,children:e.jsxs(b,{variant:"outline",className:"border-blue-500 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-950","data-testid":"button-view-status",children:[e.jsx(kt,{className:"h-4 w-4 mr-2"}),t("clinic_results.view_status","View Broadcast Status")]})}),e.jsxs(b,{onClick:()=>C(!0),className:"bg-orange-600 hover:bg-orange-700",disabled:O===0,"data-testid":"button-broadcast",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),t("clinic_results.broadcast","Broadcast")," ",m.size>0?`(${m.size})`:t("clinic_results.to_all","to All")]})]})]}),e.jsx("div",{className:"space-y-4",children:N.length===0?e.jsx(k,{children:e.jsxs(E,{className:"p-12 text-center",children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-lg mb-2",children:t("clinic_results.no_clinics","No clinics found")}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:t("clinic_results.adjust_filters","Try adjusting your filters or search criteria")})]})}):N.map((s,r)=>{var _;const l=m.has(s.id),o=!!s.whatsapp,f=((_=c==null?void 0:c.pet)==null?void 0:_.lastVisitHospitalId)===s.id;return e.jsxs(k,{className:`hover:shadow-lg transition-all border-l-4 border-l-red-600 ${l?"ring-2 ring-orange-500":""} ${f?"ring-2 ring-amber-400 dark:ring-amber-500":""}`,"data-testid":`card-clinic-${s.id}`,children:[e.jsx(ie,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[o&&e.jsx("div",{className:"pt-1",children:e.jsx(De,{checked:l,onCheckedChange:()=>He(s.id),"data-testid":`checkbox-clinic-${s.id}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[f&&e.jsxs(V,{className:"bg-gradient-to-r from-amber-500 to-orange-500 mb-2 font-bold","data-testid":`badge-existing-patient-${s.id}`,children:["â­ ",t("clinic_results.existing_patient_badge","EXISTING PATIENT - Medical Records Available")]}),s.isPartner&&!f&&e.jsx(V,{className:"bg-gradient-to-r from-purple-600 to-blue-600 mb-2 font-bold","data-testid":`badge-partner-${s.id}`,children:"â­ PetSOS Partner"}),e.jsxs(ne,{className:"text-lg mb-1 leading-tight",children:[a==="zh-HK"&&s.nameZh?s.nameZh:s.nameEn,a==="zh-HK"&&s.nameZh&&e.jsx("span",{className:"block text-sm font-normal text-gray-500 dark:text-gray-400 mt-0.5",children:s.nameEn})]}),s.distance!==void 0&&e.jsxs("div",{className:"inline-flex items-center gap-1 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 px-2 py-0.5 rounded-full text-xs font-semibold mb-2","data-testid":`text-clinic-distance-${s.id}`,children:[e.jsx(ct,{className:"h-3 w-3"}),s.distance.toFixed(1)," km ",a==="zh-HK"?"è·é›¢":"away"]}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 truncate mb-2","data-testid":`text-clinic-address-${s.id}`,children:a==="zh-HK"&&s.addressZh?s.addressZh:s.addressEn}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:s.whatsapp&&e.jsxs(V,{variant:"outline",className:"bg-green-50 dark:bg-green-950 text-xs",children:[e.jsx(Ce,{className:"h-3 w-3 mr-1"}),"WhatsApp"]})})]}),s.open247&&e.jsxs(V,{className:"bg-red-600 hover:bg-red-700 shrink-0","data-testid":`badge-24hour-${s.id}`,children:[e.jsx(ke,{className:"h-3 w-3 mr-1"}),a==="zh-HK"?"24å°æ™‚":"24hrs"]})]})}),e.jsx(E,{className:"pt-0",children:e.jsxs("div",{className:"flex gap-2",children:[s.phone&&e.jsxs(b,{onClick:()=>Te(s.phone,s.id,s.nameEn),size:"sm",className:"flex-1 bg-red-600 hover:bg-red-700","data-testid":`button-call-${s.id}`,children:[e.jsx(rt,{className:"h-4 w-4 mr-1"}),a==="zh-HK"?"è‡´é›»":"Call"]}),s.whatsapp&&e.jsxs(b,{onClick:()=>ze(s.whatsapp,s.id,s.nameEn),variant:"outline",size:"sm",className:"flex-1 border-red-600 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20","data-testid":`button-whatsapp-${s.id}`,children:[e.jsx(Ce,{className:"h-4 w-4 mr-1"}),"WhatsApp"]}),s.latitude&&s.longitude&&e.jsxs(b,{onClick:()=>Fe(s.latitude,s.longitude,s.nameEn),variant:"outline",size:"sm",className:"flex-1 border-red-600 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20","data-testid":`button-maps-${s.id}`,children:[e.jsx(Se,{className:"h-4 w-4 mr-1"}),a==="zh-HK"?"å°èˆª":"Maps"]})]})})]},s.id)})}),e.jsx("div",{className:"mt-8 p-4 bg-amber-50 dark:bg-amber-950 rounded-lg text-center",children:e.jsx("p",{className:"text-amber-800 dark:text-amber-200 text-sm",children:t("app.disclaimer","âš ï¸ PetSOS provides emergency guidance only and is not medical advice. If in doubt, contact a vet immediately.")})})]}),e.jsx(lt,{open:x,onOpenChange:C,children:e.jsxs(ot,{className:"max-w-2xl",children:[e.jsxs(dt,{children:[e.jsx(ht,{children:m.size>0?t("clinic_results.broadcast_to_selected","Broadcast to Selected Clinics"):t("clinic_results.broadcast_emergency","Broadcast Emergency Alert")}),e.jsx(ut,{asChild:!0,children:e.jsxs("div",{children:[e.jsx("p",{className:"mb-4",children:m.size>0?e.jsx(e.Fragment,{children:t("clinic_results.broadcast_desc_selected",`This will send your emergency alert to ${O} selected ${O===1?"clinic":"clinics"} via WhatsApp and email.`)}):e.jsx(e.Fragment,{children:t("clinic_results.broadcast_desc_all",`This will send your emergency alert to all ${O} clinics via WhatsApp and email.`)})}),m.size===0&&e.jsx("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-950 rounded border border-blue-200 dark:border-blue-800",children:e.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:t("clinic_results.broadcast_tip","ğŸ’¡ Tip: Select specific clinics using the checkboxes to send a targeted broadcast")})}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-4 rounded-lg",children:[e.jsxs("strong",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:[t("clinic_results.message_preview","Message Preview"),":"]}),e.jsx("pre",{className:"mt-2 text-sm text-gray-900 dark:text-gray-100 whitespace-pre-wrap font-sans",children:xe(c,t,H)})]})]})})]}),e.jsxs(mt,{children:[e.jsx(xt,{"data-testid":"button-cancel-broadcast",children:t("common.cancel","Cancel")}),e.jsxs(pt,{onClick:Ve,disabled:ee.isPending,className:"bg-orange-600 hover:bg-orange-700","data-testid":"button-confirm-broadcast",children:[ee.isPending&&e.jsx(J,{className:"h-4 w-4 mr-2 animate-spin"}),t("clinic_results.send_to_clinics",`Send to ${O} ${O===1?"Clinic":"Clinics"}`)]})]})]})}),e.jsx(gt,{open:L,onOpenChange:Y,children:e.jsxs(ft,{className:"max-w-md",children:[e.jsxs(bt,{children:[e.jsx(jt,{children:a==="zh-HK"?"ç·¨è¼¯ç·Šæ€¥æ±‚åŠ©è³‡æ–™":"Edit Emergency Request"}),e.jsx(Nt,{children:a==="zh-HK"?"æ›´æ–°æ‚¨çš„ç·Šæ€¥æ±‚åŠ©è³‡æ–™ã€‚è®Šæ›´å°‡åæ˜ åœ¨æœªä¾†çš„å»£æ’­è¨Šæ¯ä¸­ã€‚":"Update your emergency request details. Changes will be reflected in future broadcasts."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(w,{htmlFor:"edit-contact-name",children:a==="zh-HK"?"è¯çµ¡äººå§“å":"Contact Name"}),e.jsx(Q,{id:"edit-contact-name",value:p.contactName,onChange:s=>W({...p,contactName:s.target.value}),placeholder:t("emergency.name_placeholder","Your name"),"data-testid":"input-edit-contact-name"})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"edit-contact-phone",children:a==="zh-HK"?"è¯çµ¡é›»è©±":"Contact Phone"}),e.jsx(Q,{id:"edit-contact-phone",value:p.contactPhone,onChange:s=>W({...p,contactPhone:s.target.value}),placeholder:t("emergency.phone_placeholder","+852 1234 5678"),"data-testid":"input-edit-contact-phone"})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"edit-symptom",className:"text-gray-700 dark:text-gray-300",children:a==="zh-HK"?"ç—‡ç‹€":"Symptoms"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:p.symptom})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"edit-location",className:"text-gray-700 dark:text-gray-300",children:a==="zh-HK"?"ä½ç½®":"Location"}),e.jsx(b,{type:"button",variant:"outline",className:"w-full mt-2 mb-2",onClick:Ye,disabled:fe,"data-testid":"button-use-gps",children:fe?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4 mr-2 animate-spin"}),a==="zh-HK"?"åµæ¸¬ä½ç½®ä¸­...":"Detecting location..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),a==="zh-HK"?"ä½¿ç”¨ GPS å®šä½":"Use GPS Location"]})}),p.locationLatitude&&p.locationLongitude&&e.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400 mb-2 flex items-center gap-1",children:[e.jsx(yt,{className:"h-3 w-3"}),a==="zh-HK"?`GPS ä½ç½®å·²åµæ¸¬: ${p.locationLatitude.toFixed(6)}, ${p.locationLongitude.toFixed(6)}`:`GPS location detected: ${p.locationLatitude.toFixed(6)}, ${p.locationLongitude.toFixed(6)}`]}),be&&e.jsx("div",{className:"text-xs text-red-600 dark:text-red-400 mb-2",children:be}),e.jsx(Q,{id:"edit-location",value:p.manualLocation,onChange:s=>W({...p,manualLocation:s.target.value}),placeholder:a==="zh-HK"?"åœ°å€æˆ–åœ°å€":"Area or address","data-testid":"input-edit-location"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:a==="zh-HK"?"ä½¿ç”¨ GPS æˆ–æ‰‹å‹•è¼¸å…¥åœ°å€":"Use GPS or manually enter address"})]})]}),e.jsxs(_t,{children:[e.jsx(b,{variant:"outline",onClick:()=>Y(!1),"data-testid":"button-cancel-edit",children:a==="zh-HK"?"å–æ¶ˆ":"Cancel"}),e.jsxs(b,{onClick:Ze,disabled:se.isPending,"data-testid":"button-save-edit",children:[se.isPending&&e.jsx(J,{className:"h-4 w-4 mr-2 animate-spin"}),a==="zh-HK"?"å„²å­˜è®Šæ›´":"Save Changes"]})]})]})})]})}export{Zt as default};
