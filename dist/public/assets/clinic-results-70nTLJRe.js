import{c as le,u as Fe,T as He,r as h,a as Oe,h as Q,j as e,U as pe,B as p,C as N,q as X,d as Be,t as J,b as v,I as D,V as _,W as ge,E as q,G as R,H as ee,J as je,K as S,M as Ke,N as We,X as Ge,Y as Ve,_ as Ue,$ as Ye,a0 as Ze,a1 as Qe,R as T,O as te,Q as se}from"./index-Dv-87GdI.js";import{u as ae}from"./useMutation-DhbY-5L1.js";import{B as L}from"./badge-95hAwcnP.js";import{S as ie}from"./switch-DNY1qyBa.js";import{C as Xe}from"./checkbox-CR9TChmH.js";import{A as Je,a as qe,b as Re,c as et,d as tt,e as st,f as at,g as it}from"./alert-dialog-phmvSypz.js";import{S as ne}from"./send-CUMU5RIS.js";import{L as z}from"./loader-circle-B-JBmTN-.js";import{S as nt}from"./search-BPoAccfe.js";import{M as fe}from"./message-circle-DeM5z3Tc.js";import{N as be}from"./navigation-BW4ViPl5.js";import{C as ct}from"./circle-check-C1_Cff8L.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=le("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=le("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=le("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);function ot(s){if(!s)return"";const a=s.replace(/\D/g,"");if(!a)return s;if(a.startsWith("852")&&a.length===11)return`+852 ${a.slice(3,7)} ${a.slice(7)}`;if(a.length===8&&!a.startsWith("0"))return`+852 ${a.slice(0,4)} ${a.slice(4)}`;if(a.startsWith("86")&&a.length===13)return`+86 ${a.slice(2,5)} ${a.slice(5,9)} ${a.slice(9)}`;if(a.startsWith("1")&&a.length===11)return`+1 ${a.slice(1,4)} ${a.slice(4,7)} ${a.slice(7)}`;if(a.startsWith("44")&&a.length>=12)return`+44 ${a.slice(2,6)} ${a.slice(6)}`;if(a.length>10){const c=a.slice(0,a.length-10),i=a.slice(a.length-10);return`+${c} ${i.slice(0,3)} ${i.slice(3,6)} ${i.slice(6)}`}return a.length>=10?`+${a}`:s}function ce(s,a,c){var g;if(!s)return a("clinic_results.emergency_care_needed","Emergency pet care needed");const i=[];if(i.push(`ğŸš¨ ${a("clinic_results.broadcast_alert_title","PET EMERGENCY ALERT")} ğŸš¨`),i.push(""),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`ğŸ“‹ ${a("clinic_results.pet_info_section","PET INFORMATION")}`),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),s.pet){const o=s.pet;o.name&&i.push(`${a("clinic_results.name","Name")}: ${o.name}`);let j=s.petSpecies||"";s.petBreed&&(j+=`, ${s.petBreed}`),s.petAge&&(j+=`, ${s.petAge} ${a("common.years","years")}`),o.weight&&(j+=`, ${o.weight}${a("clinic_results.weight_kg","kg")}`),j&&i.push(`${a("clinic_results.details","Details")}: ${j}`),o.medicalNotes&&o.medicalNotes.trim()&&i.push(`âš ï¸ ${a("clinic_results.medical_history","Medical History")}: ${o.medicalNotes}`)}else{let o=s.petSpecies||"";s.petBreed&&(o+=`, ${s.petBreed}`),s.petAge&&(o+=`, ${s.petAge} ${a("common.years","years")}`),i.push(`${a("clinic_results.pet","Pet")}: ${o}`)}i.push(""),s.voiceTranscript&&s.aiAnalyzedSymptoms?(i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`ğŸ¤– ${a("clinic_results.ai_analysis_section","AI EMERGENCY ANALYSIS")}`),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(s.aiAnalyzedSymptoms),i.push(""),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`ğŸ¤ ${a("clinic_results.owner_description","OWNER'S DESCRIPTION")}`),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`"${s.voiceTranscript}"`),i.push(""),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`ğŸ“ ${a("clinic_results.summary_section","SYMPTOM SUMMARY")}`),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(s.symptom),i.push("")):s.voiceTranscript?(i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`ğŸ¤ ${a("clinic_results.voice_description","VOICE DESCRIPTION")}`),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`"${s.voiceTranscript}"`),i.push(""),i.push(`${a("clinic_results.symptoms","Symptoms")}: ${s.symptom}`),i.push("")):(i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`ğŸš¨ ${a("clinic_results.emergency_section","EMERGENCY DETAILS")}`),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`${a("clinic_results.symptoms","Symptoms")}: ${s.symptom}`),i.push("")),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`ğŸ“ ${a("clinic_results.contact_section","CONTACT INFORMATION")}`),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");const F=ot(s.contactPhone);if(i.push(`${a("clinic_results.phone","Phone")}: ${F}`),s.contactEmail&&i.push(`${a("common.email","Email")}: ${s.contactEmail}`),s.contactName&&i.push(`${a("clinic_results.name","Name")}: ${s.contactName}`),i.push(""),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(`ğŸ“ ${a("clinic_results.location_section","LOCATION")}`),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),s.locationLatitude&&s.locationLongitude){const o=`https://www.google.com/maps?q=${s.locationLatitude},${s.locationLongitude}`;s.locationText&&i.push(s.locationText),i.push(`GPS: ${s.locationLatitude}, ${s.locationLongitude}`),i.push(`${a("clinic_results.map","Map")}: ${o}`)}else s.locationText?i.push(s.locationText):i.push(a("clinic_results.location_not_provided","Location not provided"));if((g=s==null?void 0:s.pet)!=null&&g.lastVisitHospitalId){const o=c.find(j=>j.id===s.pet.lastVisitHospitalId);if(o){if(i.push(""),i.push(`ğŸ“‹ ${a("clinic_results.regular_clinic_note","NOTE: This pet is a registered patient at")} ${o.nameEn}`),s.pet.lastVisitDate){const j=new Date(s.pet.lastVisitDate).toLocaleDateString();i.push(`${a("clinic_results.last_visit","Last visit")}: ${j}`)}i.push(a("clinic_results.medical_records_available","Medical records may be available there for reference."))}}return i.push(""),i.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),i.push(a("clinic_results.broadcast_alert_footer","Please respond urgently if you can help.")),i.join(`
`)}function wt(){const{t:s,language:a}=Fe(),[,c]=He("/emergency-results/:requestId"),[i,F]=h.useState("all"),[g,o]=h.useState(null),[j,H]=h.useState(!1),[O,Ne]=h.useState(""),[E,re]=h.useState("all"),[B,de]=h.useState(!0),[oe,_e]=h.useState(!1),[m,K]=h.useState(new Set),[W,ve]=h.useState(!1),[ye,I]=h.useState(!1),[u,P]=h.useState({contactName:"",contactPhone:"",symptom:"",manualLocation:"",locationLatitude:void 0,locationLongitude:void 0}),[he,G]=h.useState(!1),[ue,A]=h.useState(null),{toast:y}=Oe(),{data:n}=Q({queryKey:["/api/emergency-requests",c==null?void 0:c.requestId],enabled:!!(c!=null&&c.requestId)}),{data:me=[]}=Q({queryKey:["/api/regions"]}),{data:$=[]}=Q({queryKey:["/api/hospitals"]});h.useEffect(()=>{n!=null&&n.locationLatitude&&(n!=null&&n.locationLongitude)&&o({lat:parseFloat(n.locationLatitude),lng:parseFloat(n.locationLongitude)})},[n]);const we=(t,l,r,d)=>{const b=(r-t)*Math.PI/180,w=(d-l)*Math.PI/180,k=Math.sin(b/2)*Math.sin(b/2)+Math.cos(t*Math.PI/180)*Math.cos(r*Math.PI/180)*Math.sin(w/2)*Math.sin(w/2);return 6371*(2*Math.atan2(Math.sqrt(k),Math.sqrt(1-k)))},f=$.filter(t=>{var l,r;if(!t.isAvailable)return!1;if(i!=="all"){const d=me.find(x=>x.code===i);if(d&&t.regionId!==d.id)return!1}if(B&&!t.open247||oe&&!t.whatsapp)return!1;if(O){const d=O.toLowerCase(),x=t.nameEn.toLowerCase().includes(d),b=(l=t.nameZh)==null?void 0:l.toLowerCase().includes(d),w=t.addressEn.toLowerCase().includes(d),k=(r=t.addressZh)==null?void 0:r.toLowerCase().includes(d);if(!x&&!b&&!w&&!k)return!1}return!0}).map(t=>{if(g&&t.latitude&&t.longitude){const l=parseFloat(t.latitude),r=parseFloat(t.longitude);if(!isNaN(l)&&!isNaN(r)){const d=we(g.lat,g.lng,l,r);return{...t,distance:d}}}return t}).filter(t=>{if(E!=="all"){if(t.distance===void 0)return!1;const l=parseFloat(E);if(t.distance>l)return!1}return!0}).sort((t,l)=>{var k;const r=(k=n==null?void 0:n.pet)==null?void 0:k.lastVisitHospitalId,d=r===t.id,x=r===l.id;if(d&&!x)return-1;if(!d&&x)return 1;if(t.isPartner&&!l.isPartner)return-1;if(!t.isPartner&&l.isPartner)return 1;const b=t.distance!==void 0?t.distance:1/0,w=l.distance!==void 0?l.distance:1/0;return b!==w?b-w:t.open247&&!l.open247?-1:!t.open247&&l.open247?1:0}),ke=(t,l,r)=>{T.trackClinicContact({clinicId:l,contactMethod:"call",clinicName:r}),window.location.href=`tel:${t}`},$e=(t,l,r)=>{T.trackClinicContact({clinicId:l,contactMethod:"whatsapp",clinicName:r});const d=n?`${s("clinic_results.whatsapp_message_emergency","Emergency")}: ${n.symptom}. ${s("clinic_results.whatsapp_message_contact","Contact")}: ${n.contactPhone}`:s("clinic_results.whatsapp_message_request","I need emergency pet care"),x=encodeURIComponent(d);window.open(`https://wa.me/${t.replace(/[^0-9]/g,"")}?text=${x}`,"_blank")},Ce=(t,l,r)=>{const d=`https://www.google.com/maps/search/?api=1&query=${t},${l}`;window.open(d,"_blank")},Se=t=>{K(l=>{const r=new Set(l);return r.has(t)?r.delete(t):r.add(t),r})},Ee=()=>{K(new Set)},Pe=f.filter(t=>t.distance!==void 0&&t.distance<=5).length,Ae=f.filter(t=>t.open247).length,Le=f.filter(t=>t.whatsapp).length,xe=!!(g!=null&&g.lat&&(g!=null&&g.lng)),Ie=$.filter(t=>t.latitude&&t.longitude).length,V=xe&&Ie>0;h.useEffect(()=>{!V&&E!=="all"&&re("all")},[V,E]);const U=ae({mutationFn:async()=>{const t=m.size>0?Array.from(m):f.filter(d=>d.whatsapp).map(d=>d.id),l=ce(n,s,$);return await(await te("POST",`/api/emergency-requests/${c==null?void 0:c.requestId}/broadcast`,{clinicIds:t,message:l})).json()},onSuccess:t=>{se.invalidateQueries({queryKey:["/api/emergency-requests",c==null?void 0:c.requestId]}),T.trackBroadcast({requestId:(c==null?void 0:c.requestId)||"",clinicsCount:t.count,petType:(n==null?void 0:n.petSpecies)||"unknown"}),y({title:s("clinic_results.broadcast_success","Broadcast sent successfully!"),description:a==="zh-HK"?`âœ… æ¯›å­©ç·Šæ€¥é€šçŸ¥å·²ç™¼é€è‡³ ${t.count} é–“è¨ºæ‰€ã€‚é»æ“Šã€ŒæŸ¥çœ‹å»£æ’­ç‹€æ…‹ã€è¿½è¹¤ç™¼é€æƒ…æ³ã€‚`:`âœ… Sent to ${t.count} ${t.count===1?"clinic":"clinics"}. Click "View Broadcast Status" to track delivery.`,duration:8e3}),H(!1),K(new Set),window.scrollTo({top:0,behavior:"smooth"})},onError:t=>{y({title:s("clinic_results.broadcast_failed","Broadcast failed"),description:t.message,variant:"destructive"})}}),Me=()=>{U.mutate()},C=m.size>0?m.size:f.filter(t=>t.whatsapp).length,M=$.filter(t=>t.isAvailable&&t.isPartner&&t.open247&&t.whatsapp),Y=ae({mutationFn:async()=>{const t=M.map(d=>d.id);if(t.length===0)throw new Error("No 24-hour support hospitals available");const l=ce(n,s,$);return await(await te("POST",`/api/emergency-requests/${c==null?void 0:c.requestId}/broadcast`,{clinicIds:t,message:l})).json()},onSuccess:t=>{c!=null&&c.requestId&&se.invalidateQueries({queryKey:["/api/emergency-requests",c.requestId]}),T.trackBroadcast({requestId:(c==null?void 0:c.requestId)||"",clinicsCount:t.count,petType:(n==null?void 0:n.petSpecies)||"unknown"}),y({title:s("clinic_results.broadcast_success","Emergency Alert Sent!"),description:a==="zh-HK"?`âœ… æ¯›å­©ç·Šæ€¥é€šçŸ¥å·²ç™¼é€è‡³ ${t.count} é–“24å°æ™‚è¨ºæ‰€ã€‚é»æ“Šã€ŒæŸ¥çœ‹å»£æ’­ç‹€æ…‹ã€è¿½è¹¤ç™¼é€æƒ…æ³ã€‚`:`âœ… Broadcast sent to ${t.count} 24-hour support ${t.count===1?"hospital":"hospitals"}. Click "View Broadcast Status" to track delivery.`,duration:8e3}),window.scrollTo({top:0,behavior:"smooth"})},onError:t=>{y({title:s("clinic_results.broadcast_failed","Broadcast failed"),description:t.message,variant:"destructive"})}}),Z=ae({mutationFn:async t=>await(await te("PATCH",`/api/emergency-requests/${c==null?void 0:c.requestId}`,t)).json(),onSuccess:()=>{se.invalidateQueries({queryKey:["/api/emergency-requests",c==null?void 0:c.requestId]}),y({title:s("clinic_results.edit_success","Emergency request updated"),description:s("clinic_results.edit_success_description","Your changes have been saved successfully.")}),I(!1)},onError:t=>{y({title:s("clinic_results.edit_failed","Update failed"),description:t.message,variant:"destructive"})}}),De=()=>{n&&(P({contactName:n.contactName||"",contactPhone:n.contactPhone||"",symptom:n.symptom||"",manualLocation:n.manualLocation||"",locationLatitude:n.locationLatitude?parseFloat(n.locationLatitude):void 0,locationLongitude:n.locationLongitude?parseFloat(n.locationLongitude):void 0}),A(null),I(!0))},Te=()=>{"geolocation"in navigator?(G(!0),A(null),navigator.geolocation.getCurrentPosition(t=>{P(l=>({...l,locationLatitude:t.coords.latitude,locationLongitude:t.coords.longitude,manualLocation:""})),G(!1),A(null),y({title:s("emergency.gps.success","Location Detected"),description:s("emergency.gps.success_desc","Your GPS location has been detected successfully")})},t=>{G(!1),A(s("emergency.gps.error","Unable to detect location. Please check your location permissions."))})):A(s("emergency.gps.not_supported","Geolocation is not supported by this browser"))},ze=()=>{Z.mutate(u)};return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx("header",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 sticky top-0 z-10",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s("clinic_results.title","Emergency Clinic Results")}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[f.length," ",s("clinic_results.clinics_found",f.length===1?"clinic found":"clinics found")]})]}),e.jsx(pe,{href:"/",children:e.jsx(p,{variant:"outline","data-testid":"button-home",children:s("common.home","Home")})})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-6 space-y-6",children:[n&&e.jsx(N,{className:"bg-red-50 dark:bg-red-950 border-red-200 dark:border-red-800","data-testid":"card-emergency-summary",children:e.jsx(X,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Be,{className:"h-6 w-6 text-red-600 dark:text-red-400 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(J,{className:"text-lg text-red-900 dark:text-red-100",children:s("clinic_results.emergency_request","Emergency Request")}),e.jsxs(p,{variant:"ghost",size:"sm",onClick:De,className:"text-red-700 dark:text-red-300 hover:text-red-900 dark:hover:text-red-100","data-testid":"button-edit-request",children:[e.jsx(dt,{className:"h-4 w-4 mr-1"}),s("common.edit","Edit")]})]}),e.jsxs("p",{className:"text-sm text-red-700 dark:text-red-300 mt-2",children:[e.jsxs("strong",{children:[s("clinic_results.symptoms","Symptoms"),":"]})," ",n.symptom]}),n.petSpecies&&e.jsxs("p",{className:"text-sm text-red-700 dark:text-red-300 mt-1","data-testid":"text-pet-details",children:[e.jsxs("strong",{children:[s("clinic_results.pet","Pet"),":"]})," ",n.petSpecies,n.petBreed&&`, ${n.petBreed}`,n.petAge&&` (${n.petAge} ${s("common.years","years")})`]}),n.manualLocation&&e.jsxs("p",{className:"text-sm text-red-700 dark:text-red-300 mt-1",children:[e.jsxs("strong",{children:[s("clinic_results.location","Location"),":"]})," ",n.manualLocation]}),e.jsxs("p",{className:"text-sm text-red-700 dark:text-red-300 mt-1",children:[e.jsxs("strong",{children:[s("clinic_results.contact","Contact"),":"]})," ",n.contactPhone,n.contactName&&` (${n.contactName})`]})]})]})})}),n&&M.length>0&&(c==null?void 0:c.requestId)&&e.jsx(N,{className:"bg-gradient-to-r from-red-600 to-red-700 dark:from-red-700 dark:to-red-800 border-0 shadow-lg","data-testid":"card-quick-broadcast",children:e.jsx(v,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-4 text-white",children:[e.jsx(ne,{className:"h-10 w-10 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold mb-1",children:["ğŸš¨ ",s("emergency.instant_broadcast_title","INSTANT EMERGENCY BROADCAST")]}),e.jsx("p",{className:"text-sm text-red-50",children:s("emergency.instant_broadcast_desc","Send alert to {count} available 24-hour support {plural} NOW").replace("{count}",String(M.length)).replace("{plural}",M.length===1?"hospital":"hospitals")}),e.jsxs("p",{className:"text-xs text-red-100 mt-2",children:["âš¡ ",s("emergency.instant_broadcast_tip","Fastest way to get help - One click to reach all partner hospitals")]})]})]}),e.jsx(p,{size:"lg",onClick:()=>Y.mutate(),disabled:Y.isPending,className:"bg-white text-red-600 hover:bg-red-50 font-bold text-lg px-8 py-6 shadow-xl hover:shadow-2xl transition-all","data-testid":"button-quick-broadcast",children:Y.isPending?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-5 w-5 mr-2 animate-spin"}),s("common.sending","Sending...")]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"h-5 w-5 mr-2"}),s("emergency.instant_broadcast_button","BROADCAST NOW")]})})]})})}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[e.jsx(N,{"data-testid":"stat-total",className:"shadow-sm",children:e.jsx(v,{className:"pt-4 pb-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:f.length}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-0.5",children:s("clinic_results.total_clinics","Total Clinics")})]})})}),e.jsx(N,{"data-testid":"stat-24hour",className:"shadow-sm",children:e.jsx(v,{className:"pt-4 pb-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:Ae}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-0.5",children:s("clinic_results.24hour","24-Hour")})]})})}),e.jsx(N,{"data-testid":"stat-whatsapp",className:"shadow-sm",children:e.jsx(v,{className:"pt-4 pb-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:Le}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-0.5",children:s("clinic_results.whatsapp","WhatsApp")})]})})}),e.jsx(N,{"data-testid":"stat-nearby",className:"shadow-sm",children:e.jsx(v,{className:"pt-4 pb-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:Pe}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-0.5",children:s("clinic_results.within_5km","Within 5km")})]})})})]}),e.jsxs(N,{"data-testid":"card-filters",children:[e.jsx(X,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(J,{className:"text-lg",children:s("clinic_results.filters_search","Filters & Search")}),e.jsxs(p,{variant:"ghost",size:"sm",onClick:()=>ve(!W),"data-testid":"button-toggle-filters",children:[e.jsx(rt,{className:"h-4 w-4 mr-2"}),W?s("clinic_results.hide_filters","Hide Filters"):s("clinic_results.show_filters","Show Filters")]})]})}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(nt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(D,{placeholder:s("clinic_results.search_placeholder","Search clinics by name or address..."),value:O,onChange:t=>Ne(t.target.value),className:"pl-10","data-testid":"input-search"})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-1",children:[e.jsx(ie,{id:"24hour-quick-filter",checked:B,onCheckedChange:de,"data-testid":"switch-24hour-quick"}),e.jsxs(_,{htmlFor:"24hour-quick-filter",className:"cursor-pointer font-medium",children:[e.jsx(ge,{className:"inline h-4 w-4 mr-1.5 text-green-600"}),s("clinic_results.24hour_only","24-Hour Clinics Only")]})]}),W&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 pt-2",children:[e.jsxs("div",{children:[e.jsx(_,{className:"text-sm mb-2 block",children:s("clinic_results.region","Region")}),e.jsxs(q,{value:i,onValueChange:F,children:[e.jsx(R,{"data-testid":"select-region",children:e.jsx(ee,{placeholder:s("clinic_results.all_regions","All Regions")})}),e.jsxs(je,{children:[e.jsx(S,{value:"all",children:s("clinic_results.all_regions","All Regions")}),me.map(t=>e.jsx(S,{value:t.code,children:a==="zh-HK"?t.nameZh:t.nameEn},t.id))]})]})]}),e.jsxs("div",{children:[e.jsx(_,{className:"text-sm mb-2 block",children:s("clinic_results.distance","Distance")}),V?e.jsxs(q,{value:E,onValueChange:re,children:[e.jsx(R,{"data-testid":"select-distance",children:e.jsx(ee,{placeholder:s("clinic_results.any_distance","Any Distance")})}),e.jsxs(je,{children:[e.jsx(S,{value:"all",children:s("clinic_results.any_distance","Any Distance")}),e.jsx(S,{value:"5",children:s("clinic_results.within_5km","Within 5 km")}),e.jsx(S,{value:"10",children:s("clinic_results.within_10km","Within 10 km")}),e.jsx(S,{value:"15",children:s("clinic_results.within_15km","Within 15 km")})]})]}):e.jsxs("div",{children:[e.jsx(q,{disabled:!0,value:"all",children:e.jsx(R,{"data-testid":"select-distance-disabled",className:"opacity-50",children:e.jsx(ee,{placeholder:s("clinic_results.gps_not_available","GPS Not Available")})})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:xe?s("clinic_results.no_gps_data","No clinic GPS data available"):s("clinic_results.enable_gps","Enable GPS on Step 2 for distance filtering")})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-6",children:[e.jsx(ie,{id:"24hour-filter",checked:B,onCheckedChange:de,"data-testid":"switch-24hour"}),e.jsx(_,{htmlFor:"24hour-filter",className:"cursor-pointer",children:s("clinic_results.24hour_only_short","24-Hour Only")})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-6",children:[e.jsx(ie,{id:"whatsapp-filter",checked:oe,onCheckedChange:_e,"data-testid":"switch-whatsapp"}),e.jsx(_,{htmlFor:"whatsapp-filter",className:"cursor-pointer",children:s("clinic_results.whatsapp_only","WhatsApp Only")})]})]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsx("div",{className:"flex-1",children:m.size>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(L,{variant:"secondary",className:"text-sm",children:[m.size," ",s("clinic_results.clinics_selected",m.size!==1?"clinics selected":"clinic selected")]}),e.jsx(p,{variant:"ghost",size:"sm",onClick:Ee,"data-testid":"button-deselect-all",children:s("clinic_results.clear_selection","Clear Selection")})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(pe,{href:`/emergency-results/${c==null?void 0:c.requestId}/messages`,children:e.jsxs(p,{variant:"outline",className:"border-blue-500 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-950","data-testid":"button-view-status",children:[e.jsx(lt,{className:"h-4 w-4 mr-2"}),s("clinic_results.view_status","View Broadcast Status")]})}),e.jsxs(p,{onClick:()=>H(!0),className:"bg-orange-600 hover:bg-orange-700",disabled:C===0,"data-testid":"button-broadcast",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),s("clinic_results.broadcast","Broadcast")," ",m.size>0?`(${m.size})`:s("clinic_results.to_all","to All")]})]})]}),e.jsx("div",{className:"space-y-4",children:f.length===0?e.jsx(N,{children:e.jsxs(v,{className:"p-12 text-center",children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-lg mb-2",children:s("clinic_results.no_clinics","No clinics found")}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:s("clinic_results.adjust_filters","Try adjusting your filters or search criteria")})]})}):f.map((t,l)=>{var b;const r=m.has(t.id),d=!!t.whatsapp,x=((b=n==null?void 0:n.pet)==null?void 0:b.lastVisitHospitalId)===t.id;return e.jsxs(N,{className:`hover:shadow-lg transition-all border-l-4 border-l-red-600 ${r?"ring-2 ring-orange-500":""} ${x?"ring-2 ring-amber-400 dark:ring-amber-500":""}`,"data-testid":`card-clinic-${t.id}`,children:[e.jsx(X,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[d&&e.jsx("div",{className:"pt-1",children:e.jsx(Xe,{checked:r,onCheckedChange:()=>Se(t.id),"data-testid":`checkbox-clinic-${t.id}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[x&&e.jsxs(L,{className:"bg-gradient-to-r from-amber-500 to-orange-500 mb-2 font-bold","data-testid":`badge-existing-patient-${t.id}`,children:["â­ ",s("clinic_results.existing_patient_badge","EXISTING PATIENT - Medical Records Available")]}),t.isPartner&&!x&&e.jsx(L,{className:"bg-gradient-to-r from-purple-600 to-blue-600 mb-2 font-bold","data-testid":`badge-partner-${t.id}`,children:"â­ PetSOS Partner"}),e.jsxs(J,{className:"text-lg mb-1 leading-tight",children:[a==="zh-HK"&&t.nameZh?t.nameZh:t.nameEn,a==="zh-HK"&&t.nameZh&&e.jsx("span",{className:"block text-sm font-normal text-gray-500 dark:text-gray-400 mt-0.5",children:t.nameEn})]}),t.distance!==void 0&&e.jsxs("div",{className:"inline-flex items-center gap-1 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 px-2 py-0.5 rounded-full text-xs font-semibold mb-2","data-testid":`text-clinic-distance-${t.id}`,children:[e.jsx(Ke,{className:"h-3 w-3"}),t.distance.toFixed(1)," km ",a==="zh-HK"?"è·é›¢":"away"]}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 truncate mb-2","data-testid":`text-clinic-address-${t.id}`,children:a==="zh-HK"&&t.addressZh?t.addressZh:t.addressEn}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:t.whatsapp&&e.jsxs(L,{variant:"outline",className:"bg-green-50 dark:bg-green-950 text-xs",children:[e.jsx(fe,{className:"h-3 w-3 mr-1"}),"WhatsApp"]})})]}),t.open247&&e.jsxs(L,{className:"bg-red-600 hover:bg-red-700 shrink-0","data-testid":`badge-24hour-${t.id}`,children:[e.jsx(ge,{className:"h-3 w-3 mr-1"}),a==="zh-HK"?"24å°æ™‚":"24hrs"]})]})}),e.jsx(v,{className:"pt-0",children:e.jsxs("div",{className:"flex gap-2",children:[t.phone&&e.jsxs(p,{onClick:()=>ke(t.phone,t.id,t.nameEn),size:"sm",className:"flex-1 bg-red-600 hover:bg-red-700","data-testid":`button-call-${t.id}`,children:[e.jsx(We,{className:"h-4 w-4 mr-1"}),a==="zh-HK"?"è‡´é›»":"Call"]}),t.whatsapp&&e.jsxs(p,{onClick:()=>$e(t.whatsapp,t.id,t.nameEn),variant:"outline",size:"sm",className:"flex-1 border-red-600 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20","data-testid":`button-whatsapp-${t.id}`,children:[e.jsx(fe,{className:"h-4 w-4 mr-1"}),"WhatsApp"]}),t.latitude&&t.longitude&&e.jsxs(p,{onClick:()=>Ce(t.latitude,t.longitude,t.nameEn),variant:"outline",size:"sm",className:"flex-1 border-red-600 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20","data-testid":`button-maps-${t.id}`,children:[e.jsx(be,{className:"h-4 w-4 mr-1"}),a==="zh-HK"?"å°èˆª":"Maps"]})]})})]},t.id)})}),e.jsx("div",{className:"mt-8 p-4 bg-amber-50 dark:bg-amber-950 rounded-lg text-center",children:e.jsx("p",{className:"text-amber-800 dark:text-amber-200 text-sm",children:s("app.disclaimer","âš ï¸ PetSOS provides emergency guidance only and is not medical advice. If in doubt, contact a vet immediately.")})})]}),e.jsx(Je,{open:j,onOpenChange:H,children:e.jsxs(qe,{className:"max-w-2xl",children:[e.jsxs(Re,{children:[e.jsx(et,{children:m.size>0?s("clinic_results.broadcast_to_selected","Broadcast to Selected Clinics"):s("clinic_results.broadcast_emergency","Broadcast Emergency Alert")}),e.jsx(tt,{asChild:!0,children:e.jsxs("div",{children:[e.jsx("p",{className:"mb-4",children:m.size>0?e.jsx(e.Fragment,{children:s("clinic_results.broadcast_desc_selected",`This will send your emergency alert to ${C} selected ${C===1?"clinic":"clinics"} via WhatsApp and email.`)}):e.jsx(e.Fragment,{children:s("clinic_results.broadcast_desc_all",`This will send your emergency alert to all ${C} clinics via WhatsApp and email.`)})}),m.size===0&&e.jsx("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-950 rounded border border-blue-200 dark:border-blue-800",children:e.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:s("clinic_results.broadcast_tip","ğŸ’¡ Tip: Select specific clinics using the checkboxes to send a targeted broadcast")})}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-4 rounded-lg",children:[e.jsxs("strong",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:[s("clinic_results.message_preview","Message Preview"),":"]}),e.jsx("pre",{className:"mt-2 text-sm text-gray-900 dark:text-gray-100 whitespace-pre-wrap font-sans",children:ce(n,s,$)})]})]})})]}),e.jsxs(st,{children:[e.jsx(at,{"data-testid":"button-cancel-broadcast",children:s("common.cancel","Cancel")}),e.jsxs(it,{onClick:Me,disabled:U.isPending,className:"bg-orange-600 hover:bg-orange-700","data-testid":"button-confirm-broadcast",children:[U.isPending&&e.jsx(z,{className:"h-4 w-4 mr-2 animate-spin"}),s("clinic_results.send_to_clinics",`Send to ${C} ${C===1?"Clinic":"Clinics"}`)]})]})]})}),e.jsx(Ge,{open:ye,onOpenChange:I,children:e.jsxs(Ve,{className:"max-w-md",children:[e.jsxs(Ue,{children:[e.jsx(Ye,{children:a==="zh-HK"?"ç·¨è¼¯ç·Šæ€¥æ±‚åŠ©è³‡æ–™":"Edit Emergency Request"}),e.jsx(Ze,{children:a==="zh-HK"?"æ›´æ–°æ‚¨çš„ç·Šæ€¥æ±‚åŠ©è³‡æ–™ã€‚è®Šæ›´å°‡åæ˜ åœ¨æœªä¾†çš„å»£æ’­è¨Šæ¯ä¸­ã€‚":"Update your emergency request details. Changes will be reflected in future broadcasts."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"edit-contact-name",children:a==="zh-HK"?"è¯çµ¡äººå§“å":"Contact Name"}),e.jsx(D,{id:"edit-contact-name",value:u.contactName,onChange:t=>P({...u,contactName:t.target.value}),placeholder:s("emergency.name_placeholder","Your name"),"data-testid":"input-edit-contact-name"})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"edit-contact-phone",children:a==="zh-HK"?"è¯çµ¡é›»è©±":"Contact Phone"}),e.jsx(D,{id:"edit-contact-phone",value:u.contactPhone,onChange:t=>P({...u,contactPhone:t.target.value}),placeholder:s("emergency.phone_placeholder","+852 1234 5678"),"data-testid":"input-edit-contact-phone"})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"edit-symptom",className:"text-gray-700 dark:text-gray-300",children:a==="zh-HK"?"ç—‡ç‹€":"Symptoms"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:u.symptom})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"edit-location",className:"text-gray-700 dark:text-gray-300",children:a==="zh-HK"?"ä½ç½®":"Location"}),e.jsx(p,{type:"button",variant:"outline",className:"w-full mt-2 mb-2",onClick:Te,disabled:he,"data-testid":"button-use-gps",children:he?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4 mr-2 animate-spin"}),a==="zh-HK"?"åµæ¸¬ä½ç½®ä¸­...":"Detecting location..."]}):e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),a==="zh-HK"?"ä½¿ç”¨ GPS å®šä½":"Use GPS Location"]})}),u.locationLatitude&&u.locationLongitude&&e.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400 mb-2 flex items-center gap-1",children:[e.jsx(ct,{className:"h-3 w-3"}),a==="zh-HK"?`GPS ä½ç½®å·²åµæ¸¬: ${u.locationLatitude.toFixed(6)}, ${u.locationLongitude.toFixed(6)}`:`GPS location detected: ${u.locationLatitude.toFixed(6)}, ${u.locationLongitude.toFixed(6)}`]}),ue&&e.jsx("div",{className:"text-xs text-red-600 dark:text-red-400 mb-2",children:ue}),e.jsx(D,{id:"edit-location",value:u.manualLocation,onChange:t=>P({...u,manualLocation:t.target.value}),placeholder:a==="zh-HK"?"åœ°å€æˆ–åœ°å€":"Area or address","data-testid":"input-edit-location"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:a==="zh-HK"?"ä½¿ç”¨ GPS æˆ–æ‰‹å‹•è¼¸å…¥åœ°å€":"Use GPS or manually enter address"})]})]}),e.jsxs(Qe,{children:[e.jsx(p,{variant:"outline",onClick:()=>I(!1),"data-testid":"button-cancel-edit",children:a==="zh-HK"?"å–æ¶ˆ":"Cancel"}),e.jsxs(p,{onClick:ze,disabled:Z.isPending,"data-testid":"button-save-edit",children:[Z.isPending&&e.jsx(z,{className:"h-4 w-4 mr-2 animate-spin"}),a==="zh-HK"?"å„²å­˜è®Šæ›´":"Save Changes"]})]})]})})]})}export{wt as default};
