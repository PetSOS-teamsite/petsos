import{r as c,a as ue,h as $,j as e,_ as k,B as t,C as m,b as j,I as S,a1 as R,a2 as q,a3 as z,a4 as B,a5 as l,q as pe,t as fe,E as ve,$ as g,H as O,G as I}from"./index-DSfXJrMH.js";import{u as Q}from"./useMutation-Cr219pYB.js";import{T as Ne,a as ye,b as V,c as n,d as be,e as d}from"./table-CgedxRwg.js";import{D as G,a as J,b as W,c as X,d as Y,e as Z}from"./dialog-DVNSF8fN.js";import{B as u}from"./badge-i4G4T4_i.js";import{S as we}from"./skeleton-BXF3w9B7.js";import{A as Ce}from"./arrow-left-B5_XZNND.js";import{R as ke}from"./refresh-cw-CzSBjnJ2.js";import{P as Se}from"./paw-print-BoIjn5Cl.js";import{B as H}from"./building-2-BvJiZHTX.js";import{S as Pe}from"./settings-B2fRQzOm.js";import{U as P,C as De}from"./users-_l0TR2ob.js";import{S as ee}from"./shield-BBK7vxth.js";import{S as Ue}from"./search-qxig8uw6.js";import{M as Te}from"./mail-DZRg_L6r.js";import{S as Ee}from"./square-pen-C3CePlsx.js";import{T as Ae}from"./trash-2-DJdNRrn9.js";import{f as Me}from"./format-C75rDloS.js";import"./index-BKY5CHHC.js";function Ze(){const[D,se]=c.useState(""),[U,ae]=c.useState("all"),[o,p]=c.useState(1),[te,f]=c.useState(!1),[re,v]=c.useState(!1),[N,y]=c.useState(null),[r,x]=c.useState({name:"",email:"",phone:"",role:"user",languagePreference:"en"}),T=20,{toast:b}=ue(),{data:a,isLoading:ie}=$({queryKey:["/api/admin/users"]}),{data:E}=$({queryKey:["/api/clinics"]}),w={total:(a==null?void 0:a.length)??0,admins:((a==null?void 0:a.filter(s=>s.role==="admin"))??[]).length,clinicStaff:((a==null?void 0:a.filter(s=>s.role==="clinic_staff"))??[]).length,regularUsers:((a==null?void 0:a.filter(s=>s.role==="user"))??[]).length},A=(a==null?void 0:a.filter(s=>{var i,C,_;if(D){const L=D.toLowerCase(),me=(i=s.name)==null?void 0:i.toLowerCase().includes(L),je=(C=s.email)==null?void 0:C.toLowerCase().includes(L),ge=(_=s.phone)==null?void 0:_.toLowerCase().includes(L);if(!me&&!je&&!ge)return!1}return!(U!=="all"&&s.role!==U)}))??[],h=Math.ceil(A.length/T),K=A.slice((o-1)*T,o*T),le=()=>{O.invalidateQueries({queryKey:["/api/admin/users"]})},ne=s=>{y(s),x({name:s.name||"",email:s.email||"",phone:s.phone||"",role:s.role,languagePreference:s.languagePreference}),f(!0)},de=s=>{y(s),v(!0)},M=Q({mutationFn:({id:s,data:i})=>I("PATCH",`/api/users/${s}`,i),onSuccess:()=>{O.invalidateQueries({queryKey:["/api/admin/users"]}),f(!1),y(null),b({title:"User updated successfully"})},onError:s=>{b({title:"Error updating user",description:s.message||"An error occurred",variant:"destructive"})}}),F=Q({mutationFn:s=>I("DELETE",`/api/users/${s}`),onSuccess:()=>{O.invalidateQueries({queryKey:["/api/admin/users"]}),v(!1),y(null),b({title:"User deleted successfully"})},onError:s=>{b({title:"Error deleting user",description:s.message||"An error occurred",variant:"destructive"})}}),ce=()=>{N&&M.mutate({id:N.id,data:r})},oe=()=>{N&&F.mutate(N.id)},xe=s=>{switch(s){case"admin":return e.jsxs(u,{variant:"destructive",children:[e.jsx(ee,{className:"h-3 w-3 mr-1"}),"Admin"]});case"clinic_staff":return e.jsxs(u,{variant:"secondary",className:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",children:[e.jsx(H,{className:"h-3 w-3 mr-1"}),"Clinic Staff"]});case"user":return e.jsxs(u,{variant:"outline",children:[e.jsx(P,{className:"h-3 w-3 mr-1"}),"User"]});default:return e.jsx(u,{variant:"outline",children:s})}},he=s=>{if(!s)return"N/A";const i=E==null?void 0:E.find(C=>C.id===s);return i?i.name:s};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-white to-gray-50 dark:from-gray-900 dark:to-gray-800",children:[e.jsx("header",{className:"border-b border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 sticky top-0 z-10",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(k,{href:"/admin",children:e.jsx(t,{variant:"ghost",size:"icon","data-testid":"button-back",children:e.jsx(Ce,{className:"h-5 w-5"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"User Management"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Manage pet owner accounts and profiles"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(t,{onClick:le,variant:"outline",size:"sm","data-testid":"button-refresh",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsx(k,{href:"/admin/pets",children:e.jsxs(t,{variant:"outline",size:"sm","data-testid":"button-admin-pets",children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Pets"]})}),e.jsx(k,{href:"/admin/clinics",children:e.jsxs(t,{variant:"outline",size:"sm","data-testid":"button-admin-clinics",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Clinics"]})}),e.jsx(k,{href:"/admin/config",children:e.jsxs(t,{variant:"outline",size:"sm","data-testid":"button-admin-config",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Config"]})})]})]})})}),e.jsxs("main",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"max-w-7xl mx-auto mb-8",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(m,{children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900 rounded-lg",children:e.jsx(P,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white","data-testid":"text-total-users",children:w.total})]})]})})}),e.jsx(m,{children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-red-100 dark:bg-red-900 rounded-lg",children:e.jsx(ee,{className:"h-6 w-6 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Admins"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:w.admins})]})]})})}),e.jsx(m,{children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-purple-100 dark:bg-purple-900 rounded-lg",children:e.jsx(H,{className:"h-6 w-6 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Clinic Staff"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:w.clinicStaff})]})]})})}),e.jsx(m,{children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900 rounded-lg",children:e.jsx(P,{className:"h-6 w-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Pet Owners"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:w.regularUsers})]})]})})})]})}),e.jsx("div",{className:"max-w-7xl mx-auto mb-6",children:e.jsx(m,{children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ue,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(S,{placeholder:"Search by name, email, or phone...",value:D,onChange:s=>{se(s.target.value),p(1)},className:"pl-10","data-testid":"input-search"})]}),e.jsxs(R,{value:U,onValueChange:s=>{ae(s),p(1)},children:[e.jsx(q,{"data-testid":"select-role-filter",children:e.jsx(z,{placeholder:"Filter by role"})}),e.jsxs(B,{children:[e.jsx(l,{value:"all",children:"All Roles"}),e.jsx(l,{value:"user",children:"Pet Owners"}),e.jsx(l,{value:"clinic_staff",children:"Clinic Staff"}),e.jsx(l,{value:"admin",children:"Admins"})]})]})]})})})}),e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs(m,{children:[e.jsx(pe,{children:e.jsxs(fe,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Users (",A.length,")"]}),h>1&&e.jsxs("span",{className:"text-sm font-normal text-gray-600 dark:text-gray-400",children:["Page ",o," of ",h]})]})}),e.jsx(j,{children:ie?e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((s,i)=>e.jsx(we,{className:"h-16 w-full"},i))}):K.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(P,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No users found"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ne,{children:[e.jsx(ye,{children:e.jsxs(V,{children:[e.jsx(n,{children:"Name"}),e.jsx(n,{children:"Email"}),e.jsx(n,{children:"Phone"}),e.jsx(n,{children:"Role"}),e.jsx(n,{children:"Clinic"}),e.jsx(n,{children:"Language"}),e.jsx(n,{children:"Created"}),e.jsx(n,{className:"text-right",children:"Actions"})]})}),e.jsx(be,{children:K.map(s=>e.jsxs(V,{"data-testid":`row-user-${s.id}`,children:[e.jsx(d,{className:"font-medium",children:s.name||e.jsx("span",{className:"text-gray-400",children:"No name"})}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-4 w-4 text-gray-400"}),s.email||e.jsx("span",{className:"text-gray-400",children:"No email"})]})}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4 text-gray-400"}),s.phone||e.jsx("span",{className:"text-gray-400",children:"No phone"})]})}),e.jsx(d,{children:xe(s.role)}),e.jsx(d,{className:"text-sm text-gray-600 dark:text-gray-400",children:he(s.clinicId)}),e.jsx(d,{children:e.jsx(u,{variant:"outline",children:s.languagePreference})}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(De,{className:"h-4 w-4"}),Me(new Date(s.createdAt),"MMM d, yyyy")]})}),e.jsx(d,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>ne(s),"data-testid":`button-edit-${s.id}`,children:e.jsx(Ee,{className:"h-4 w-4"})}),e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>de(s),className:"text-red-600 hover:text-red-700 hover:bg-red-50","data-testid":`button-delete-${s.id}`,children:e.jsx(Ae,{className:"h-4 w-4"})})]})})]},s.id))})]})}),h>1&&e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsx(t,{variant:"outline",onClick:()=>p(s=>Math.max(1,s-1)),disabled:o===1,"data-testid":"button-prev-page",children:"Previous"}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Page ",o," of ",h]}),e.jsx(t,{variant:"outline",onClick:()=>p(s=>Math.min(h,s+1)),disabled:o===h,"data-testid":"button-next-page",children:"Next"})]})]})})]})})]}),e.jsx(G,{open:te,onOpenChange:f,children:e.jsxs(J,{"data-testid":"dialog-edit-user",children:[e.jsxs(W,{children:[e.jsx(X,{children:"Edit User"}),e.jsx(Y,{children:"Update user information"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"name",children:"Name"}),e.jsx(S,{id:"name",value:r.name,onChange:s=>x({...r,name:s.target.value}),"data-testid":"input-edit-name"})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"email",children:"Email"}),e.jsx(S,{id:"email",type:"email",value:r.email,onChange:s=>x({...r,email:s.target.value}),"data-testid":"input-edit-email"})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"phone",children:"Phone"}),e.jsx(S,{id:"phone",value:r.phone,onChange:s=>x({...r,phone:s.target.value}),"data-testid":"input-edit-phone"})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"role",children:"Role"}),e.jsxs(R,{value:r.role,onValueChange:s=>x({...r,role:s}),children:[e.jsx(q,{"data-testid":"select-edit-role",children:e.jsx(z,{})}),e.jsxs(B,{children:[e.jsx(l,{value:"user",children:"User"}),e.jsx(l,{value:"clinic_staff",children:"Clinic Staff"}),e.jsx(l,{value:"admin",children:"Admin"})]})]})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"language",children:"Language"}),e.jsxs(R,{value:r.languagePreference,onValueChange:s=>x({...r,languagePreference:s}),children:[e.jsx(q,{"data-testid":"select-edit-language",children:e.jsx(z,{})}),e.jsxs(B,{children:[e.jsx(l,{value:"en",children:"English"}),e.jsx(l,{value:"zh-HK",children:"中文"})]})]})]})]}),e.jsxs(Z,{children:[e.jsx(t,{variant:"outline",onClick:()=>f(!1),"data-testid":"button-cancel-edit",children:"Cancel"}),e.jsx(t,{onClick:ce,disabled:M.isPending,"data-testid":"button-save-user",children:M.isPending?"Saving...":"Save Changes"})]})]})}),e.jsx(G,{open:re,onOpenChange:v,children:e.jsxs(J,{"data-testid":"dialog-delete-user",children:[e.jsxs(W,{children:[e.jsx(X,{children:"Delete User"}),e.jsx(Y,{children:"Are you sure you want to delete this user? This action cannot be undone. All associated pets and emergency requests will also be deleted."})]}),e.jsxs(Z,{children:[e.jsx(t,{variant:"outline",onClick:()=>v(!1),"data-testid":"button-cancel-delete",children:"Cancel"}),e.jsx(t,{variant:"destructive",onClick:oe,disabled:F.isPending,"data-testid":"button-confirm-delete",children:F.isPending?"Deleting...":"Delete User"})]})]})})]})}export{Ze as default};
