import{c as Z,T as ke,r as u,U as I,aR as Le,j as e,W as z,Y as q,X as M,b8 as D,aT as _e,b9 as Ie,a0 as ve,a as He,h as ne,a3 as F,B as E,C as oe,q as ae,t as le,a4 as Oe,b as ie,N as ce,I as ze,a5 as Fe,a1 as Xe,O as Q,Q as X}from"./index-B6B5-wqG.js";import{u as G}from"./useMutation-DUKQItlV.js";import{B as W}from"./badge-BCk9M62I.js";import{S as de}from"./skeleton-QnbRUKoU.js";import{S as We}from"./switch-7TT_84Ex.js";import{A as Ye}from"./arrow-left-BpE3PuIj.js";import{M as O}from"./message-square-Dnn5Ptsj.js";import{R as Be}from"./refresh-cw-Rle-BtDm.js";import{S as Ue}from"./settings-hQnBrW0F.js";import{B as ue}from"./building-2-BRlfl8Dq.js";import{t as b,c as $e,e as qe,g as he,m as fe,a as Y,b as Ve,f as me}from"./format-CoLFXwEe.js";import{U as Ke}from"./user-CTeold19.js";import{S as Qe}from"./send-BV-BHk2s.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=Z("ArchiveRestore",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h2",key:"tvwodi"}],["path",{d:"M20 8v11a2 2 0 0 1-2 2h-2",key:"1gkqxj"}],["path",{d:"m9 15 3-3 3 3",key:"1pd0qc"}],["path",{d:"M12 12v9",key:"192myk"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=Z("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=Z("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);function B(t,r){const s=b(t),a=b(r),n=s.getTime()-a.getTime();return n<0?-1:n>0?1:n}function Je(t){return $e(t,Date.now())}function Ze(t,r){const s=b(t),a=b(r),n=s.getFullYear()-a.getFullYear(),i=s.getMonth()-a.getMonth();return n*12+i}function et(t){return r=>{const a=(t?Math[t]:Math.trunc)(r);return a===0?0:a}}function tt(t,r){return+b(t)-+b(r)}function rt(t){const r=b(t);return r.setHours(23,59,59,999),r}function st(t){const r=b(t),s=r.getMonth();return r.setFullYear(r.getFullYear(),s+1,0),r.setHours(23,59,59,999),r}function nt(t){const r=b(t);return+rt(r)==+st(r)}function ot(t,r){const s=b(t),a=b(r),n=B(s,a),i=Math.abs(Ze(s,a));let c;if(i<1)c=0;else{s.getMonth()===1&&s.getDate()>27&&s.setDate(30),s.setMonth(s.getMonth()-n*i);let l=B(s,a)===-n;nt(b(t))&&i===1&&B(t,a)===1&&(l=!1),c=n*(i-Number(l))}return c===0?0:c}function at(t,r,s){const a=tt(t,r)/1e3;return et(s==null?void 0:s.roundingMethod)(a)}function lt(t,r,s){const a=Ve(),n=(s==null?void 0:s.locale)??a.locale??qe,i=2520,c=B(t,r);if(isNaN(c))throw new RangeError("Invalid time value");const l=Object.assign({},s,{addSuffix:s==null?void 0:s.addSuffix,comparison:c});let f,x;c>0?(f=b(r),x=b(t)):(f=b(t),x=b(r));const d=at(x,f),p=(he(x)-he(f))/1e3,m=Math.round((d-p)/60);let h;if(m<2)return s!=null&&s.includeSeconds?d<5?n.formatDistance("lessThanXSeconds",5,l):d<10?n.formatDistance("lessThanXSeconds",10,l):d<20?n.formatDistance("lessThanXSeconds",20,l):d<40?n.formatDistance("halfAMinute",0,l):d<60?n.formatDistance("lessThanXMinutes",1,l):n.formatDistance("xMinutes",1,l):m===0?n.formatDistance("lessThanXMinutes",1,l):n.formatDistance("xMinutes",m,l);if(m<45)return n.formatDistance("xMinutes",m,l);if(m<90)return n.formatDistance("aboutXHours",1,l);if(m<fe){const g=Math.round(m/60);return n.formatDistance("aboutXHours",g,l)}else{if(m<i)return n.formatDistance("xDays",1,l);if(m<Y){const g=Math.round(m/fe);return n.formatDistance("xDays",g,l)}else if(m<Y*2)return h=Math.round(m/Y),n.formatDistance("aboutXMonths",h,l)}if(h=ot(x,f),h<12){const g=Math.round(m/Y);return n.formatDistance("xMonths",g,l)}else{const g=h%12,S=Math.trunc(h/12);return g<3?n.formatDistance("aboutXYears",S,l):g<9?n.formatDistance("overXYears",S,l):n.formatDistance("almostXYears",S+1,l)}}function it(t,r){return lt(t,Je(t),r)}function ct(t,r){return u.useReducer((s,a)=>r[s][a]??s,t)}var ee="ScrollArea",[be,Ht]=ke(ee),[dt,w]=be(ee),we=u.forwardRef((t,r)=>{const{__scopeScrollArea:s,type:a="hover",dir:n,scrollHideDelay:i=600,...c}=t,[l,f]=u.useState(null),[x,d]=u.useState(null),[p,m]=u.useState(null),[h,g]=u.useState(null),[S,H]=u.useState(null),[N,C]=u.useState(0),[P,A]=u.useState(0),[k,R]=u.useState(!1),[y,T]=u.useState(!1),o=I(r,L=>f(L)),v=Le(n);return e.jsx(dt,{scope:s,type:a,dir:v,scrollHideDelay:i,scrollArea:l,viewport:x,onViewportChange:d,content:p,onContentChange:m,scrollbarX:h,onScrollbarXChange:g,scrollbarXEnabled:k,onScrollbarXEnabledChange:R,scrollbarY:S,onScrollbarYChange:H,scrollbarYEnabled:y,onScrollbarYEnabledChange:T,onCornerWidthChange:C,onCornerHeightChange:A,children:e.jsx(z.div,{dir:v,...c,ref:o,style:{position:"relative","--radix-scroll-area-corner-width":N+"px","--radix-scroll-area-corner-height":P+"px",...t.style}})})});we.displayName=ee;var Se="ScrollAreaViewport",ye=u.forwardRef((t,r)=>{const{__scopeScrollArea:s,children:a,nonce:n,...i}=t,c=w(Se,s),l=u.useRef(null),f=I(r,l,c.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),e.jsx(z.div,{"data-radix-scroll-area-viewport":"",...i,ref:f,style:{overflowX:c.scrollbarXEnabled?"scroll":"hidden",overflowY:c.scrollbarYEnabled?"scroll":"hidden",...t.style},children:e.jsx("div",{ref:c.onContentChange,style:{minWidth:"100%",display:"table"},children:a})})]})});ye.displayName=Se;var j="ScrollAreaScrollbar",te=u.forwardRef((t,r)=>{const{forceMount:s,...a}=t,n=w(j,t.__scopeScrollArea),{onScrollbarXEnabledChange:i,onScrollbarYEnabledChange:c}=n,l=t.orientation==="horizontal";return u.useEffect(()=>(l?i(!0):c(!0),()=>{l?i(!1):c(!1)}),[l,i,c]),n.type==="hover"?e.jsx(ut,{...a,ref:r,forceMount:s}):n.type==="scroll"?e.jsx(ht,{...a,ref:r,forceMount:s}):n.type==="auto"?e.jsx(je,{...a,ref:r,forceMount:s}):n.type==="always"?e.jsx(re,{...a,ref:r}):null});te.displayName=j;var ut=u.forwardRef((t,r)=>{const{forceMount:s,...a}=t,n=w(j,t.__scopeScrollArea),[i,c]=u.useState(!1);return u.useEffect(()=>{const l=n.scrollArea;let f=0;if(l){const x=()=>{window.clearTimeout(f),c(!0)},d=()=>{f=window.setTimeout(()=>c(!1),n.scrollHideDelay)};return l.addEventListener("pointerenter",x),l.addEventListener("pointerleave",d),()=>{window.clearTimeout(f),l.removeEventListener("pointerenter",x),l.removeEventListener("pointerleave",d)}}},[n.scrollArea,n.scrollHideDelay]),e.jsx(q,{present:s||i,children:e.jsx(je,{"data-state":i?"visible":"hidden",...a,ref:r})})}),ht=u.forwardRef((t,r)=>{const{forceMount:s,...a}=t,n=w(j,t.__scopeScrollArea),i=t.orientation==="horizontal",c=K(()=>f("SCROLL_END"),100),[l,f]=ct("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return u.useEffect(()=>{if(l==="idle"){const x=window.setTimeout(()=>f("HIDE"),n.scrollHideDelay);return()=>window.clearTimeout(x)}},[l,n.scrollHideDelay,f]),u.useEffect(()=>{const x=n.viewport,d=i?"scrollLeft":"scrollTop";if(x){let p=x[d];const m=()=>{const h=x[d];p!==h&&(f("SCROLL"),c()),p=h};return x.addEventListener("scroll",m),()=>x.removeEventListener("scroll",m)}},[n.viewport,i,f,c]),e.jsx(q,{present:s||l!=="hidden",children:e.jsx(re,{"data-state":l==="hidden"?"hidden":"visible",...a,ref:r,onPointerEnter:M(t.onPointerEnter,()=>f("POINTER_ENTER")),onPointerLeave:M(t.onPointerLeave,()=>f("POINTER_LEAVE"))})})}),je=u.forwardRef((t,r)=>{const s=w(j,t.__scopeScrollArea),{forceMount:a,...n}=t,[i,c]=u.useState(!1),l=t.orientation==="horizontal",f=K(()=>{if(s.viewport){const x=s.viewport.offsetWidth<s.viewport.scrollWidth,d=s.viewport.offsetHeight<s.viewport.scrollHeight;c(l?x:d)}},10);return _(s.viewport,f),_(s.content,f),e.jsx(q,{present:a||i,children:e.jsx(re,{"data-state":i?"visible":"hidden",...n,ref:r})})}),re=u.forwardRef((t,r)=>{const{orientation:s="vertical",...a}=t,n=w(j,t.__scopeScrollArea),i=u.useRef(null),c=u.useRef(0),[l,f]=u.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),x=Re(l.viewport,l.content),d={...a,sizes:l,onSizesChange:f,hasThumb:x>0&&x<1,onThumbChange:m=>i.current=m,onThumbPointerUp:()=>c.current=0,onThumbPointerDown:m=>c.current=m};function p(m,h){return vt(m,c.current,l,h)}return s==="horizontal"?e.jsx(ft,{...d,ref:r,onThumbPositionChange:()=>{if(n.viewport&&i.current){const m=n.viewport.scrollLeft,h=ge(m,l,n.dir);i.current.style.transform=`translate3d(${h}px, 0, 0)`}},onWheelScroll:m=>{n.viewport&&(n.viewport.scrollLeft=m)},onDragScroll:m=>{n.viewport&&(n.viewport.scrollLeft=p(m,n.dir))}}):s==="vertical"?e.jsx(mt,{...d,ref:r,onThumbPositionChange:()=>{if(n.viewport&&i.current){const m=n.viewport.scrollTop,h=ge(m,l);i.current.style.transform=`translate3d(0, ${h}px, 0)`}},onWheelScroll:m=>{n.viewport&&(n.viewport.scrollTop=m)},onDragScroll:m=>{n.viewport&&(n.viewport.scrollTop=p(m))}}):null}),ft=u.forwardRef((t,r)=>{const{sizes:s,onSizesChange:a,...n}=t,i=w(j,t.__scopeScrollArea),[c,l]=u.useState(),f=u.useRef(null),x=I(r,f,i.onScrollbarXChange);return u.useEffect(()=>{f.current&&l(getComputedStyle(f.current))},[f]),e.jsx(Ce,{"data-orientation":"horizontal",...n,ref:x,sizes:s,style:{bottom:0,left:i.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:i.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":V(s)+"px",...t.style},onThumbPointerDown:d=>t.onThumbPointerDown(d.x),onDragScroll:d=>t.onDragScroll(d.x),onWheelScroll:(d,p)=>{if(i.viewport){const m=i.viewport.scrollLeft+d.deltaX;t.onWheelScroll(m),Ee(m,p)&&d.preventDefault()}},onResize:()=>{f.current&&i.viewport&&c&&a({content:i.viewport.scrollWidth,viewport:i.viewport.offsetWidth,scrollbar:{size:f.current.clientWidth,paddingStart:$(c.paddingLeft),paddingEnd:$(c.paddingRight)}})}})}),mt=u.forwardRef((t,r)=>{const{sizes:s,onSizesChange:a,...n}=t,i=w(j,t.__scopeScrollArea),[c,l]=u.useState(),f=u.useRef(null),x=I(r,f,i.onScrollbarYChange);return u.useEffect(()=>{f.current&&l(getComputedStyle(f.current))},[f]),e.jsx(Ce,{"data-orientation":"vertical",...n,ref:x,sizes:s,style:{top:0,right:i.dir==="ltr"?0:void 0,left:i.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":V(s)+"px",...t.style},onThumbPointerDown:d=>t.onThumbPointerDown(d.y),onDragScroll:d=>t.onDragScroll(d.y),onWheelScroll:(d,p)=>{if(i.viewport){const m=i.viewport.scrollTop+d.deltaY;t.onWheelScroll(m),Ee(m,p)&&d.preventDefault()}},onResize:()=>{f.current&&i.viewport&&c&&a({content:i.viewport.scrollHeight,viewport:i.viewport.offsetHeight,scrollbar:{size:f.current.clientHeight,paddingStart:$(c.paddingTop),paddingEnd:$(c.paddingBottom)}})}})}),[xt,Ne]=be(j),Ce=u.forwardRef((t,r)=>{const{__scopeScrollArea:s,sizes:a,hasThumb:n,onThumbChange:i,onThumbPointerUp:c,onThumbPointerDown:l,onThumbPositionChange:f,onDragScroll:x,onWheelScroll:d,onResize:p,...m}=t,h=w(j,s),[g,S]=u.useState(null),H=I(r,o=>S(o)),N=u.useRef(null),C=u.useRef(""),P=h.viewport,A=a.content-a.viewport,k=D(d),R=D(f),y=K(p,10);function T(o){if(N.current){const v=o.clientX-N.current.left,L=o.clientY-N.current.top;x({x:v,y:L})}}return u.useEffect(()=>{const o=v=>{const L=v.target;(g==null?void 0:g.contains(L))&&k(v,A)};return document.addEventListener("wheel",o,{passive:!1}),()=>document.removeEventListener("wheel",o,{passive:!1})},[P,g,A,k]),u.useEffect(R,[a,R]),_(g,y),_(h.content,y),e.jsx(xt,{scope:s,scrollbar:g,hasThumb:n,onThumbChange:D(i),onThumbPointerUp:D(c),onThumbPositionChange:R,onThumbPointerDown:D(l),children:e.jsx(z.div,{...m,ref:H,style:{position:"absolute",...m.style},onPointerDown:M(t.onPointerDown,o=>{o.button===0&&(o.target.setPointerCapture(o.pointerId),N.current=g.getBoundingClientRect(),C.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",h.viewport&&(h.viewport.style.scrollBehavior="auto"),T(o))}),onPointerMove:M(t.onPointerMove,T),onPointerUp:M(t.onPointerUp,o=>{const v=o.target;v.hasPointerCapture(o.pointerId)&&v.releasePointerCapture(o.pointerId),document.body.style.webkitUserSelect=C.current,h.viewport&&(h.viewport.style.scrollBehavior=""),N.current=null})})})}),U="ScrollAreaThumb",Pe=u.forwardRef((t,r)=>{const{forceMount:s,...a}=t,n=Ne(U,t.__scopeScrollArea);return e.jsx(q,{present:s||n.hasThumb,children:e.jsx(pt,{ref:r,...a})})}),pt=u.forwardRef((t,r)=>{const{__scopeScrollArea:s,style:a,...n}=t,i=w(U,s),c=Ne(U,s),{onThumbPositionChange:l}=c,f=I(r,p=>c.onThumbChange(p)),x=u.useRef(void 0),d=K(()=>{x.current&&(x.current(),x.current=void 0)},100);return u.useEffect(()=>{const p=i.viewport;if(p){const m=()=>{if(d(),!x.current){const h=bt(p,l);x.current=h,l()}};return l(),p.addEventListener("scroll",m),()=>p.removeEventListener("scroll",m)}},[i.viewport,d,l]),e.jsx(z.div,{"data-state":c.hasThumb?"visible":"hidden",...n,ref:f,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...a},onPointerDownCapture:M(t.onPointerDownCapture,p=>{const h=p.target.getBoundingClientRect(),g=p.clientX-h.left,S=p.clientY-h.top;c.onThumbPointerDown({x:g,y:S})}),onPointerUp:M(t.onPointerUp,c.onThumbPointerUp)})});Pe.displayName=U;var se="ScrollAreaCorner",Ae=u.forwardRef((t,r)=>{const s=w(se,t.__scopeScrollArea),a=!!(s.scrollbarX&&s.scrollbarY);return s.type!=="scroll"&&a?e.jsx(gt,{...t,ref:r}):null});Ae.displayName=se;var gt=u.forwardRef((t,r)=>{const{__scopeScrollArea:s,...a}=t,n=w(se,s),[i,c]=u.useState(0),[l,f]=u.useState(0),x=!!(i&&l);return _(n.scrollbarX,()=>{var p;const d=((p=n.scrollbarX)==null?void 0:p.offsetHeight)||0;n.onCornerHeightChange(d),f(d)}),_(n.scrollbarY,()=>{var p;const d=((p=n.scrollbarY)==null?void 0:p.offsetWidth)||0;n.onCornerWidthChange(d),c(d)}),x?e.jsx(z.div,{...a,ref:r,style:{width:i,height:l,position:"absolute",right:n.dir==="ltr"?0:void 0,left:n.dir==="rtl"?0:void 0,bottom:0,...t.style}}):null});function $(t){return t?parseInt(t,10):0}function Re(t,r){const s=t/r;return isNaN(s)?0:s}function V(t){const r=Re(t.viewport,t.content),s=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,a=(t.scrollbar.size-s)*r;return Math.max(a,18)}function vt(t,r,s,a="ltr"){const n=V(s),i=n/2,c=r||i,l=n-c,f=s.scrollbar.paddingStart+c,x=s.scrollbar.size-s.scrollbar.paddingEnd-l,d=s.content-s.viewport,p=a==="ltr"?[0,d]:[d*-1,0];return Te([f,x],p)(t)}function ge(t,r,s="ltr"){const a=V(r),n=r.scrollbar.paddingStart+r.scrollbar.paddingEnd,i=r.scrollbar.size-n,c=r.content-r.viewport,l=i-a,f=s==="ltr"?[0,c]:[c*-1,0],x=Ie(t,f);return Te([0,c],[0,l])(x)}function Te(t,r){return s=>{if(t[0]===t[1]||r[0]===r[1])return r[0];const a=(r[1]-r[0])/(t[1]-t[0]);return r[0]+a*(s-t[0])}}function Ee(t,r){return t>0&&t<r}var bt=(t,r=()=>{})=>{let s={left:t.scrollLeft,top:t.scrollTop},a=0;return function n(){const i={left:t.scrollLeft,top:t.scrollTop},c=s.left!==i.left,l=s.top!==i.top;(c||l)&&r(),s=i,a=window.requestAnimationFrame(n)}(),()=>window.cancelAnimationFrame(a)};function K(t,r){const s=D(t),a=u.useRef(0);return u.useEffect(()=>()=>window.clearTimeout(a.current),[]),u.useCallback(()=>{window.clearTimeout(a.current),a.current=window.setTimeout(s,r)},[s,r])}function _(t,r){const s=D(r);_e(()=>{let a=0;if(t){const n=new ResizeObserver(()=>{cancelAnimationFrame(a),a=window.requestAnimationFrame(s)});return n.observe(t),()=>{window.cancelAnimationFrame(a),n.unobserve(t)}}},[t,s])}var De=we,wt=ye,St=Ae;const J=u.forwardRef(({className:t,children:r,...s},a)=>e.jsxs(De,{ref:a,className:ve("relative overflow-hidden",t),...s,children:[e.jsx(wt,{className:"h-full w-full rounded-[inherit]",children:r}),e.jsx(Me,{}),e.jsx(St,{})]}));J.displayName=De.displayName;const Me=u.forwardRef(({className:t,orientation:r="vertical",...s},a)=>e.jsx(te,{ref:a,orientation:r,className:ve("flex touch-none select-none transition-colors",r==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",r==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...s,children:e.jsx(Pe,{className:"relative flex-1 rounded-full bg-border"})}));Me.displayName=te.displayName;function yt(t,r){if(r)return e.jsx(pe,{className:"h-3 w-3 text-blue-500"});switch(t){case"delivered":return e.jsx(pe,{className:"h-3 w-3 text-gray-400"});case"sent":return e.jsx(Xe,{className:"h-3 w-3 text-gray-400"});case"failed":return e.jsx("span",{className:"text-xs text-red-500",children:"!"});default:return e.jsx(Fe,{className:"h-3 w-3 text-gray-400"})}}function Ot(){const{toast:t}=He(),[r,s]=u.useState(null),[a,n]=u.useState(!1),[i,c]=u.useState(""),l=u.useRef(null),[f,x]=u.useState(null),{data:d,isLoading:p,refetch:m}=ne({queryKey:["/api/admin/conversations",a],queryFn:async()=>{const o=await fetch(`/api/admin/conversations?includeArchived=${a}`,{credentials:"include"});if(!o.ok)throw new Error("Failed to fetch conversations");return o.json()},refetchInterval:1e4}),h=d==null?void 0:d.find(o=>o.id===r),{data:g,isLoading:S,refetch:H}=ne({queryKey:["/api/admin/conversations",r,"messages"],queryFn:async()=>{if(!r)return[];const o=await fetch(`/api/admin/conversations/${r}/messages`,{credentials:"include"});if(!o.ok)throw new Error("Failed to fetch messages");return o.json()},enabled:!!r,refetchInterval:r?5e3:!1}),N=G({mutationFn:o=>Q("POST",`/api/admin/conversations/${o}/read`),onSuccess:()=>{X.invalidateQueries({queryKey:["/api/admin/conversations"]})}}),C=G({mutationFn:({id:o,archive:v})=>Q("POST",`/api/admin/conversations/${o}/archive`,{archive:v}),onSuccess:(o,v)=>{t({title:v.archive?"Conversation Archived":"Conversation Restored",description:v.archive?"The conversation has been archived":"The conversation has been restored"}),X.invalidateQueries({queryKey:["/api/admin/conversations"]}),v.archive&&r===v.id&&s(null)},onError:o=>{t({title:"Error",description:o.message||"Failed to archive conversation",variant:"destructive"})}}),P=G({mutationFn:({id:o,content:v})=>Q("POST",`/api/admin/conversations/${o}/reply`,{content:v}),onMutate:async({content:o})=>{const v={id:`temp-${Date.now()}`,conversationId:r,direction:"outbound",content:o,messageType:"text",status:"sent",whatsappMessageId:null,mediaUrl:null,sentAt:new Date,deliveredAt:null,readAt:null,errorMessage:null,createdAt:new Date};return x(v),c(""),{optimisticMessage:v}},onSuccess:()=>{x(null),X.invalidateQueries({queryKey:["/api/admin/conversations",r,"messages"]}),X.invalidateQueries({queryKey:["/api/admin/conversations"]})},onError:o=>{x(null),t({title:"Failed to send message",description:o.message||"Please try again",variant:"destructive"})}});u.useEffect(()=>{r&&(h!=null&&h.unreadCount)&&h.unreadCount>0&&N.mutate(r)},[r,h==null?void 0:h.unreadCount]),u.useEffect(()=>{var o;(o=l.current)==null||o.scrollIntoView({behavior:"smooth"})},[g,f]);const A=()=>{!i.trim()||!r||P.mutate({id:r,content:i.trim()})},k=o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),A())},R=()=>{m(),r&&H(),t({title:"Refreshed",description:"Conversations and messages have been refreshed"})},y=f?[...g||[],f]:g,T=(d==null?void 0:d.reduce((o,v)=>o+(v.unreadCount||0),0))||0;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-white to-gray-50 dark:from-gray-900 dark:to-gray-800",children:[e.jsx("header",{className:"border-b border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 sticky top-0 z-10",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(F,{href:"/admin",children:e.jsx(E,{variant:"ghost",size:"icon","data-testid":"button-back",children:e.jsx(Ye,{className:"h-5 w-5"})})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(O,{className:"h-6 w-6 text-green-600"}),"WhatsApp Chats",T>0&&e.jsx(W,{variant:"destructive",className:"ml-2","data-testid":"badge-unread-total",children:T})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Two-way messaging with hospitals"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{variant:"outline",size:"icon",onClick:R,"data-testid":"button-refresh",children:e.jsx(Be,{className:`h-4 w-4 ${p?"animate-spin":""}`})}),e.jsxs("div",{className:"hidden sm:flex gap-2",children:[e.jsx(F,{href:"/admin/messages",children:e.jsxs(E,{variant:"outline",size:"sm","data-testid":"button-broadcast-messages",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Broadcasts"]})}),e.jsx(F,{href:"/admin/config",children:e.jsxs(E,{variant:"outline",size:"sm","data-testid":"button-admin-config",children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Config"]})})]})]})]})})}),e.jsx("main",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 h-[calc(100vh-180px)]",children:[e.jsxs(oe,{className:"lg:w-1/3 flex flex-col","data-testid":"panel-conversations",children:[e.jsx(ae,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(le,{className:"text-lg",children:"Conversations"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{htmlFor:"show-archived",className:"text-sm text-muted-foreground",children:"Archived"}),e.jsx(We,{id:"show-archived",checked:a,onCheckedChange:n,"data-testid":"switch-show-archived"})]})]})}),e.jsx(ie,{className:"flex-1 overflow-hidden p-0",children:e.jsx(J,{className:"h-full",children:p?e.jsx("div",{className:"space-y-2 p-4",children:[1,2,3,4,5].map(o=>e.jsx(de,{className:"h-16 w-full"},o))}):(d==null?void 0:d.length)===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center text-muted-foreground",children:[e.jsx(O,{className:"h-12 w-12 mb-4 opacity-50"}),e.jsx("p",{children:"No conversations found"}),e.jsx("p",{className:"text-sm",children:"Incoming messages from hospitals will appear here"})]}):e.jsx("div",{className:"divide-y",children:d==null?void 0:d.map(o=>e.jsx("button",{onClick:()=>s(o.id),className:`w-full text-left px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors ${r===o.id?"bg-primary/5 border-l-4 border-primary":""} ${o.isArchived?"opacity-60":""}`,"data-testid":`conversation-item-${o.id}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium truncate",children:o.displayName||o.phoneNumber}),o.hospitalId&&e.jsxs(W,{variant:"secondary",className:"flex-shrink-0 text-xs",children:[e.jsx(ue,{className:"h-3 w-3 mr-1"}),"Hospital"]}),o.isArchived&&e.jsxs(W,{variant:"outline",className:"flex-shrink-0 text-xs",children:[e.jsx(xe,{className:"h-3 w-3 mr-1"}),"Archived"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground mt-0.5",children:[e.jsx(ce,{className:"h-3 w-3"}),e.jsx("span",{className:"font-mono",children:o.phoneNumber})]}),o.lastMessagePreview&&e.jsx("p",{className:"text-sm text-muted-foreground truncate mt-1",children:o.lastMessagePreview})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1 flex-shrink-0",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:o.lastMessageAt?it(new Date(o.lastMessageAt),{addSuffix:!0}):"No messages"}),(o.unreadCount||0)>0&&e.jsx(W,{variant:"destructive",className:"h-5 min-w-5 flex items-center justify-center text-xs","data-testid":`unread-badge-${o.id}`,children:o.unreadCount})]})]})},o.id))})})})]}),e.jsx(oe,{className:"lg:w-2/3 flex flex-col","data-testid":"panel-messages",children:r?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"pb-3 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center",children:e.jsx(Ke,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx(le,{className:"text-lg",children:(h==null?void 0:h.displayName)||(h==null?void 0:h.phoneNumber)}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(ce,{className:"h-3 w-3"}),h==null?void 0:h.phoneNumber]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[(h==null?void 0:h.hospitalId)&&e.jsx(F,{href:"/admin/hospitals",children:e.jsxs(E,{variant:"outline",size:"sm","data-testid":"button-view-hospital",children:[e.jsx(ue,{className:"h-4 w-4 mr-1"}),"View Hospital"]})}),e.jsx(E,{variant:"outline",size:"sm",onClick:()=>C.mutate({id:r,archive:!(h!=null&&h.isArchived)}),disabled:C.isPending,"data-testid":"button-archive",children:h!=null&&h.isArchived?e.jsxs(e.Fragment,{children:[e.jsx(Ge,{className:"h-4 w-4 mr-1"}),"Restore"]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-4 w-4 mr-1"}),"Archive"]})})]})]})}),e.jsx(ie,{className:"flex-1 overflow-hidden p-0",children:e.jsx(J,{className:"h-full p-4",children:S?e.jsx("div",{className:"space-y-4",children:[1,2,3,4].map(o=>e.jsx("div",{className:`flex ${o%2===0?"justify-end":"justify-start"}`,children:e.jsx(de,{className:"h-12 w-48 rounded-lg"})},o))}):(y==null?void 0:y.length)===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center text-muted-foreground",children:[e.jsx(O,{className:"h-12 w-12 mb-4 opacity-50"}),e.jsx("p",{children:"No messages yet"}),e.jsx("p",{className:"text-sm",children:"Send a message to start the conversation"})]}):e.jsxs("div",{className:"space-y-3",children:[y==null?void 0:y.map(o=>e.jsx("div",{className:`flex ${o.direction==="outbound"?"justify-end":"justify-start"}`,"data-testid":`message-${o.id}`,children:e.jsxs("div",{className:`max-w-[75%] rounded-lg px-4 py-2 ${o.direction==="outbound"?"bg-green-600 text-white":"bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white"}`,children:[e.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:o.content}),e.jsxs("div",{className:`flex items-center gap-1 mt-1 text-xs ${o.direction==="outbound"?"text-green-100 justify-end":"text-gray-500"}`,children:[e.jsx("span",{children:o.sentAt?me(new Date(o.sentAt),"HH:mm"):o.createdAt?me(new Date(o.createdAt),"HH:mm"):""}),o.direction==="outbound"&&yt(o.status,o.readAt)]})]})},o.id)),e.jsx("div",{ref:l})]})})}),e.jsx("div",{className:"p-4 border-t",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ze,{value:i,onChange:o=>c(o.target.value),onKeyPress:k,placeholder:"Type a message...",disabled:P.isPending,className:"flex-1","data-testid":"input-reply"}),e.jsxs(E,{onClick:A,disabled:!i.trim()||P.isPending,"data-testid":"button-send",children:[e.jsx(Qe,{className:"h-4 w-4 mr-2"}),"Send"]})]})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center text-muted-foreground",children:[e.jsx(O,{className:"h-16 w-16 mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Select a Conversation"}),e.jsx("p",{className:"text-sm max-w-md",children:"Choose a conversation from the list on the left to view messages and reply to hospitals."})]})})]})})]})}export{Ot as default};
