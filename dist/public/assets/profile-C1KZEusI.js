import{c as C,e as te,f as ie,a as le,u as ne,a6 as oe,h as b,g as de,a7 as ce,j as e,_ as u,B as l,C as N,q as w,t as k,v as P,b as _,F as pe,w as c,x as p,y as m,z as x,I as A,A as g,E as me,a1 as F,a2 as q,a3 as H,a4 as $,a5 as D,M as xe,a8 as ge,o as he,s as f,a9 as ue,aa as fe,G as I,H as je}from"./index-B6saPYUG.js";import{u as ye}from"./useMutation-BpjjsHNz.js";import{A as ve,h as be,a as Ne,b as we,c as ke,d as Pe,e as _e,f as Ae,g as De}from"./alert-dialog-BbSg89Wo.js";import{A as R,a as z,b as Y,c as V}from"./accordion-DGs1k6-5.js";import{A as Ce}from"./arrow-left-BBFd6T1J.js";import{P as j}from"./paw-print-AjTzLbPO.js";import{S as Se}from"./square-pen-BrKtRHLz.js";import{M as Te}from"./mail-CJ_fBhR2.js";import{G as K}from"./globe-BmfX4_N1.js";import{S as Le}from"./shield-DYka5YRg.js";import{T as Ee}from"./trash-2-COGP7Zp1.js";import"./index-CgmZT5hz.js";import"./index-DdxAflyV.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=C("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=C("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=C("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),qe=r=>he({name:f().min(1,r("profile.validation.name","Name is required")).optional().or(ue("")),email:f().email(r("profile.validation.email","Please enter a valid email")),phone:f().min(1,r("profile.validation.phone_required","Phone number is required")).min(8,r("profile.validation.phone_length","Please enter a valid phone number (at least 8 digits)")),languagePreference:fe(["en","zh-HK"]),regionPreference:f().optional()});function Ze(){const{user:r,isLoading:G}=te(),[,S]=ie(),{toast:n}=le(),{t:a,language:B}=ne(),{setLanguage:Q}=oe(),J=qe(a),{data:o,isLoading:Z}=b({queryKey:["/api/users",r==null?void 0:r.id],enabled:!!(r!=null&&r.id)}),{data:W=[]}=b({queryKey:["/api/regions"]}),{data:h=[],isLoading:X}=b({queryKey:["/api/users",r==null?void 0:r.id,"pets"],enabled:!!(r!=null&&r.id)}),i=de({resolver:ce(J),defaultValues:{name:"",email:"",phone:"",languagePreference:"en",regionPreference:void 0},values:o?{name:o.name||"",email:o.email||"",phone:o.phone||"",languagePreference:o.languagePreference||"en",regionPreference:o.regionPreference||void 0}:void 0}),y=ye({mutationFn:async s=>await(await I("PATCH",`/api/users/${r==null?void 0:r.id}`,s)).json(),onSuccess:(s,t)=>{je.invalidateQueries({queryKey:["/api/users",r==null?void 0:r.id]}),t.languagePreference&&Q(t.languagePreference),n({title:a("profile.success.title","Profile updated successfully!"),description:a("profile.success.desc","Your changes have been saved.")})},onError:s=>{n({title:a("profile.error.title","Update failed"),description:s.message,variant:"destructive"})}}),U=s=>{y.mutate(s)},ee=async()=>{try{const s=await fetch("/api/users/export",{credentials:"include"});if(!s.ok){const M=s.headers.get("Content-Type");if(M&&M.includes("application/json")){const re=await s.json();throw new Error(re.message||"Failed to export data")}throw new Error("Failed to export data")}const t=s.headers.get("Content-Type");if(!t||!t.includes("application/json"))throw new Error("Invalid response format");const T=s.headers.get("Content-Disposition");if(!T)throw new Error("Invalid download response");let L=`petsos-data-export-${new Date().toISOString()}.json`;const v=T.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);v&&v[1]&&(L=v[1].replace(/['"]/g,""));const se=await s.blob(),E=window.URL.createObjectURL(se),d=document.createElement("a");d.href=E,d.download=L,document.body.appendChild(d),d.click(),window.URL.revokeObjectURL(E),document.body.removeChild(d),n({title:a("profile.export.success_title","Data exported successfully"),description:a("profile.export.success_desc","Your personal data has been downloaded.")})}catch{n({title:a("profile.export.error_title","Export failed"),description:a("profile.export.error_desc","Failed to download your data. Please try again."),variant:"destructive"})}},ae=async()=>{try{const s=await I("DELETE","/api/users/gdpr-delete"),t=await s.json();if(!s.ok)throw new Error(t.message||"Failed to delete account");n({title:a("profile.delete.success_title","Account deleted"),description:a("profile.delete.success_desc","Your account and all data have been permanently deleted.")}),setTimeout(()=>{S("/")},2e3)}catch(s){n({title:a("profile.delete.error_title","Deletion failed"),description:s.message||a("profile.delete.error_desc","Failed to delete your account. Please try again."),variant:"destructive"})}};return G||Z?e.jsx("div",{className:"min-h-screen bg-white dark:bg-gray-900 flex items-center justify-center",children:e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:a("loading.profile","Loading profile...")})}):r?e.jsx("div",{className:"min-h-screen bg-white dark:bg-gray-900 py-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4",children:[e.jsx("div",{className:"mb-6",children:e.jsx(u,{href:"/",children:e.jsxs(l,{variant:"ghost",size:"sm","data-testid":"button-back",children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),a("button.back_home","Back to Home")]})})}),e.jsxs(N,{className:"border-2 border-green-200 dark:border-green-800 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-950 dark:to-emerald-950",children:[e.jsxs(w,{children:[e.jsxs(k,{className:"flex items-center gap-2 text-green-800 dark:text-green-300",children:[e.jsx(j,{className:"w-6 h-6"}),a("profile.pets_cta.title","Your Pets")," ",h.length>0&&`(${h.length})`]}),e.jsx(P,{className:"text-green-700 dark:text-green-400",children:a("profile.pets_cta.desc","Save your pet profiles for faster emergency help")})]}),e.jsx(_,{className:"space-y-4",children:X?e.jsx("div",{className:"text-sm text-green-700 dark:text-green-400",children:a("loading.pets","Loading pets...")}):h.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3",children:h.map(s=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg border border-green-200 dark:border-green-800","data-testid":`pet-card-${s.id}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center text-2xl",children:s.species==="dog"?"ðŸ•":s.species==="cat"?"ðŸˆ":s.species==="bird"?"ðŸ¦œ":s.species==="rabbit"?"ðŸ°":s.species==="hamster"?"ðŸ¹":"ðŸ¾"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100","data-testid":`pet-name-${s.id}`,children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400","data-testid":`pet-info-${s.id}`,children:[s.breed," ",s.age&&`â€¢ ${s.age} ${a("pets.years","years")}`]})]}),e.jsx(u,{href:"/pets",children:e.jsx(l,{variant:"ghost",size:"sm","data-testid":`button-edit-pet-${s.id}`,children:e.jsx(Se,{className:"w-4 h-4"})})})]},s.id))}),e.jsx(u,{href:"/pets",children:e.jsxs(l,{className:"w-full bg-green-600 hover:bg-green-700 text-white dark:bg-green-700 dark:hover:bg-green-600",size:"lg","data-testid":"button-add-pet",children:[e.jsx(j,{className:"w-5 h-5 mr-2"}),a("profile.pets_cta.add_another","Add Another Pet")]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-3 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center",children:e.jsx(j,{className:"w-8 h-8 text-green-600 dark:text-green-400"})}),e.jsx("h4",{className:"font-semibold text-green-800 dark:text-green-300 mb-2",children:a("profile.pets_empty.title","No pets yet")}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-400 mb-4",children:a("profile.pets_empty.desc","Add your first furry kid for faster emergency help. It only takes 30 seconds!")})]}),e.jsx(u,{href:"/pets",children:e.jsxs(l,{className:"w-full bg-green-600 hover:bg-green-700 text-white dark:bg-green-700 dark:hover:bg-green-600",size:"lg","data-testid":"button-add-first-pet",children:[e.jsx(j,{className:"w-5 h-5 mr-2"}),a("profile.pets_cta.button","Add or Manage Pets")]})})]})})]}),e.jsxs(N,{className:"mt-6",children:[e.jsxs(w,{children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-6 h-6"}),a("profile.title","My Profile")]}),e.jsx(P,{children:a("profile.desc","Manage your account information and preferences")})]}),e.jsx(_,{children:e.jsx(pe,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(U),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(c,{control:i.control,name:"name",render:({field:s})=>e.jsxs(p,{children:[e.jsx(m,{children:a("profile.name","Name")}),e.jsx(x,{children:e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400 dark:text-gray-500"}),e.jsx(A,{...s,className:"pl-10",placeholder:a("profile.name_placeholder","Enter your name"),"data-testid":"input-name"})]})}),e.jsx(g,{})]})}),e.jsx(c,{control:i.control,name:"email",render:({field:s})=>e.jsxs(p,{children:[e.jsx(m,{children:a("profile.email","Email")}),e.jsx(x,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Te,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400 dark:text-gray-500"}),e.jsx(A,{...s,type:"email",className:"pl-10",placeholder:a("profile.email_placeholder","you@example.com"),"data-testid":"input-email"})]})}),e.jsx(g,{})]})}),e.jsx(c,{control:i.control,name:"phone",render:({field:s})=>e.jsxs(p,{children:[e.jsxs(m,{children:[a("profile.phone","Phone Number"),e.jsx("span",{className:"text-red-600 dark:text-red-500 ml-1",children:"*"})]}),e.jsx(x,{children:e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400 dark:text-gray-500"}),e.jsx(A,{...s,type:"tel",className:"pl-10",placeholder:a("profile.phone_placeholder","+852 1234 5678"),"data-testid":"input-phone",required:!0})]})}),e.jsx(g,{})]})})]}),e.jsx(R,{type:"single",collapsible:!0,className:"border rounded-lg",children:e.jsxs(z,{value:"settings",className:"border-0",children:[e.jsx(Y,{className:"px-4 hover:no-underline","data-testid":"accordion-settings",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{children:a("profile.settings","Language & Region Settings")})]})}),e.jsxs(V,{className:"px-4 pb-4 space-y-4",children:[e.jsx(c,{control:i.control,name:"languagePreference",render:({field:s})=>e.jsxs(p,{children:[e.jsx(m,{children:a("profile.language","Language Preference")}),e.jsxs(F,{onValueChange:s.onChange,value:s.value,children:[e.jsx(x,{children:e.jsxs(q,{"data-testid":"select-language",children:[e.jsx(K,{className:"w-4 h-4 mr-2 text-gray-400 dark:text-gray-500"}),e.jsx(H,{placeholder:a("profile.language_placeholder","Select language")})]})}),e.jsxs($,{children:[e.jsx(D,{value:"en","data-testid":"option-en",children:"English"}),e.jsx(D,{value:"zh-HK","data-testid":"option-zh",children:"ç¹é«”ä¸­æ–‡"})]})]}),e.jsx(g,{})]})}),e.jsx(c,{control:i.control,name:"regionPreference",render:({field:s})=>e.jsxs(p,{children:[e.jsx(m,{children:a("profile.region","Region Preference")}),e.jsxs(F,{onValueChange:s.onChange,value:s.value,children:[e.jsx(x,{children:e.jsxs(q,{"data-testid":"select-region",children:[e.jsx(xe,{className:"w-4 h-4 mr-2 text-gray-400 dark:text-gray-500"}),e.jsx(H,{placeholder:a("profile.region_placeholder","Select region")})]})}),e.jsx($,{children:W.map(t=>e.jsx(D,{value:t.id,"data-testid":`option-region-${t.code}`,children:B==="en"?t.nameEn:t.nameZh},t.id))})]}),e.jsx(g,{})]})})]})]})}),e.jsxs(l,{type:"submit",className:"w-full",disabled:y.isPending,"data-testid":"button-save-profile",children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),y.isPending?a("profile.saving","Saving..."):a("profile.save","Save Changes")]})]})})})]}),e.jsxs(N,{className:"mt-6 border-gray-200 dark:border-gray-800",children:[e.jsxs(w,{children:[e.jsxs(k,{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300",children:[e.jsx(Le,{className:"w-5 h-5"}),a("profile.privacy.title","Privacy & Data Rights")]}),e.jsx(P,{children:a("profile.privacy.desc","Manage your personal data and privacy settings")})]}),e.jsx(_,{children:e.jsx(R,{type:"single",collapsible:!0,children:e.jsxs(z,{value:"privacy",children:[e.jsx(Y,{"data-testid":"accordion-privacy",children:a("profile.privacy.expand","View privacy options")}),e.jsxs(V,{className:"space-y-6 pt-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2 text-sm text-gray-700 dark:text-gray-300",children:a("profile.privacy.export_title","Export Your Data")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:a("profile.privacy.export_desc","Download a copy of all your personal data in JSON format (GDPR/PDPO compliant)")}),e.jsxs(l,{onClick:ee,variant:"outline",className:"w-full","data-testid":"button-export-data",children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),a("profile.privacy.export_button","Download My Data")]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h4",{className:"font-medium mb-2 text-sm text-gray-700 dark:text-gray-300",children:a("profile.privacy.delete_title","Delete Your Account")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:a("profile.privacy.delete_desc","Permanently delete your account and all associated data. This action cannot be undone.")}),e.jsxs(ve,{children:[e.jsx(be,{asChild:!0,children:e.jsxs(l,{variant:"destructive",className:"w-full","data-testid":"button-delete-account",children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),a("profile.privacy.delete_button","Delete My Account")]})}),e.jsxs(Ne,{children:[e.jsxs(we,{children:[e.jsxs(ke,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-5 h-5 text-red-600 dark:text-red-500"}),a("profile.delete.dialog_title","Are you absolutely sure?")]}),e.jsxs(Pe,{children:[a("profile.delete.dialog_desc","This action cannot be undone. This will permanently delete your account and remove all your data from our servers, including:"),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1 text-sm",children:[e.jsx("li",{children:a("profile.delete.dialog_item1","Your profile and contact information")}),e.jsx("li",{children:a("profile.delete.dialog_item2","All saved pets and their medical history")}),e.jsx("li",{children:a("profile.delete.dialog_item3","All emergency request records")}),e.jsx("li",{children:a("profile.delete.dialog_item4","All privacy consents and preferences")})]})]})]}),e.jsxs(_e,{children:[e.jsx(Ae,{"data-testid":"button-cancel-delete",children:a("profile.delete.dialog_cancel","Cancel")}),e.jsx(De,{onClick:ae,className:"bg-red-600 hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600","data-testid":"button-confirm-delete",children:a("profile.delete.dialog_confirm","Yes, delete my account")})]})]})]})]})]})]})})})]})]})}):(S("/"),null)}export{Ze as default};
