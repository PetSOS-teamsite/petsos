import{c as Y,af as st,r as l,at as $,aP as at,j as e,ag as K,av as ie,au as I,b6 as _,aR as ot,b7 as it,ah as Ie,a as lt,h as be,U as J,B as P,X as ct,aj as dt,Y as ut,_ as ht,$ as mt,a0 as ft,V,I as Z,a1 as xt,C as Se,q as ye,t as je,b as Ne,N as Ce,W as pt,a7 as gt,O as ee,Q as q}from"./index-Dv-87GdI.js";import{u as te}from"./useMutation-DhbY-5L1.js";import{B as re}from"./badge-95hAwcnP.js";import{S as Pe}from"./skeleton-BMaZuR9w.js";import{S as wt}from"./switch-DNY1qyBa.js";import{T as vt}from"./textarea-CXxlry72.js";import{C as bt}from"./checkbox-CR9TChmH.js";import{A as St}from"./arrow-left-BiOU8dRi.js";import{M as B}from"./message-square-uFYLMobp.js";import{P as yt}from"./plus-Bojph4AO.js";import{R as Re}from"./refresh-cw-BE3VGX5S.js";import{S as Ae}from"./send-CUMU5RIS.js";import{S as jt}from"./settings-DTODbNjx.js";import{S as Nt}from"./search-BPoAccfe.js";import{B as Te}from"./building-2-CsNomjhz.js";import{t as S,c as Ct,e as Pt,g as Ee,m as De,a as ne,b as Rt,f as Me}from"./format-CoLFXwEe.js";import{U as At}from"./user-DwTOldS-.js";import{F as Tt}from"./file-text-DWJlC29l.js";import{I as Et}from"./image-DjL1IO7l.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=Y("ArchiveRestore",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h2",key:"tvwodi"}],["path",{d:"M20 8v11a2 2 0 0 1-2 2h-2",key:"1gkqxj"}],["path",{d:"m9 15 3-3 3 3",key:"1pd0qc"}],["path",{d:"M12 12v9",key:"192myk"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=Y("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=Y("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=Y("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=Y("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=Y("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);function se(t,r){const n=S(t),o=S(r),s=n.getTime()-o.getTime();return s<0?-1:s>0?1:s}function _t(t){return Ct(t,Date.now())}function It(t,r){const n=S(t),o=S(r),s=n.getFullYear()-o.getFullYear(),c=n.getMonth()-o.getMonth();return s*12+c}function Ht(t){return r=>{const o=(t?Math[t]:Math.trunc)(r);return o===0?0:o}}function Ft(t,r){return+S(t)-+S(r)}function Ot(t){const r=S(t);return r.setHours(23,59,59,999),r}function Xt(t){const r=S(t),n=r.getMonth();return r.setFullYear(r.getFullYear(),n+1,0),r.setHours(23,59,59,999),r}function zt(t){const r=S(t);return+Ot(r)==+Xt(r)}function Wt(t,r){const n=S(t),o=S(r),s=se(n,o),c=Math.abs(It(n,o));let d;if(c<1)d=0;else{n.getMonth()===1&&n.getDate()>27&&n.setDate(30),n.setMonth(n.getMonth()-s*c);let i=se(n,o)===-s;zt(S(t))&&c===1&&se(t,o)===1&&(i=!1),d=s*(c-Number(i))}return d===0?0:d}function Ut(t,r,n){const o=Ft(t,r)/1e3;return Ht(n==null?void 0:n.roundingMethod)(o)}function Yt(t,r,n){const o=Rt(),s=(n==null?void 0:n.locale)??o.locale??Pt,c=2520,d=se(t,r);if(isNaN(d))throw new RangeError("Invalid time value");const i=Object.assign({},n,{addSuffix:n==null?void 0:n.addSuffix,comparison:d});let u,f;d>0?(u=S(r),f=S(t)):(u=S(t),f=S(r));const h=Ut(f,u),x=(Ee(f)-Ee(u))/1e3,m=Math.round((h-x)/60);let p;if(m<2)return n!=null&&n.includeSeconds?h<5?s.formatDistance("lessThanXSeconds",5,i):h<10?s.formatDistance("lessThanXSeconds",10,i):h<20?s.formatDistance("lessThanXSeconds",20,i):h<40?s.formatDistance("halfAMinute",0,i):h<60?s.formatDistance("lessThanXMinutes",1,i):s.formatDistance("xMinutes",1,i):m===0?s.formatDistance("lessThanXMinutes",1,i):s.formatDistance("xMinutes",m,i);if(m<45)return s.formatDistance("xMinutes",m,i);if(m<90)return s.formatDistance("aboutXHours",1,i);if(m<De){const v=Math.round(m/60);return s.formatDistance("aboutXHours",v,i)}else{if(m<c)return s.formatDistance("xDays",1,i);if(m<ne){const v=Math.round(m/De);return s.formatDistance("xDays",v,i)}else if(m<ne*2)return p=Math.round(m/ne),s.formatDistance("aboutXMonths",p,i)}if(p=Wt(f,u),p<12){const v=Math.round(m/ne);return s.formatDistance("xMonths",v,i)}else{const v=p%12,j=Math.trunc(p/12);return v<3?s.formatDistance("aboutXYears",j,i):v<9?s.formatDistance("overXYears",j,i):s.formatDistance("almostXYears",j+1,i)}}function $t(t,r){return Yt(t,_t(t),r)}function Vt(t,r){return l.useReducer((n,o)=>r[n][o]??n,t)}var me="ScrollArea",[He,Rr]=st(me),[qt,N]=He(me),Fe=l.forwardRef((t,r)=>{const{__scopeScrollArea:n,type:o="hover",dir:s,scrollHideDelay:c=600,...d}=t,[i,u]=l.useState(null),[f,h]=l.useState(null),[x,m]=l.useState(null),[p,v]=l.useState(null),[j,H]=l.useState(null),[R,T]=l.useState(0),[F,C]=l.useState(0),[O,E]=l.useState(!1),[X,M]=l.useState(!1),w=$(r,k=>u(k)),y=at(s);return e.jsx(qt,{scope:n,type:o,dir:y,scrollHideDelay:c,scrollArea:i,viewport:f,onViewportChange:h,content:x,onContentChange:m,scrollbarX:p,onScrollbarXChange:v,scrollbarXEnabled:O,onScrollbarXEnabledChange:E,scrollbarY:j,onScrollbarYChange:H,scrollbarYEnabled:X,onScrollbarYEnabledChange:M,onCornerWidthChange:T,onCornerHeightChange:C,children:e.jsx(K.div,{dir:y,...d,ref:w,style:{position:"relative","--radix-scroll-area-corner-width":R+"px","--radix-scroll-area-corner-height":F+"px",...t.style}})})});Fe.displayName=me;var Oe="ScrollAreaViewport",Xe=l.forwardRef((t,r)=>{const{__scopeScrollArea:n,children:o,nonce:s,...c}=t,d=N(Oe,n),i=l.useRef(null),u=$(r,i,d.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:s}),e.jsx(K.div,{"data-radix-scroll-area-viewport":"",...c,ref:u,style:{overflowX:d.scrollbarXEnabled?"scroll":"hidden",overflowY:d.scrollbarYEnabled?"scroll":"hidden",...t.style},children:e.jsx("div",{ref:d.onContentChange,style:{minWidth:"100%",display:"table"},children:o})})]})});Xe.displayName=Oe;var A="ScrollAreaScrollbar",fe=l.forwardRef((t,r)=>{const{forceMount:n,...o}=t,s=N(A,t.__scopeScrollArea),{onScrollbarXEnabledChange:c,onScrollbarYEnabledChange:d}=s,i=t.orientation==="horizontal";return l.useEffect(()=>(i?c(!0):d(!0),()=>{i?c(!1):d(!1)}),[i,c,d]),s.type==="hover"?e.jsx(Bt,{...o,ref:r,forceMount:n}):s.type==="scroll"?e.jsx(Kt,{...o,ref:r,forceMount:n}):s.type==="auto"?e.jsx(ze,{...o,ref:r,forceMount:n}):s.type==="always"?e.jsx(xe,{...o,ref:r}):null});fe.displayName=A;var Bt=l.forwardRef((t,r)=>{const{forceMount:n,...o}=t,s=N(A,t.__scopeScrollArea),[c,d]=l.useState(!1);return l.useEffect(()=>{const i=s.scrollArea;let u=0;if(i){const f=()=>{window.clearTimeout(u),d(!0)},h=()=>{u=window.setTimeout(()=>d(!1),s.scrollHideDelay)};return i.addEventListener("pointerenter",f),i.addEventListener("pointerleave",h),()=>{window.clearTimeout(u),i.removeEventListener("pointerenter",f),i.removeEventListener("pointerleave",h)}}},[s.scrollArea,s.scrollHideDelay]),e.jsx(ie,{present:n||c,children:e.jsx(ze,{"data-state":c?"visible":"hidden",...o,ref:r})})}),Kt=l.forwardRef((t,r)=>{const{forceMount:n,...o}=t,s=N(A,t.__scopeScrollArea),c=t.orientation==="horizontal",d=ce(()=>u("SCROLL_END"),100),[i,u]=Vt("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return l.useEffect(()=>{if(i==="idle"){const f=window.setTimeout(()=>u("HIDE"),s.scrollHideDelay);return()=>window.clearTimeout(f)}},[i,s.scrollHideDelay,u]),l.useEffect(()=>{const f=s.viewport,h=c?"scrollLeft":"scrollTop";if(f){let x=f[h];const m=()=>{const p=f[h];x!==p&&(u("SCROLL"),d()),x=p};return f.addEventListener("scroll",m),()=>f.removeEventListener("scroll",m)}},[s.viewport,c,u,d]),e.jsx(ie,{present:n||i!=="hidden",children:e.jsx(xe,{"data-state":i==="hidden"?"hidden":"visible",...o,ref:r,onPointerEnter:I(t.onPointerEnter,()=>u("POINTER_ENTER")),onPointerLeave:I(t.onPointerLeave,()=>u("POINTER_LEAVE"))})})}),ze=l.forwardRef((t,r)=>{const n=N(A,t.__scopeScrollArea),{forceMount:o,...s}=t,[c,d]=l.useState(!1),i=t.orientation==="horizontal",u=ce(()=>{if(n.viewport){const f=n.viewport.offsetWidth<n.viewport.scrollWidth,h=n.viewport.offsetHeight<n.viewport.scrollHeight;d(i?f:h)}},10);return U(n.viewport,u),U(n.content,u),e.jsx(ie,{present:o||c,children:e.jsx(xe,{"data-state":c?"visible":"hidden",...s,ref:r})})}),xe=l.forwardRef((t,r)=>{const{orientation:n="vertical",...o}=t,s=N(A,t.__scopeScrollArea),c=l.useRef(null),d=l.useRef(0),[i,u]=l.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),f=Ve(i.viewport,i.content),h={...o,sizes:i,onSizesChange:u,hasThumb:f>0&&f<1,onThumbChange:m=>c.current=m,onThumbPointerUp:()=>d.current=0,onThumbPointerDown:m=>d.current=m};function x(m,p){return tr(m,d.current,i,p)}return n==="horizontal"?e.jsx(Qt,{...h,ref:r,onThumbPositionChange:()=>{if(s.viewport&&c.current){const m=s.viewport.scrollLeft,p=_e(m,i,s.dir);c.current.style.transform=`translate3d(${p}px, 0, 0)`}},onWheelScroll:m=>{s.viewport&&(s.viewport.scrollLeft=m)},onDragScroll:m=>{s.viewport&&(s.viewport.scrollLeft=x(m,s.dir))}}):n==="vertical"?e.jsx(Gt,{...h,ref:r,onThumbPositionChange:()=>{if(s.viewport&&c.current){const m=s.viewport.scrollTop,p=_e(m,i);c.current.style.transform=`translate3d(0, ${p}px, 0)`}},onWheelScroll:m=>{s.viewport&&(s.viewport.scrollTop=m)},onDragScroll:m=>{s.viewport&&(s.viewport.scrollTop=x(m))}}):null}),Qt=l.forwardRef((t,r)=>{const{sizes:n,onSizesChange:o,...s}=t,c=N(A,t.__scopeScrollArea),[d,i]=l.useState(),u=l.useRef(null),f=$(r,u,c.onScrollbarXChange);return l.useEffect(()=>{u.current&&i(getComputedStyle(u.current))},[u]),e.jsx(Ue,{"data-orientation":"horizontal",...s,ref:f,sizes:n,style:{bottom:0,left:c.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:c.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":le(n)+"px",...t.style},onThumbPointerDown:h=>t.onThumbPointerDown(h.x),onDragScroll:h=>t.onDragScroll(h.x),onWheelScroll:(h,x)=>{if(c.viewport){const m=c.viewport.scrollLeft+h.deltaX;t.onWheelScroll(m),Be(m,x)&&h.preventDefault()}},onResize:()=>{u.current&&c.viewport&&d&&o({content:c.viewport.scrollWidth,viewport:c.viewport.offsetWidth,scrollbar:{size:u.current.clientWidth,paddingStart:oe(d.paddingLeft),paddingEnd:oe(d.paddingRight)}})}})}),Gt=l.forwardRef((t,r)=>{const{sizes:n,onSizesChange:o,...s}=t,c=N(A,t.__scopeScrollArea),[d,i]=l.useState(),u=l.useRef(null),f=$(r,u,c.onScrollbarYChange);return l.useEffect(()=>{u.current&&i(getComputedStyle(u.current))},[u]),e.jsx(Ue,{"data-orientation":"vertical",...s,ref:f,sizes:n,style:{top:0,right:c.dir==="ltr"?0:void 0,left:c.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":le(n)+"px",...t.style},onThumbPointerDown:h=>t.onThumbPointerDown(h.y),onDragScroll:h=>t.onDragScroll(h.y),onWheelScroll:(h,x)=>{if(c.viewport){const m=c.viewport.scrollTop+h.deltaY;t.onWheelScroll(m),Be(m,x)&&h.preventDefault()}},onResize:()=>{u.current&&c.viewport&&d&&o({content:c.viewport.scrollHeight,viewport:c.viewport.offsetHeight,scrollbar:{size:u.current.clientHeight,paddingStart:oe(d.paddingTop),paddingEnd:oe(d.paddingBottom)}})}})}),[Jt,We]=He(A),Ue=l.forwardRef((t,r)=>{const{__scopeScrollArea:n,sizes:o,hasThumb:s,onThumbChange:c,onThumbPointerUp:d,onThumbPointerDown:i,onThumbPositionChange:u,onDragScroll:f,onWheelScroll:h,onResize:x,...m}=t,p=N(A,n),[v,j]=l.useState(null),H=$(r,w=>j(w)),R=l.useRef(null),T=l.useRef(""),F=p.viewport,C=o.content-o.viewport,O=_(h),E=_(u),X=ce(x,10);function M(w){if(R.current){const y=w.clientX-R.current.left,k=w.clientY-R.current.top;f({x:y,y:k})}}return l.useEffect(()=>{const w=y=>{const k=y.target;(v==null?void 0:v.contains(k))&&O(y,C)};return document.addEventListener("wheel",w,{passive:!1}),()=>document.removeEventListener("wheel",w,{passive:!1})},[F,v,C,O]),l.useEffect(E,[o,E]),U(v,X),U(p.content,X),e.jsx(Jt,{scope:n,scrollbar:v,hasThumb:s,onThumbChange:_(c),onThumbPointerUp:_(d),onThumbPositionChange:E,onThumbPointerDown:_(i),children:e.jsx(K.div,{...m,ref:H,style:{position:"absolute",...m.style},onPointerDown:I(t.onPointerDown,w=>{w.button===0&&(w.target.setPointerCapture(w.pointerId),R.current=v.getBoundingClientRect(),T.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",p.viewport&&(p.viewport.style.scrollBehavior="auto"),M(w))}),onPointerMove:I(t.onPointerMove,M),onPointerUp:I(t.onPointerUp,w=>{const y=w.target;y.hasPointerCapture(w.pointerId)&&y.releasePointerCapture(w.pointerId),document.body.style.webkitUserSelect=T.current,p.viewport&&(p.viewport.style.scrollBehavior=""),R.current=null})})})}),ae="ScrollAreaThumb",Ye=l.forwardRef((t,r)=>{const{forceMount:n,...o}=t,s=We(ae,t.__scopeScrollArea);return e.jsx(ie,{present:n||s.hasThumb,children:e.jsx(Zt,{ref:r,...o})})}),Zt=l.forwardRef((t,r)=>{const{__scopeScrollArea:n,style:o,...s}=t,c=N(ae,n),d=We(ae,n),{onThumbPositionChange:i}=d,u=$(r,x=>d.onThumbChange(x)),f=l.useRef(void 0),h=ce(()=>{f.current&&(f.current(),f.current=void 0)},100);return l.useEffect(()=>{const x=c.viewport;if(x){const m=()=>{if(h(),!f.current){const p=rr(x,i);f.current=p,i()}};return i(),x.addEventListener("scroll",m),()=>x.removeEventListener("scroll",m)}},[c.viewport,h,i]),e.jsx(K.div,{"data-state":d.hasThumb?"visible":"hidden",...s,ref:u,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...o},onPointerDownCapture:I(t.onPointerDownCapture,x=>{const p=x.target.getBoundingClientRect(),v=x.clientX-p.left,j=x.clientY-p.top;d.onThumbPointerDown({x:v,y:j})}),onPointerUp:I(t.onPointerUp,d.onThumbPointerUp)})});Ye.displayName=ae;var pe="ScrollAreaCorner",$e=l.forwardRef((t,r)=>{const n=N(pe,t.__scopeScrollArea),o=!!(n.scrollbarX&&n.scrollbarY);return n.type!=="scroll"&&o?e.jsx(er,{...t,ref:r}):null});$e.displayName=pe;var er=l.forwardRef((t,r)=>{const{__scopeScrollArea:n,...o}=t,s=N(pe,n),[c,d]=l.useState(0),[i,u]=l.useState(0),f=!!(c&&i);return U(s.scrollbarX,()=>{var x;const h=((x=s.scrollbarX)==null?void 0:x.offsetHeight)||0;s.onCornerHeightChange(h),u(h)}),U(s.scrollbarY,()=>{var x;const h=((x=s.scrollbarY)==null?void 0:x.offsetWidth)||0;s.onCornerWidthChange(h),d(h)}),f?e.jsx(K.div,{...o,ref:r,style:{width:c,height:i,position:"absolute",right:s.dir==="ltr"?0:void 0,left:s.dir==="rtl"?0:void 0,bottom:0,...t.style}}):null});function oe(t){return t?parseInt(t,10):0}function Ve(t,r){const n=t/r;return isNaN(n)?0:n}function le(t){const r=Ve(t.viewport,t.content),n=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,o=(t.scrollbar.size-n)*r;return Math.max(o,18)}function tr(t,r,n,o="ltr"){const s=le(n),c=s/2,d=r||c,i=s-d,u=n.scrollbar.paddingStart+d,f=n.scrollbar.size-n.scrollbar.paddingEnd-i,h=n.content-n.viewport,x=o==="ltr"?[0,h]:[h*-1,0];return qe([u,f],x)(t)}function _e(t,r,n="ltr"){const o=le(r),s=r.scrollbar.paddingStart+r.scrollbar.paddingEnd,c=r.scrollbar.size-s,d=r.content-r.viewport,i=c-o,u=n==="ltr"?[0,d]:[d*-1,0],f=it(t,u);return qe([0,d],[0,i])(f)}function qe(t,r){return n=>{if(t[0]===t[1]||r[0]===r[1])return r[0];const o=(r[1]-r[0])/(t[1]-t[0]);return r[0]+o*(n-t[0])}}function Be(t,r){return t>0&&t<r}var rr=(t,r=()=>{})=>{let n={left:t.scrollLeft,top:t.scrollTop},o=0;return function s(){const c={left:t.scrollLeft,top:t.scrollTop},d=n.left!==c.left,i=n.top!==c.top;(d||i)&&r(),n=c,o=window.requestAnimationFrame(s)}(),()=>window.cancelAnimationFrame(o)};function ce(t,r){const n=_(t),o=l.useRef(0);return l.useEffect(()=>()=>window.clearTimeout(o.current),[]),l.useCallback(()=>{window.clearTimeout(o.current),o.current=window.setTimeout(n,r)},[n,r])}function U(t,r){const n=_(r);ot(()=>{let o=0;if(t){const s=new ResizeObserver(()=>{cancelAnimationFrame(o),o=window.requestAnimationFrame(n)});return s.observe(t),()=>{window.cancelAnimationFrame(o),s.unobserve(t)}}},[t,n])}var Ke=Fe,nr=Xe,sr=$e;const he=l.forwardRef(({className:t,children:r,...n},o)=>e.jsxs(Ke,{ref:o,className:Ie("relative overflow-hidden",t),...n,children:[e.jsx(nr,{className:"h-full w-full rounded-[inherit]",children:r}),e.jsx(Qe,{}),e.jsx(sr,{})]}));he.displayName=Ke.displayName;const Qe=l.forwardRef(({className:t,orientation:r="vertical",...n},o)=>e.jsx(fe,{ref:o,orientation:r,className:Ie("flex touch-none select-none transition-colors",r==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",r==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...n,children:e.jsx(Ye,{className:"relative flex-1 rounded-full bg-border"})}));Qe.displayName=fe.displayName;function ar(t,r){if(r)return e.jsx(Le,{className:"h-3 w-3 text-blue-500"});switch(t){case"delivered":return e.jsx(Le,{className:"h-3 w-3 text-gray-400"});case"sent":return e.jsx(gt,{className:"h-3 w-3 text-gray-400"});case"failed":return e.jsx("span",{className:"text-xs text-red-500",children:"!"});default:return e.jsx(pt,{className:"h-3 w-3 text-gray-400"})}}function or(){try{const t=new(window.AudioContext||window.webkitAudioContext),r=t.createOscillator(),n=t.createGain();r.connect(n),n.connect(t.destination),r.frequency.value=800,r.type="sine",n.gain.setValueAtTime(.3,t.currentTime),n.gain.exponentialRampToValueAtTime(.01,t.currentTime+.3),r.start(t.currentTime),r.stop(t.currentTime+.3)}catch(t){console.log("Could not play notification sound:",t)}}function ir({message:t}){const r=t.direction==="outbound";if(!t.mediaUrl&&t.messageType==="text")return null;const n=r?"text-green-100":"text-gray-500";switch(t.messageType){case"image":return e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Et,{className:`h-4 w-4 ${n}`}),e.jsx("span",{className:"text-xs opacity-75",children:"Image"}),t.mediaUrl&&e.jsx("a",{href:t.mediaUrl,target:"_blank",rel:"noopener noreferrer",className:"text-xs underline opacity-75 hover:opacity-100","data-testid":`media-link-${t.id}`,children:"View"})]});case"document":return e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Tt,{className:`h-4 w-4 ${n}`}),e.jsx("span",{className:"text-xs opacity-75",children:"Document"}),t.mediaUrl&&e.jsx("a",{href:t.mediaUrl,target:"_blank",rel:"noopener noreferrer",className:"text-xs underline opacity-75 hover:opacity-100","data-testid":`media-link-${t.id}`,children:"Download"})]});case"audio":case"video":return e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Mt,{className:`h-4 w-4 ${n}`}),e.jsx("span",{className:"text-xs opacity-75",children:t.messageType==="audio"?"Audio":"Video"}),t.mediaUrl&&e.jsx("a",{href:t.mediaUrl,target:"_blank",rel:"noopener noreferrer",className:"text-xs underline opacity-75 hover:opacity-100","data-testid":`media-link-${t.id}`,children:"Play"})]});default:return null}}function Ar(){const{toast:t}=lt(),[r,n]=l.useState(null),[o,s]=l.useState(!1),[c,d]=l.useState(""),i=l.useRef(null),[u,f]=l.useState(null),[h,x]=l.useState(""),[m,p]=l.useState(!1),[v,j]=l.useState("+852"),[H,R]=l.useState(""),[T,F]=l.useState(""),[C,O]=l.useState(()=>typeof window<"u"?localStorage.getItem("chatSoundEnabled")!=="false":!0),[E,X]=l.useState(()=>typeof window<"u"?localStorage.getItem("chatReadReceipts")==="true":!1),M=l.useRef(void 0),{data:w,isLoading:y,refetch:k}=be({queryKey:["/api/admin/conversations",o],queryFn:async()=>{const a=await fetch(`/api/admin/conversations?includeArchived=${o}`,{credentials:"include"});if(!a.ok)throw new Error("Failed to fetch conversations");return a.json()},refetchInterval:1e4}),g=w==null?void 0:w.find(a=>a.id===r),{data:L,isLoading:Ge,refetch:Je}=be({queryKey:["/api/admin/conversations",r,"messages"],queryFn:async()=>{if(!r)return[];const a=await fetch(`/api/admin/conversations/${r}/messages`,{credentials:"include"});if(!a.ok)throw new Error("Failed to fetch messages");return a.json()},enabled:!!r,refetchInterval:r?5e3:!1}),Ze=te({mutationFn:a=>ee("POST",`/api/admin/conversations/${a}/read`),onSuccess:()=>{q.invalidateQueries({queryKey:["/api/admin/conversations"]})}}),ge=te({mutationFn:({id:a,archive:b})=>ee("POST",`/api/admin/conversations/${a}/archive`,{archive:b}),onSuccess:(a,b)=>{t({title:b.archive?"Conversation Archived":"Conversation Restored",description:b.archive?"The conversation has been archived":"The conversation has been restored"}),q.invalidateQueries({queryKey:["/api/admin/conversations"]}),b.archive&&r===b.id&&n(null)},onError:a=>{t({title:"Error",description:a.message||"Failed to archive conversation",variant:"destructive"})}}),de=te({mutationFn:({id:a,content:b})=>ee("POST",`/api/admin/conversations/${a}/reply`,{content:b}),onMutate:async({content:a})=>{const b={id:`temp-${Date.now()}`,conversationId:r,direction:"outbound",content:a,messageType:"text",status:"sent",whatsappMessageId:null,mediaUrl:null,sentAt:new Date,deliveredAt:null,readAt:null,errorMessage:null,createdAt:new Date};return f(b),d(""),{optimisticMessage:b}},onSuccess:()=>{f(null),q.invalidateQueries({queryKey:["/api/admin/conversations",r,"messages"]}),q.invalidateQueries({queryKey:["/api/admin/conversations"]})},onError:a=>{f(null),t({title:"Failed to send message",description:a.message||"Please try again",variant:"destructive"})}}),ue=te({mutationFn:async({phoneNumber:a,displayName:b,message:D})=>{const Q=await ee("POST","/api/admin/conversations/new",{phoneNumber:a,displayName:b||void 0,content:D}),{conversation:G}=await Q.json();return G},onSuccess:a=>{t({title:"Conversation Created",description:"New conversation started successfully"}),p(!1),j("+852"),R(""),F(""),q.invalidateQueries({queryKey:["/api/admin/conversations"]}),n(a.id)},onError:a=>{t({title:"Failed to create conversation",description:a.message||"Please try again",variant:"destructive"})}});l.useEffect(()=>{r&&(g!=null&&g.unreadCount)&&g.unreadCount>0&&Ze.mutate(r)},[r,g==null?void 0:g.unreadCount]),l.useEffect(()=>{var a;(a=i.current)==null||a.scrollIntoView({behavior:"smooth"})},[L,u]),l.useEffect(()=>{typeof window<"u"&&localStorage.setItem("chatSoundEnabled",String(C))},[C]),l.useEffect(()=>{typeof window<"u"&&localStorage.setItem("chatReadReceipts",String(E))},[E]),l.useEffect(()=>{if(L&&M.current&&C){const a=new Set(M.current.map(D=>D.id));L.filter(D=>!a.has(D.id)&&D.direction==="inbound").length>0&&or()}M.current=L},[L,C]);const we=()=>{!c.trim()||!r||de.mutate({id:r,content:c.trim()})},et=a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),we())},tt=()=>{k(),r&&Je(),t({title:"Refreshed",description:"Conversations and messages have been refreshed"})},z=u?[...L||[],u]:L,W=w==null?void 0:w.filter(a=>{var D,Q,G;if(!h.trim())return!0;const b=h.toLowerCase();return((D=a.displayName)==null?void 0:D.toLowerCase().includes(b))||((Q=a.phoneNumber)==null?void 0:Q.toLowerCase().includes(b))||((G=a.lastMessagePreview)==null?void 0:G.toLowerCase().includes(b))}),ve=(w==null?void 0:w.reduce((a,b)=>a+(b.unreadCount||0),0))||0,rt=()=>{O(a=>!a)},nt=()=>{!v.trim()||!T.trim()||ue.mutate({phoneNumber:v.trim(),displayName:H.trim()||void 0,message:T.trim()})};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-white to-gray-50 dark:from-gray-900 dark:to-gray-800",children:[e.jsx("header",{className:"border-b border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 sticky top-0 z-10",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(J,{href:"/admin",children:e.jsx(P,{variant:"ghost",size:"icon","data-testid":"button-back",children:e.jsx(St,{className:"h-5 w-5"})})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(B,{className:"h-6 w-6 text-green-600"}),"WhatsApp Chats",ve>0&&e.jsx(re,{variant:"destructive",className:"ml-2","data-testid":"badge-unread-total",children:ve})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Two-way messaging with hospitals"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{variant:"outline",size:"icon",onClick:rt,title:C?"Mute notifications":"Unmute notifications","data-testid":"button-toggle-sound",children:C?e.jsx(kt,{className:"h-4 w-4"}):e.jsx(Lt,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs(ct,{open:m,onOpenChange:p,children:[e.jsx(dt,{asChild:!0,children:e.jsx(P,{variant:"outline",size:"icon","data-testid":"button-new-chat",children:e.jsx(yt,{className:"h-4 w-4"})})}),e.jsxs(ut,{"data-testid":"dialog-new-chat",children:[e.jsxs(ht,{children:[e.jsx(mt,{children:"Start New Conversation"}),e.jsx(ft,{children:"Send a message to a new phone number to start a conversation."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"new-chat-phone",children:"Phone Number"}),e.jsx(Z,{id:"new-chat-phone",value:v,onChange:a=>j(a.target.value),placeholder:"+852 XXXX XXXX","data-testid":"input-new-chat-phone"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Include country code (e.g., +852 for Hong Kong)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"new-chat-name",children:"Display Name (Optional)"}),e.jsx(Z,{id:"new-chat-name",value:H,onChange:a=>R(a.target.value),placeholder:"Hospital Name or Contact","data-testid":"input-new-chat-name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"new-chat-message",children:"Initial Message"}),e.jsx(vt,{id:"new-chat-message",value:T,onChange:a=>F(a.target.value),placeholder:"Type your message...",rows:4,"data-testid":"input-new-chat-message"})]})]}),e.jsxs(xt,{children:[e.jsx(P,{variant:"outline",onClick:()=>p(!1),"data-testid":"button-cancel-new-chat",children:"Cancel"}),e.jsx(P,{onClick:nt,disabled:!v.trim()||!T.trim()||ue.isPending,"data-testid":"button-send-new-chat",children:ue.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"h-4 w-4 mr-2 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Send"]})})]})]})]}),e.jsx(P,{variant:"outline",size:"icon",onClick:tt,"data-testid":"button-refresh",children:e.jsx(Re,{className:`h-4 w-4 ${y?"animate-spin":""}`})}),e.jsxs("div",{className:"hidden sm:flex gap-2",children:[e.jsx(J,{href:"/admin/messages",children:e.jsxs(P,{variant:"outline",size:"sm","data-testid":"button-broadcast-messages",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Broadcasts"]})}),e.jsx(J,{href:"/admin/config",children:e.jsxs(P,{variant:"outline",size:"sm","data-testid":"button-admin-config",children:[e.jsx(jt,{className:"h-4 w-4 mr-2"}),"Config"]})})]})]})]})})}),e.jsx("main",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 h-[calc(100vh-180px)]",children:[e.jsxs(Se,{className:"lg:w-1/3 flex flex-col","data-testid":"panel-conversations",children:[e.jsxs(ye,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(je,{className:"text-lg",children:"Conversations"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{htmlFor:"show-archived",className:"text-sm text-muted-foreground",children:"Archived"}),e.jsx(wt,{id:"show-archived",checked:o,onCheckedChange:s,"data-testid":"switch-show-archived"})]})]}),e.jsxs("div",{className:"relative mt-3",children:[e.jsx(Nt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Z,{value:h,onChange:a=>x(a.target.value),placeholder:"Search conversations...",className:"pl-9","data-testid":"input-search-conversations"})]})]}),e.jsx(Ne,{className:"flex-1 overflow-hidden p-0",children:e.jsx(he,{className:"h-full",children:y?e.jsx("div",{className:"space-y-2 p-4",children:[1,2,3,4,5].map(a=>e.jsx(Pe,{className:"h-16 w-full"},a))}):(W==null?void 0:W.length)===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center text-muted-foreground",children:[e.jsx(B,{className:"h-12 w-12 mb-4 opacity-50"}),e.jsx("p",{children:"No conversations found"}),e.jsx("p",{className:"text-sm",children:h?"Try a different search term":"Incoming messages from hospitals will appear here"})]}):e.jsx("div",{className:"divide-y",children:W==null?void 0:W.map(a=>e.jsx("button",{onClick:()=>n(a.id),className:`w-full text-left px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors ${r===a.id?"bg-primary/5 border-l-4 border-primary":""} ${a.isArchived?"opacity-60":""}`,"data-testid":`conversation-item-${a.id}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium truncate",children:a.displayName||a.phoneNumber}),a.hospitalId&&e.jsxs(re,{variant:"secondary",className:"flex-shrink-0 text-xs",children:[e.jsx(Te,{className:"h-3 w-3 mr-1"}),"Hospital"]}),a.isArchived&&e.jsxs(re,{variant:"outline",className:"flex-shrink-0 text-xs",children:[e.jsx(ke,{className:"h-3 w-3 mr-1"}),"Archived"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground mt-0.5",children:[e.jsx(Ce,{className:"h-3 w-3"}),e.jsx("span",{className:"font-mono",children:a.phoneNumber})]}),a.lastMessagePreview&&e.jsx("p",{className:"text-sm text-muted-foreground truncate mt-1",children:a.lastMessagePreview})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1 flex-shrink-0",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:a.lastMessageAt?$t(new Date(a.lastMessageAt),{addSuffix:!0}):"No messages"}),(a.unreadCount||0)>0&&e.jsx(re,{variant:"destructive",className:"h-5 min-w-5 flex items-center justify-center text-xs","data-testid":`unread-badge-${a.id}`,children:a.unreadCount})]})]})},a.id))})})})]}),e.jsx(Se,{className:"lg:w-2/3 flex flex-col","data-testid":"panel-messages",children:r?e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"pb-3 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center",children:e.jsx(At,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx(je,{className:"text-lg",children:(g==null?void 0:g.displayName)||(g==null?void 0:g.phoneNumber)}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(Ce,{className:"h-3 w-3"}),g==null?void 0:g.phoneNumber]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mr-2",title:"Send read receipts when viewing messages",children:[e.jsx(bt,{id:"read-receipts",checked:E,onCheckedChange:a=>X(a===!0),"data-testid":"checkbox-read-receipts"}),e.jsx(V,{htmlFor:"read-receipts",className:"text-xs text-muted-foreground cursor-pointer",children:"Read receipts"})]}),(g==null?void 0:g.hospitalId)&&e.jsx(J,{href:`/admin/hospitals?id=${g==null?void 0:g.hospitalId}`,children:e.jsxs(P,{variant:"outline",size:"sm","data-testid":"button-view-hospital",children:[e.jsx(Te,{className:"h-4 w-4 mr-1"}),"View Hospital"]})}),e.jsx(P,{variant:"outline",size:"sm",onClick:()=>ge.mutate({id:r,archive:!(g!=null&&g.isArchived)}),disabled:ge.isPending,"data-testid":"button-archive",children:g!=null&&g.isArchived?e.jsxs(e.Fragment,{children:[e.jsx(Dt,{className:"h-4 w-4 mr-1"}),"Restore"]}):e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"h-4 w-4 mr-1"}),"Archive"]})})]})]})}),e.jsx(Ne,{className:"flex-1 overflow-hidden p-0",children:e.jsx(he,{className:"h-full p-4",children:Ge?e.jsx("div",{className:"space-y-4",children:[1,2,3,4].map(a=>e.jsx("div",{className:`flex ${a%2===0?"justify-end":"justify-start"}`,children:e.jsx(Pe,{className:"h-12 w-48 rounded-lg"})},a))}):(z==null?void 0:z.length)===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center text-muted-foreground",children:[e.jsx(B,{className:"h-12 w-12 mb-4 opacity-50"}),e.jsx("p",{children:"No messages yet"}),e.jsx("p",{className:"text-sm",children:"Send a message to start the conversation"})]}):e.jsxs("div",{className:"space-y-3",children:[z==null?void 0:z.map(a=>e.jsx("div",{className:`flex ${a.direction==="outbound"?"justify-end":"justify-start"}`,"data-testid":`message-${a.id}`,children:e.jsxs("div",{className:`max-w-[75%] rounded-lg px-4 py-2 ${a.direction==="outbound"?"bg-green-600 text-white":"bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white"}`,children:[e.jsx(ir,{message:a}),a.content&&e.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:a.content}),e.jsxs("div",{className:`flex items-center gap-1 mt-1 text-xs ${a.direction==="outbound"?"text-green-100 justify-end":"text-gray-500"}`,children:[e.jsx("span",{children:a.sentAt?Me(new Date(a.sentAt),"HH:mm"):a.createdAt?Me(new Date(a.createdAt),"HH:mm"):""}),a.direction==="outbound"&&ar(a.status,a.readAt)]})]})},a.id)),e.jsx("div",{ref:i})]})})}),e.jsx("div",{className:"p-4 border-t",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Z,{value:c,onChange:a=>d(a.target.value),onKeyPress:et,placeholder:"Type a message...",disabled:de.isPending,className:"flex-1","data-testid":"input-reply"}),e.jsxs(P,{onClick:we,disabled:!c.trim()||de.isPending,"data-testid":"button-send",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Send"]})]})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center text-muted-foreground",children:[e.jsx(B,{className:"h-16 w-16 mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Select a Conversation"}),e.jsx("p",{className:"text-sm max-w-md",children:"Choose a conversation from the list on the left to view messages and reply to hospitals."})]})})]})})]})}export{Ar as default};
