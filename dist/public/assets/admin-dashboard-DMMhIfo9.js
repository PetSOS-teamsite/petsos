import{r as b,h as S,j as e,U as r,B as t,a4 as R,C as n,b as d,d as y,W as E,I as G,E as T,G as A,H as z,J as L,K as l,q as J,t as O,M as W,N as X,Q as _}from"./index-Dv-87GdI.js";import{T as $,a as Y,b as F,c as h,d as Z,e as j}from"./table-DMjnPR7m.js";import{B as g}from"./badge-95hAwcnP.js";import{S as q}from"./skeleton-BMaZuR9w.js";import{A as ee}from"./arrow-left-BiOU8dRi.js";import{R as se}from"./refresh-cw-BE3VGX5S.js";import{U as ae}from"./users-DtJmq_Pu.js";import{H as te}from"./heart-BbO8-c7g.js";import{B as U}from"./building-2-CsNomjhz.js";import{S as re}from"./stethoscope-B9rk-pdg.js";import{M as le}from"./message-square-uFYLMobp.js";import{M as ie}from"./messages-square-PQj76FVx.js";import{T as ne}from"./trending-up-CRbktgNp.js";import{S as de}from"./settings-DTODbNjx.js";import{C as I}from"./circle-check-C1_Cff8L.js";import{C as ce}from"./calendar-CkFmbf76.js";import{S as xe}from"./search-BPoAccfe.js";import{C as oe}from"./circle-x-B1liBFqw.js";import{f as me}from"./format-CoLFXwEe.js";function Me(){const[N,H]=b.useState(""),[v,M]=b.useState("all"),[w,B]=b.useState("all"),[c,D]=b.useState("all"),{data:a,isLoading:x}=S({queryKey:["/api/emergency-requests"],refetchInterval:1e4}),{data:o}=S({queryKey:["/api/regions"]}),{data:k}=S({queryKey:["/api/admin/conversations/unread-count"],refetchInterval:3e4}),m={total:(a==null?void 0:a.length)??0,pending:((a==null?void 0:a.filter(s=>s.status==="pending"))??[]).length,active:((a==null?void 0:a.filter(s=>s.status==="broadcasting"))??[]).length,completed:((a==null?void 0:a.filter(s=>s.status==="completed"))??[]).length,last24Hours:((a==null?void 0:a.filter(s=>{const i=new Date(s.createdAt);return new Date().getTime()-i.getTime()<24*60*60*1e3}))??[]).length},C=(a==null?void 0:a.filter(s=>{var i,u;if(N){const p=N.toLowerCase(),P=(i=s.symptom)==null?void 0:i.toLowerCase().includes(p),f=(u=s.manualLocation)==null?void 0:u.toLowerCase().includes(p);if(!P&&!f)return!1}if(v!=="all"&&s.status!==v||w!=="all"&&s.regionId!==w)return!1;if(c!=="all"){const p=new Date(s.createdAt),f=new Date().getTime()-p.getTime();if(c==="1h"&&f>60*60*1e3||c==="24h"&&f>24*60*60*1e3||c==="7d"&&f>7*24*60*60*1e3)return!1}return!0}))??[],K=()=>{_.invalidateQueries({queryKey:["/api/emergency-requests"]})},Q=s=>{switch(s){case"pending":return e.jsxs(g,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",children:[e.jsx(E,{className:"h-3 w-3 mr-1"}),"Pending"]});case"broadcasting":return e.jsxs(g,{variant:"secondary",className:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",children:[e.jsx(y,{className:"h-3 w-3 mr-1"}),"Broadcasting"]});case"completed":return e.jsxs(g,{variant:"secondary",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[e.jsx(I,{className:"h-3 w-3 mr-1"}),"Completed"]});case"cancelled":return e.jsxs(g,{variant:"secondary",className:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200",children:[e.jsx(oe,{className:"h-3 w-3 mr-1"}),"Cancelled"]});default:return e.jsx(g,{variant:"outline",children:s})}},V=s=>{if(!s)return"Unknown";const i=o==null?void 0:o.find(u=>u.id===s);return i?i.nameEn:s};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-white to-gray-50 dark:from-gray-900 dark:to-gray-800",children:[e.jsx("header",{className:"border-b border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 sticky top-0 z-10",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(r,{href:"/",children:e.jsx(t,{variant:"ghost",size:"icon","data-testid":"button-back",children:e.jsx(ee,{className:"h-5 w-5"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Admin: Emergency Queue"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Monitor and manage active emergency requests"})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(t,{onClick:K,variant:"outline",size:"sm","data-testid":"button-refresh",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsx(r,{href:"/admin/users",children:e.jsxs(t,{variant:"outline",size:"sm","data-testid":"button-admin-users",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Users"]})}),e.jsx(r,{href:"/admin/pets",children:e.jsxs(t,{variant:"outline",size:"sm","data-testid":"button-admin-pets",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Pets"]})}),e.jsx(r,{href:"/admin/clinics",children:e.jsxs(t,{variant:"outline",size:"sm","data-testid":"button-admin-clinics",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Clinics"]})}),e.jsx(r,{href:"/admin/hospitals",children:e.jsxs(t,{variant:"outline",size:"sm","data-testid":"button-admin-hospitals",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Hospitals"]})}),e.jsx(r,{href:"/admin/diagnostics",children:e.jsxs(t,{variant:"outline",size:"sm","data-testid":"button-admin-diagnostics",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Diagnostics"]})}),e.jsx(r,{href:"/admin/notifications",children:e.jsxs(t,{variant:"outline",size:"sm","data-testid":"button-admin-notifications",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Notifications"]})}),e.jsx(r,{href:"/admin/messages",children:e.jsxs(t,{variant:"outline",size:"sm","data-testid":"button-admin-messages",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Messages"]})}),e.jsx(r,{href:"/admin/chats",children:e.jsxs(t,{variant:"outline",size:"sm",className:"relative","data-testid":"button-admin-chats",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Chats",k&&k.unreadConversations>0&&e.jsx(g,{className:"absolute -top-2 -right-2 h-5 min-w-[20px] px-1 bg-red-500 text-white text-xs",children:k.unreadConversations})]})}),e.jsx(r,{href:"/admin/analytics",children:e.jsxs(t,{variant:"outline",size:"sm","data-testid":"button-admin-analytics",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Analytics"]})}),e.jsx(r,{href:"/admin/config",children:e.jsxs(t,{variant:"outline",size:"sm","data-testid":"button-admin-config",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Config"]})})]})]})})}),e.jsxs("main",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"max-w-7xl mx-auto mb-8",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(n,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900 rounded-lg",children:e.jsx(y,{className:"h-8 w-8 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Requests"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white","data-testid":"text-total-requests",children:x?"...":m.total})]})]})})}),e.jsx(n,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-yellow-100 dark:bg-yellow-900 rounded-lg",children:e.jsx(E,{className:"h-8 w-8 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Pending"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white","data-testid":"text-pending-requests",children:x?"...":m.pending})]})]})})}),e.jsx(n,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-red-100 dark:bg-red-900 rounded-lg",children:e.jsx(y,{className:"h-8 w-8 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Broadcasting"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white","data-testid":"text-active-requests",children:x?"...":m.active})]})]})})}),e.jsx(n,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900 rounded-lg",children:e.jsx(I,{className:"h-8 w-8 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Completed"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:x?"...":m.completed})]})]})})}),e.jsx(n,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-purple-100 dark:bg-purple-900 rounded-lg",children:e.jsx(ce,{className:"h-8 w-8 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Last 24h"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:x?"...":m.last24Hours})]})]})})})]})}),e.jsx("div",{className:"max-w-7xl mx-auto mb-6",children:e.jsx(n,{children:e.jsxs(d,{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(xe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(G,{placeholder:"Search symptoms, location...",value:N,onChange:s=>H(s.target.value),className:"pl-10","data-testid":"input-search"})]}),e.jsxs(T,{value:v,onValueChange:M,children:[e.jsx(A,{"data-testid":"select-status",children:e.jsx(z,{placeholder:"All Statuses"})}),e.jsxs(L,{children:[e.jsx(l,{value:"all",children:"All Statuses"}),e.jsx(l,{value:"pending",children:"Pending"}),e.jsx(l,{value:"broadcasting",children:"Broadcasting"}),e.jsx(l,{value:"completed",children:"Completed"}),e.jsx(l,{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs(T,{value:w,onValueChange:B,children:[e.jsx(A,{"data-testid":"select-region",children:e.jsx(z,{placeholder:"All Regions"})}),e.jsxs(L,{children:[e.jsx(l,{value:"all",children:"All Regions"}),o==null?void 0:o.map(s=>e.jsx(l,{value:s.id,children:s.nameEn},s.id))]})]}),e.jsxs(T,{value:c,onValueChange:D,children:[e.jsx(A,{"data-testid":"select-time",children:e.jsx(z,{placeholder:"All Time"})}),e.jsxs(L,{children:[e.jsx(l,{value:"all",children:"All Time"}),e.jsx(l,{value:"1h",children:"Last Hour"}),e.jsx(l,{value:"24h",children:"Last 24 Hours"}),e.jsx(l,{value:"7d",children:"Last 7 Days"})]})]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{children:["Showing ",C.length," of ",m.total," requests"]}),(N||v!=="all"||w!=="all"||c!=="all")&&e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>{H(""),M("all"),B("all"),D("all")},children:"Clear Filters"})]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs(n,{children:[e.jsx(J,{children:e.jsx(O,{children:"Emergency Requests"})}),e.jsx(d,{children:x?e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((s,i)=>e.jsx(q,{className:"h-16 w-full"},i))}):C.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(y,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No emergency requests found"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs($,{children:[e.jsx(Y,{children:e.jsxs(F,{children:[e.jsx(h,{children:"Created"}),e.jsx(h,{children:"Status"}),e.jsx(h,{children:"Symptom"}),e.jsx(h,{children:"Region"}),e.jsx(h,{children:"Location"}),e.jsx(h,{children:"Contact"})]})}),e.jsx(Z,{children:C.map(s=>e.jsxs(F,{"data-testid":`row-request-${s.id}`,children:[e.jsx(j,{className:"font-medium whitespace-nowrap",children:me(new Date(s.createdAt),"MMM d, HH:mm")}),e.jsx(j,{children:Q(s.status)}),e.jsx(j,{className:"max-w-xs truncate",children:s.symptom||"N/A"}),e.jsx(j,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(W,{className:"h-3 w-3 text-gray-400"}),V(s.regionId)]})}),e.jsx(j,{className:"max-w-xs truncate",children:s.manualLocation||"GPS Only"}),e.jsx(j,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(X,{className:"h-3 w-3 text-gray-400"}),s.contactPhone||"N/A"]})})]},s.id))})]})})})]})})]})]})}export{Me as default};
