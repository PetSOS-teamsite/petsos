import{e as he,u as me,a as je,r as P,h as E,g as ue,ah as pe,j as e,X as w,C as l,v as y,w as S,d as M,y as $,S as ge,B as p,b as j,M as ve,b1 as C,R as U,_ as fe,J as H,K as z,N as O,O as Z,P as g,$ as Ne,a0 as be,a1 as we,a2 as ye,a3 as Se,F as Ce,z as d,A as o,D as x,E as h,I as k,G as u,H as ke,a4 as _e,s as D,T as L,U as B}from"./index-yGPiJpIr.js";import{u as Y}from"./useMutation-g6oReyS0.js";import{B as K}from"./badge-4zSkoC7y.js";import{S as J}from"./switch-BdZ2xI1R.js";import{S as V}from"./skeleton-DdmbE3wx.js";import{T as R}from"./textarea-B-COFCfx.js";import{d as Fe}from"./schema-DZGTqc0-.js";import{B as De}from"./building-2-Bk6ymILd.js";import{P as Ae}from"./pencil-TrFe8HXS.js";import{M as X}from"./message-square-BEUah6ir.js";import{M as Te}from"./mail-CLLlllUf.js";import{G as Ie}from"./globe-CpIG6KpI.js";import{C as Pe}from"./circle-check-D4zmYIzY.js";const Ee=Fe.extend({name:D().min(1,"Clinic name is required"),address:D().min(1,"Address is required"),phone:D().min(1,"Phone number is required"),regionId:D().min(1,"Region is required")});function Ue(){var W;const{user:a}=he(),{t:i}=me(),{toast:v}=je(),[q,_]=P.useState(!1),[A,ee]=P.useState("all"),[F,se]=P.useState("newest"),{data:t,isLoading:ie}=E({queryKey:[`/api/clinics/${a==null?void 0:a.clinicId}`],enabled:!!(a!=null&&a.clinicId)}),{data:f,isLoading:te}=E({queryKey:["/api/regions"]}),{data:n,isLoading:ae}=E({queryKey:[`/api/clinics/${a==null?void 0:a.clinicId}/emergency-requests`],enabled:!!(a!=null&&a.clinicId)}),T=(()=>{if(!n)return[];let s=[...n];return A==="pending"?s=s.filter(r=>r.status==="pending"):A==="critical"&&(s=s.filter(r=>r.severity==="critical")),F==="newest"?s.sort((r,m)=>new Date(m.createdAt).getTime()-new Date(r.createdAt).getTime()):F==="oldest"?s.sort((r,m)=>new Date(r.createdAt).getTime()-new Date(m.createdAt).getTime()):F==="severity"&&s.sort((r,m)=>{const G={critical:0,urgent:1,moderate:2};return(G[r.severity]||999)-(G[m.severity]||999)}),s})(),N=new Date,ne=new Date(N.getFullYear(),N.getMonth(),N.getDate()),re=new Date(N.getTime()-7*24*60*60*1e3),ce=new Date(N.getFullYear(),N.getMonth(),1),b={today:(n==null?void 0:n.filter(s=>new Date(s.createdAt)>=ne).length)??0,thisWeek:(n==null?void 0:n.filter(s=>new Date(s.createdAt)>=re).length)??0,thisMonth:(n==null?void 0:n.filter(s=>new Date(s.createdAt)>=ce).length)??0,pending:(n==null?void 0:n.filter(s=>s.status==="pending").length)??0,critical:(n==null?void 0:n.filter(s=>s.severity==="critical").length)??0},Q=Y({mutationFn:async s=>{if(t!=null&&t.id)return L("PATCH",`/api/clinics/${t.id}`,{isAvailable:s})},onSuccess:()=>{B.invalidateQueries({queryKey:[`/api/clinics/${a==null?void 0:a.clinicId}`]}),v({title:i("success"),description:i("clinic.availability_updated")})},onError:()=>{v({title:i("error"),description:i("error_occurred"),variant:"destructive"})}}),I=Y({mutationFn:async s=>L("PATCH",`/api/emergency-requests/${s}`,{status:"responded"}),onSuccess:()=>{B.invalidateQueries({queryKey:[`/api/clinics/${a==null?void 0:a.clinicId}/emergency-requests`]}),v({title:"Success",description:"Request marked as responded"})},onError:()=>{v({title:"Error",description:"Failed to update request status",variant:"destructive"})}}),c=ue({resolver:pe(Ee),defaultValues:t?{name:t.name,nameZh:t.nameZh,address:t.address,addressZh:t.addressZh,phone:t.phone,whatsapp:t.whatsapp,email:t.email,regionId:t.regionId,is24Hour:t.is24Hour,isAvailable:t.isAvailable,latitude:t.latitude,longitude:t.longitude,status:t.status,services:t.services}:void 0}),le=async s=>{try{if(!(t!=null&&t.id))return;await L("PATCH",`/api/clinics/${t.id}`,s),await B.invalidateQueries({queryKey:[`/api/clinics/${a==null?void 0:a.clinicId}`]}),_(!1),v({title:i("success"),description:i("clinic.updated_successfully")})}catch{v({title:i("error"),description:i("error_occurred"),variant:"destructive"})}},de=s=>{Q.mutate(s)},oe=()=>{t&&(c.reset({name:t.name,nameZh:t.nameZh,address:t.address,addressZh:t.addressZh,phone:t.phone,whatsapp:t.whatsapp,email:t.email,regionId:t.regionId,is24Hour:t.is24Hour,isAvailable:t.isAvailable,latitude:t.latitude,longitude:t.longitude,status:t.status,services:t.services}),_(!0))};if(!(a!=null&&a.clinicId))return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"sticky top-0 z-50 border-b bg-[#EF4444] text-white shadow-sm",children:e.jsx("div",{className:"container mx-auto flex h-16 items-center justify-between px-4",children:e.jsx(w,{href:"/",children:e.jsx("h1",{className:"text-2xl font-bold cursor-pointer","data-testid":"text-logo",children:"PetSOS"})})})}),e.jsx("div",{className:"container mx-auto py-12 px-4",children:e.jsx(l,{children:e.jsxs(y,{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-6 w-6"}),i("clinic.not_linked")]}),e.jsx($,{children:i("clinic.contact_admin")})]})})})]});if(ie||te)return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"sticky top-0 z-50 border-b bg-[#EF4444] text-white shadow-sm",children:e.jsx("div",{className:"container mx-auto flex h-16 items-center justify-between px-4",children:e.jsx(w,{href:"/",children:e.jsx("h1",{className:"text-2xl font-bold cursor-pointer","data-testid":"text-logo",children:"PetSOS"})})})}),e.jsxs("div",{className:"container mx-auto py-8 px-4 space-y-6",children:[e.jsx(V,{className:"h-10 w-64"}),e.jsx(V,{className:"h-96"})]})]});if(!t)return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"sticky top-0 z-50 border-b bg-[#EF4444] text-white shadow-sm",children:e.jsx("div",{className:"container mx-auto flex h-16 items-center justify-between px-4",children:e.jsx(w,{href:"/",children:e.jsx("h1",{className:"text-2xl font-bold cursor-pointer","data-testid":"text-logo",children:"PetSOS"})})})}),e.jsx("div",{className:"container mx-auto py-12 px-4",children:e.jsx(l,{children:e.jsx(y,{children:e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-6 w-6"}),i("clinic.not_found")]})})})})]});const xe=((W=f==null?void 0:f.find(s=>s.id===t.regionId))==null?void 0:W.nameEn)||"Unknown";return e.jsxs(e.Fragment,{children:[e.jsx(ge,{noindex:!0}),e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"sticky top-0 z-50 border-b bg-[#EF4444] text-white shadow-sm",children:e.jsxs("div",{className:"container mx-auto flex h-16 items-center justify-between px-4",children:[e.jsx(w,{href:"/",children:e.jsx("h1",{className:"text-2xl font-bold cursor-pointer","data-testid":"text-logo",children:"PetSOS"})}),e.jsx(w,{href:"/profile",children:e.jsx(p,{variant:"ghost",className:"text-white hover:bg-red-600","data-testid":"link-profile",children:i("nav.profile")})})]})}),e.jsxs("div",{className:"container mx-auto py-8 px-4 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2","data-testid":"text-dashboard-title",children:[e.jsx(De,{className:"h-8 w-8"}),i("clinic.dashboard")]}),e.jsx("p",{className:"text-muted-foreground mt-1","data-testid":"text-clinic-name",children:t.name})]}),e.jsxs(p,{onClick:oe,"data-testid":"button-edit-clinic",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),i("clinic.edit_details")]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(l,{children:[e.jsx(y,{children:e.jsx(S,{children:i("clinic.information")})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ve,{className:"h-5 w-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:i("clinic.address")}),e.jsx("p",{className:"text-sm text-muted-foreground","data-testid":"text-clinic-address",children:t.address})]})]}),e.jsx(C,{}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:i("clinic.phone")}),e.jsx("p",{className:"text-sm text-muted-foreground","data-testid":"text-clinic-phone",children:t.phone})]})]}),t.whatsapp&&e.jsxs(e.Fragment,{children:[e.jsx(C,{}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:i("clinic.whatsapp")}),e.jsx("p",{className:"text-sm text-muted-foreground","data-testid":"text-clinic-whatsapp",children:t.whatsapp})]})]})]}),t.email&&e.jsxs(e.Fragment,{children:[e.jsx(C,{}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:i("clinic.email")}),e.jsx("p",{className:"text-sm text-muted-foreground","data-testid":"text-clinic-email",children:t.email})]})]})]}),e.jsx(C,{}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:i("clinic.region")}),e.jsx("p",{className:"text-sm text-muted-foreground","data-testid":"text-clinic-region",children:xe})]})]}),e.jsx(C,{}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:i("clinic.hours")}),e.jsx(K,{variant:t.is24Hour?"default":"secondary","data-testid":"badge-24hour",children:t.is24Hour?i("clinic.24_hour"):i("clinic.regular_hours")})]})]})]})]}),e.jsxs(l,{children:[e.jsxs(y,{children:[e.jsx(S,{children:i("clinic.availability_status")}),e.jsx($,{children:i("clinic.availability_description")})]}),e.jsxs(j,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:i("clinic.currently_available")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.isAvailable?i("clinic.accepting_emergencies"):i("clinic.not_accepting")})]}),e.jsx(J,{checked:t.isAvailable,onCheckedChange:de,disabled:Q.isPending,"data-testid":"switch-availability"})]}),e.jsx("div",{className:"p-4 bg-muted rounded-lg",children:e.jsxs("p",{className:"text-sm",children:[e.jsxs("strong",{children:[i("clinic.note"),":"]})," ",i("clinic.availability_note")]})})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-5",children:[e.jsx(l,{children:e.jsxs(j,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:b.today}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Today"})]})}),e.jsx(l,{children:e.jsxs(j,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:b.thisWeek}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This Week"})]})}),e.jsx(l,{children:e.jsxs(j,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:b.thisMonth}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This Month"})]})}),e.jsx(l,{children:e.jsxs(j,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:b.pending}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pending"})]})}),e.jsx(l,{children:e.jsxs(j,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:b.critical}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Critical"})]})})]}),e.jsxs(l,{children:[e.jsx(y,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(S,{children:i("clinic.emergency_requests")}),e.jsx($,{children:i("clinic.recent_broadcasts")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(H,{value:A,onValueChange:ee,children:[e.jsx(z,{className:"w-32","data-testid":"select-filter",children:e.jsx(O,{})}),e.jsxs(Z,{children:[e.jsx(g,{value:"all",children:"All"}),e.jsx(g,{value:"pending",children:"Pending"}),e.jsx(g,{value:"critical",children:"Critical"})]})]}),e.jsxs(H,{value:F,onValueChange:se,children:[e.jsx(z,{className:"w-32","data-testid":"select-sort",children:e.jsx(O,{})}),e.jsxs(Z,{children:[e.jsx(g,{value:"newest",children:"Newest"}),e.jsx(g,{value:"oldest",children:"Oldest"}),e.jsx(g,{value:"severity",children:"Severity"})]})]})]})]})}),e.jsx(j,{children:ae?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(s=>e.jsx(V,{className:"h-24"},s))}):T&&T.length>0?e.jsx("div",{className:"space-y-4",children:T.map(s=>{var r,m;return e.jsxs("div",{className:"border rounded-lg p-4 space-y-2","data-testid":`request-${s.id}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{variant:s.severity==="critical"?"destructive":"default",children:s.severity}),e.jsx(K,{variant:"outline",children:s.status})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(s.createdAt).toLocaleString()})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[i("clinic.pet"),": ",((r=s.pet)==null?void 0:r.name)||"Unknown"," (",(m=s.pet)==null?void 0:m.species,")"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[i("clinic.symptom"),": ",s.symptom]})]}),s.user&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{children:[i("clinic.owner"),": ",s.user.name]}),s.user.phone&&e.jsxs("p",{className:"text-muted-foreground",children:[i("clinic.contact"),": ",s.user.phone]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[s.user.phone&&e.jsxs(e.Fragment,{children:[e.jsx(p,{size:"sm",variant:"outline",asChild:!0,"data-testid":`button-call-${s.id}`,children:e.jsxs("a",{href:`tel:${s.user.phone}`,children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Call Now"]})}),e.jsx(p,{size:"sm",variant:"outline",className:"bg-green-50 hover:bg-green-100 dark:bg-green-950 dark:hover:bg-green-900 border-green-300 dark:border-green-800",asChild:!0,"data-testid":`button-whatsapp-${s.id}`,children:e.jsxs("a",{href:`https://wa.me/${s.user.phone.replace(/[^0-9]/g,"")}`,target:"_blank",rel:"noopener noreferrer",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"WhatsApp"]})})]}),s.status==="pending"&&e.jsxs(p,{size:"sm",variant:"default",className:"bg-red-600 hover:bg-red-700",onClick:()=>I.mutate(s.id),disabled:I.isPending,"data-testid":`button-respond-${s.id}`,children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),I.isPending?"Marking...":"Mark as Responded"]})]})]})]},s.id)})}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(M,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{"data-testid":"text-no-requests",children:i("clinic.no_requests")})]})})]})]}),e.jsx(Ne,{open:q,onOpenChange:_,children:e.jsxs(be,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(we,{children:[e.jsx(ye,{children:i("clinic.edit_details")}),e.jsx(Se,{children:i("clinic.edit_description")})]}),e.jsx(Ce,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(le),className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(d,{control:c.control,name:"name",render:({field:s})=>e.jsxs(o,{children:[e.jsx(x,{children:i("clinic.name_en")}),e.jsx(h,{children:e.jsx(k,{...s,"data-testid":"input-clinic-name"})}),e.jsx(u,{})]})}),e.jsx(d,{control:c.control,name:"nameZh",render:({field:s})=>e.jsxs(o,{children:[e.jsx(x,{children:i("clinic.name_zh")}),e.jsx(h,{children:e.jsx(k,{...s,value:s.value||"","data-testid":"input-clinic-name-zh"})}),e.jsx(u,{})]})})]}),e.jsx(d,{control:c.control,name:"address",render:({field:s})=>e.jsxs(o,{children:[e.jsx(x,{children:i("clinic.address_en")}),e.jsx(h,{children:e.jsx(R,{...s,"data-testid":"input-clinic-address"})}),e.jsx(u,{})]})}),e.jsx(d,{control:c.control,name:"addressZh",render:({field:s})=>e.jsxs(o,{children:[e.jsx(x,{children:i("clinic.address_zh")}),e.jsx(h,{children:e.jsx(R,{...s,value:s.value||"","data-testid":"input-clinic-address-zh"})}),e.jsx(u,{})]})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(d,{control:c.control,name:"phone",render:({field:s})=>e.jsxs(o,{children:[e.jsx(x,{children:i("clinic.phone")}),e.jsx(h,{children:e.jsx(k,{...s,"data-testid":"input-clinic-phone"})}),e.jsx(u,{})]})}),e.jsx(d,{control:c.control,name:"whatsapp",render:({field:s})=>e.jsxs(o,{children:[e.jsx(x,{children:i("clinic.whatsapp")}),e.jsx(h,{children:e.jsx(k,{...s,value:s.value||"","data-testid":"input-clinic-whatsapp"})}),e.jsx(u,{})]})})]}),e.jsx(d,{control:c.control,name:"email",render:({field:s})=>e.jsxs(o,{children:[e.jsx(x,{children:i("clinic.email")}),e.jsx(h,{children:e.jsx(k,{type:"email",...s,value:s.value||"","data-testid":"input-clinic-email-edit"})}),e.jsx(u,{})]})}),e.jsx(d,{control:c.control,name:"regionId",render:({field:s})=>e.jsxs(o,{children:[e.jsx(x,{children:i("clinic.region")}),e.jsxs(H,{onValueChange:s.onChange,value:s.value,children:[e.jsx(h,{children:e.jsx(z,{"data-testid":"select-clinic-region",children:e.jsx(O,{placeholder:i("clinic.select_region")})})}),e.jsx(Z,{children:f==null?void 0:f.map(r=>e.jsx(g,{value:r.id,children:r.nameEn},r.id))})]}),e.jsx(u,{})]})}),e.jsx(d,{control:c.control,name:"is24Hour",render:({field:s})=>e.jsxs(o,{className:"flex items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(x,{className:"text-base",children:i("clinic.24_hour_service")}),e.jsx(ke,{children:i("clinic.24_hour_description")})]}),e.jsx(h,{children:e.jsx(J,{checked:s.value,onCheckedChange:s.onChange,"data-testid":"switch-24hour"})})]})}),e.jsxs(_e,{children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>_(!1),"data-testid":"button-cancel-edit",children:i("cancel")}),e.jsx(p,{type:"submit",disabled:c.formState.isSubmitting,"data-testid":"button-save-clinic",children:c.formState.isSubmitting?i("saving"):i("save_changes")})]})]})})]})})]})]})}export{Ue as default};
