import{r as y,h as D,j as e,_ as i,B as r,C as n,b as d,d as b,a0 as M,I as Q,a1 as C,a2 as S,a3 as T,a4 as A,a5 as t,q as R,t as _,M as G,E as O,H as X}from"./index-DSfXJrMH.js";import{T as $,a as J,b as E,c as h,d as W,e as j}from"./table-CgedxRwg.js";import{B as f}from"./badge-i4G4T4_i.js";import{S as Y}from"./skeleton-BXF3w9B7.js";import{A as Z}from"./arrow-left-B5_XZNND.js";import{R as q}from"./refresh-cw-CzSBjnJ2.js";import{U as ee,C as se}from"./users-_l0TR2ob.js";import{H as ae}from"./heart-D__JMG3Q.js";import{B as F}from"./building-2-BvJiZHTX.js";import{S as te}from"./stethoscope-BNqDa_Ro.js";import{S as le}from"./settings-B2fRQzOm.js";import{C as I}from"./circle-check-D_uZXrGr.js";import{S as re}from"./search-qxig8uw6.js";import{C as ie}from"./circle-x-CZneOd2b.js";import{f as ne}from"./format-C75rDloS.js";function be(){const[N,L]=y.useState(""),[v,H]=y.useState("all"),[w,B]=y.useState("all"),[c,z]=y.useState("all"),{data:a,isLoading:x}=D({queryKey:["/api/emergency-requests"],refetchInterval:1e4}),{data:o}=D({queryKey:["/api/regions"]}),m={total:(a==null?void 0:a.length)??0,pending:((a==null?void 0:a.filter(s=>s.status==="pending"))??[]).length,active:((a==null?void 0:a.filter(s=>s.status==="broadcasting"))??[]).length,completed:((a==null?void 0:a.filter(s=>s.status==="completed"))??[]).length,last24Hours:((a==null?void 0:a.filter(s=>{const l=new Date(s.createdAt);return new Date().getTime()-l.getTime()<24*60*60*1e3}))??[]).length},k=(a==null?void 0:a.filter(s=>{var l,g;if(N){const u=N.toLowerCase(),P=(l=s.symptom)==null?void 0:l.toLowerCase().includes(u),p=(g=s.manualLocation)==null?void 0:g.toLowerCase().includes(u);if(!P&&!p)return!1}if(v!=="all"&&s.status!==v||w!=="all"&&s.regionId!==w)return!1;if(c!=="all"){const u=new Date(s.createdAt),p=new Date().getTime()-u.getTime();if(c==="1h"&&p>60*60*1e3||c==="24h"&&p>24*60*60*1e3||c==="7d"&&p>7*24*60*60*1e3)return!1}return!0}))??[],U=()=>{X.invalidateQueries({queryKey:["/api/emergency-requests"]})},V=s=>{switch(s){case"pending":return e.jsxs(f,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",children:[e.jsx(M,{className:"h-3 w-3 mr-1"}),"Pending"]});case"broadcasting":return e.jsxs(f,{variant:"secondary",className:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",children:[e.jsx(b,{className:"h-3 w-3 mr-1"}),"Broadcasting"]});case"completed":return e.jsxs(f,{variant:"secondary",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[e.jsx(I,{className:"h-3 w-3 mr-1"}),"Completed"]});case"cancelled":return e.jsxs(f,{variant:"secondary",className:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200",children:[e.jsx(ie,{className:"h-3 w-3 mr-1"}),"Cancelled"]});default:return e.jsx(f,{variant:"outline",children:s})}},K=s=>{if(!s)return"Unknown";const l=o==null?void 0:o.find(g=>g.id===s);return l?l.nameEn:s};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-white to-gray-50 dark:from-gray-900 dark:to-gray-800",children:[e.jsx("header",{className:"border-b border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 sticky top-0 z-10",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(i,{href:"/",children:e.jsx(r,{variant:"ghost",size:"icon","data-testid":"button-back",children:e.jsx(Z,{className:"h-5 w-5"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Admin: Emergency Queue"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Monitor and manage active emergency requests"})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(r,{onClick:U,variant:"outline",size:"sm","data-testid":"button-refresh",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsx(i,{href:"/admin/users",children:e.jsxs(r,{variant:"outline",size:"sm","data-testid":"button-admin-users",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Users"]})}),e.jsx(i,{href:"/admin/pets",children:e.jsxs(r,{variant:"outline",size:"sm","data-testid":"button-admin-pets",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Pets"]})}),e.jsx(i,{href:"/admin/clinics",children:e.jsxs(r,{variant:"outline",size:"sm","data-testid":"button-admin-clinics",children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Clinics"]})}),e.jsx(i,{href:"/admin/hospitals",children:e.jsxs(r,{variant:"outline",size:"sm","data-testid":"button-admin-hospitals",children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Hospitals"]})}),e.jsx(i,{href:"/admin/diagnostics",children:e.jsxs(r,{variant:"outline",size:"sm","data-testid":"button-admin-diagnostics",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Diagnostics"]})}),e.jsx(i,{href:"/admin/config",children:e.jsxs(r,{variant:"outline",size:"sm","data-testid":"button-admin-config",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Config"]})})]})]})})}),e.jsxs("main",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"max-w-7xl mx-auto mb-8",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(n,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900 rounded-lg",children:e.jsx(b,{className:"h-8 w-8 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Requests"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white","data-testid":"text-total-requests",children:x?"...":m.total})]})]})})}),e.jsx(n,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-yellow-100 dark:bg-yellow-900 rounded-lg",children:e.jsx(M,{className:"h-8 w-8 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Pending"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white","data-testid":"text-pending-requests",children:x?"...":m.pending})]})]})})}),e.jsx(n,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-red-100 dark:bg-red-900 rounded-lg",children:e.jsx(b,{className:"h-8 w-8 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Broadcasting"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white","data-testid":"text-active-requests",children:x?"...":m.active})]})]})})}),e.jsx(n,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900 rounded-lg",children:e.jsx(I,{className:"h-8 w-8 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Completed"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:x?"...":m.completed})]})]})})}),e.jsx(n,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-purple-100 dark:bg-purple-900 rounded-lg",children:e.jsx(se,{className:"h-8 w-8 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Last 24h"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:x?"...":m.last24Hours})]})]})})})]})}),e.jsx("div",{className:"max-w-7xl mx-auto mb-6",children:e.jsx(n,{children:e.jsxs(d,{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(Q,{placeholder:"Search symptoms, location...",value:N,onChange:s=>L(s.target.value),className:"pl-10","data-testid":"input-search"})]}),e.jsxs(C,{value:v,onValueChange:H,children:[e.jsx(S,{"data-testid":"select-status",children:e.jsx(T,{placeholder:"All Statuses"})}),e.jsxs(A,{children:[e.jsx(t,{value:"all",children:"All Statuses"}),e.jsx(t,{value:"pending",children:"Pending"}),e.jsx(t,{value:"broadcasting",children:"Broadcasting"}),e.jsx(t,{value:"completed",children:"Completed"}),e.jsx(t,{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs(C,{value:w,onValueChange:B,children:[e.jsx(S,{"data-testid":"select-region",children:e.jsx(T,{placeholder:"All Regions"})}),e.jsxs(A,{children:[e.jsx(t,{value:"all",children:"All Regions"}),o==null?void 0:o.map(s=>e.jsx(t,{value:s.id,children:s.nameEn},s.id))]})]}),e.jsxs(C,{value:c,onValueChange:z,children:[e.jsx(S,{"data-testid":"select-time",children:e.jsx(T,{placeholder:"All Time"})}),e.jsxs(A,{children:[e.jsx(t,{value:"all",children:"All Time"}),e.jsx(t,{value:"1h",children:"Last Hour"}),e.jsx(t,{value:"24h",children:"Last 24 Hours"}),e.jsx(t,{value:"7d",children:"Last 7 Days"})]})]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{children:["Showing ",k.length," of ",m.total," requests"]}),(N||v!=="all"||w!=="all"||c!=="all")&&e.jsx(r,{variant:"ghost",size:"sm",onClick:()=>{L(""),H("all"),B("all"),z("all")},children:"Clear Filters"})]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs(n,{children:[e.jsx(R,{children:e.jsx(_,{children:"Emergency Requests"})}),e.jsx(d,{children:x?e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((s,l)=>e.jsx(Y,{className:"h-16 w-full"},l))}):k.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(b,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No emergency requests found"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs($,{children:[e.jsx(J,{children:e.jsxs(E,{children:[e.jsx(h,{children:"Created"}),e.jsx(h,{children:"Status"}),e.jsx(h,{children:"Symptom"}),e.jsx(h,{children:"Region"}),e.jsx(h,{children:"Location"}),e.jsx(h,{children:"Contact"})]})}),e.jsx(W,{children:k.map(s=>e.jsxs(E,{"data-testid":`row-request-${s.id}`,children:[e.jsx(j,{className:"font-medium whitespace-nowrap",children:ne(new Date(s.createdAt),"MMM d, HH:mm")}),e.jsx(j,{children:V(s.status)}),e.jsx(j,{className:"max-w-xs truncate",children:s.symptom||"N/A"}),e.jsx(j,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"h-3 w-3 text-gray-400"}),K(s.regionId)]})}),e.jsx(j,{className:"max-w-xs truncate",children:s.manualLocation||"GPS Only"}),e.jsx(j,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(O,{className:"h-3 w-3 text-gray-400"}),s.contactPhone||"N/A"]})})]},s.id))})]})})})]})})]})]})}export{be as default};
