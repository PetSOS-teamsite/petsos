import{a as Q,r as v,h as V,j as e,S as U,X as Y,B as o,a5 as C,$ as P,am as D,a0 as O,a1 as B,a2 as E,a3 as H,a4 as X,C as m,v as x,y as j,w as h,I as _,b as G,aL as J,aM as ee,aN as g,b8 as te,_ as se,T as I,U as L}from"./index-yGPiJpIr.js";import{u as F}from"./useMutation-g6oReyS0.js";import{B as f}from"./badge-4zSkoC7y.js";import{T as ne,a as ae,b as y,c as u,d as ie,e as l}from"./table-B-k4FnaN.js";import{S as A}from"./skeleton-DdmbE3wx.js";import{S as M}from"./scroll-area-DcyMsPXe.js";import{A as re}from"./arrow-left-BVTF3Tl5.js";import{S}from"./send-C40fC5Tu.js";import{B as de}from"./building-2-Bk6ymILd.js";import{S as le}from"./search-DPDD1EGd.js";import{M as ce}from"./message-square-BEUah6ir.js";import{C as oe}from"./circle-check-D4zmYIzY.js";import{f as W}from"./formatDistanceToNow-3UBXKcFR.js";import"./en-US-wfBU2YNu.js";function me(s){return s.lastConfirmedAt?e.jsxs(f,{className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100","data-testid":`status-confirmed-${s.id}`,children:[e.jsx(oe,{className:"h-3 w-3 mr-1"}),"Confirmed"]}):e.jsxs(f,{className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-100","data-testid":`status-pending-${s.id}`,children:[e.jsx(se,{className:"h-3 w-3 mr-1"}),"Pending"]})}function xe(s){return!s.whatsapp&&!s.phone?e.jsx(f,{variant:"outline",className:"text-gray-500","data-testid":`invite-no-phone-${s.id}`,children:"No Phone"}):s.inviteSentAt?e.jsxs(f,{className:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100","data-testid":`invite-sent-${s.id}`,children:[e.jsx(S,{className:"h-3 w-3 mr-1"}),"Sent ",W(new Date(s.inviteSentAt),{addSuffix:!0})]}):e.jsx(f,{variant:"outline","data-testid":`invite-not-sent-${s.id}`,children:"Ready to Send"})}function he(s){const i=s.nameEn||s.nameZh||"Hospital",p=`https://petsos.site/hospital/edit/${s.slug}`,r=s.verificationCode||"[Will be generated on send]";return`ðŸ¥ PetSOS Hospital Information Update

Dear ${i},

We are launching PetSOS, a non-profit pet emergency platform connecting pet owners with 24-hour veterinary clinics in Hong Kong.

Your clinic is listed on our platform. Please verify your information:

ðŸ‘‰ ${p}
ðŸ“‹ Verification Code: ${r}

This code expires in 72 hours.

Thank you,
PetSOS Team

---

ðŸ¥ PetSOS é†«é™¢è³‡æ–™æ›´æ–°

${s.nameZh||i} æ‚¨å¥½ï¼Œ

æˆ‘å€‘æ­£æŽ¨å‡º PetSOSï¼Œä¸€å€‹é€£çµå¯µç‰©ä¸»äººèˆ‡é¦™æ¸¯24å°æ™‚ç¸é†«è¨ºæ‰€çš„éžç‡Ÿåˆ©å¯µç‰©æ€¥ç—‡å¹³å°ã€‚

æ‚¨çš„è¨ºæ‰€å·²åˆ—æ–¼æˆ‘å€‘å¹³å°ã€‚è«‹é©—è­‰æ‚¨çš„è³‡æ–™ï¼š

ðŸ‘‰ ${p}
ðŸ“‹ é©—è­‰ç¢¼ï¼š${r}

æ­¤é©—è­‰ç¢¼å°‡æ–¼72å°æ™‚å¾Œå¤±æ•ˆã€‚

è¬è¬ï¼Œ
PetSOS åœ˜éšŠ`}function $e(){const{toast:s}=Q(),[i,p]=v.useState("all"),[r,q]=v.useState(""),[ue,R]=v.useState(null),[Z,N]=v.useState(!1),{data:n,isLoading:K,refetch:z}=V({queryKey:["/api/admin/hospitals/outreach-status"]}),b=F({mutationFn:async t=>(await I("POST",`/api/admin/hospitals/send-invite/${t}`)).json(),onSuccess:t=>{s({title:"Invitation Sent",description:`WhatsApp invitation sent to ${t.hospital}`}),L.invalidateQueries({queryKey:["/api/admin/hospitals/outreach-status"]})},onError:t=>{s({title:"Failed to Send",description:t.message||"Could not send WhatsApp invitation",variant:"destructive"})}}),w=F({mutationFn:async()=>(await I("POST","/api/admin/hospitals/send-all-invites")).json(),onSuccess:t=>{s({title:"Bulk Send Complete",description:`Sent ${t.sent} invitations, ${t.failed} failed`}),N(!1),L.invalidateQueries({queryKey:["/api/admin/hospitals/outreach-status"]})},onError:t=>{s({title:"Bulk Send Failed",description:t.message||"Could not send bulk invitations",variant:"destructive"})}}),c=n==null?void 0:n.filter(t=>{var T,k,$;const d=!r||((T=t.nameEn)==null?void 0:T.toLowerCase().includes(r.toLowerCase()))||((k=t.nameZh)==null?void 0:k.includes(r))||(($=t.verificationCode)==null?void 0:$.toLowerCase().includes(r.toLowerCase()));return i==="all"?d:i==="confirmed"?d&&t.lastConfirmedAt:i==="pending"?d&&!t.lastConfirmedAt:i==="sent"?d&&t.inviteSentAt:i==="not-sent"?d&&!t.inviteSentAt&&(t.whatsapp||t.phone):d}),a={total:(n==null?void 0:n.length)||0,confirmed:(n==null?void 0:n.filter(t=>t.lastConfirmedAt).length)||0,pending:(n==null?void 0:n.filter(t=>!t.lastConfirmedAt).length)||0,sent:(n==null?void 0:n.filter(t=>t.inviteSentAt).length)||0,canSend:(n==null?void 0:n.filter(t=>!t.inviteSentAt&&(t.whatsapp||t.phone)&&!t.lastConfirmedAt).length)||0};return K?e.jsxs("div",{className:"container mx-auto py-8 px-4",children:[e.jsx(A,{className:"h-8 w-64 mb-6"}),e.jsx("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[1,2,3,4].map(t=>e.jsx(A,{className:"h-24"},t))}),e.jsx(A,{className:"h-96"})]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{noindex:!0}),e.jsxs("div",{className:"container mx-auto py-8 px-4","data-testid":"admin-hospital-outreach-page",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(Y,{href:"/admin/hospitals",className:"inline-flex items-center text-sm text-muted-foreground hover:text-foreground mb-4",children:[e.jsx(re,{className:"h-4 w-4 mr-1"}),"Back to Hospitals"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold","data-testid":"page-title",children:"Hospital Outreach"}),e.jsx("p",{className:"text-muted-foreground",children:"Send WhatsApp invitations to hospitals to verify their information"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{variant:"outline",onClick:()=>z(),"data-testid":"button-refresh",children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsxs(P,{open:Z,onOpenChange:N,children:[e.jsx(D,{asChild:!0,children:e.jsxs(o,{disabled:a.canSend===0,"data-testid":"button-send-all",children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Send to All Pending (",a.canSend,")"]})}),e.jsxs(O,{children:[e.jsxs(B,{children:[e.jsx(E,{children:"Confirm Bulk Send"}),e.jsxs(H,{children:["You are about to send WhatsApp invitations to ",a.canSend," hospitals that have not yet confirmed their information and have not received an invitation."]})]}),e.jsx("div",{className:"py-4",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"This action will send bilingual (English + Chinese) WhatsApp messages to each hospital with their unique access code and instructions to update their information."})}),e.jsxs(X,{children:[e.jsx(o,{variant:"outline",onClick:()=>N(!1),"data-testid":"button-cancel-bulk",children:"Cancel"}),e.jsx(o,{onClick:()=>w.mutate(),disabled:w.isPending,"data-testid":"button-confirm-bulk",children:w.isPending?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"h-4 w-4 mr-2 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Send to All"]})})]})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-6",children:[e.jsx(m,{children:e.jsxs(x,{className:"pb-2",children:[e.jsx(j,{children:"Total Hospitals"}),e.jsx(h,{className:"text-2xl","data-testid":"stat-total",children:a.total})]})}),e.jsx(m,{children:e.jsxs(x,{className:"pb-2",children:[e.jsx(j,{children:"Confirmed"}),e.jsx(h,{className:"text-2xl text-green-600","data-testid":"stat-confirmed",children:a.confirmed})]})}),e.jsx(m,{children:e.jsxs(x,{className:"pb-2",children:[e.jsx(j,{children:"Pending"}),e.jsx(h,{className:"text-2xl text-yellow-600","data-testid":"stat-pending",children:a.pending})]})}),e.jsx(m,{children:e.jsxs(x,{className:"pb-2",children:[e.jsx(j,{children:"Invites Sent"}),e.jsx(h,{className:"text-2xl text-blue-600","data-testid":"stat-sent",children:a.sent})]})}),e.jsx(m,{children:e.jsxs(x,{className:"pb-2",children:[e.jsx(j,{children:"Ready to Send"}),e.jsx(h,{className:"text-2xl text-orange-600","data-testid":"stat-can-send",children:a.canSend})]})})]}),e.jsxs(m,{children:[e.jsx(x,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-5 w-5"}),"Hospitals"]}),e.jsxs("div",{className:"relative w-64",children:[e.jsx(le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(_,{placeholder:"Search hospitals...",value:r,onChange:t=>q(t.target.value),className:"pl-10","data-testid":"input-search"})]})]})}),e.jsx(G,{children:e.jsxs(J,{value:i,onValueChange:p,children:[e.jsxs(ee,{className:"mb-4",children:[e.jsxs(g,{value:"all","data-testid":"tab-all",children:["All (",a.total,")"]}),e.jsxs(g,{value:"pending","data-testid":"tab-pending",children:["Pending (",a.pending,")"]}),e.jsxs(g,{value:"confirmed","data-testid":"tab-confirmed",children:["Confirmed (",a.confirmed,")"]}),e.jsxs(g,{value:"sent","data-testid":"tab-sent",children:["Invite Sent (",a.sent,")"]}),e.jsxs(g,{value:"not-sent","data-testid":"tab-not-sent",children:["Not Sent (",a.canSend,")"]})]}),e.jsx(te,{value:i,children:e.jsx(M,{className:"h-[600px]",children:e.jsxs(ne,{children:[e.jsx(ae,{children:e.jsxs(y,{children:[e.jsx(u,{children:"Hospital"}),e.jsx(u,{children:"Verification Code"}),e.jsx(u,{children:"Contact"}),e.jsx(u,{children:"Status"}),e.jsx(u,{children:"Invite Status"}),e.jsx(u,{className:"text-right",children:"Actions"})]})}),e.jsxs(ie,{children:[c==null?void 0:c.map(t=>e.jsxs(y,{"data-testid":`row-hospital-${t.id}`,children:[e.jsx(l,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium","data-testid":`name-en-${t.id}`,children:t.nameEn||"N/A"}),t.nameZh&&e.jsx("div",{className:"text-sm text-muted-foreground","data-testid":`name-zh-${t.id}`,children:t.nameZh})]})}),e.jsx(l,{children:t.verificationCode?e.jsxs("div",{children:[e.jsx("code",{className:"bg-muted px-2 py-1 rounded text-sm","data-testid":`code-${t.id}`,children:t.verificationCode}),t.verificationCodeExpiresAt&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Expires ",W(new Date(t.verificationCodeExpiresAt),{addSuffix:!0})]})]}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"Will generate on send"})}),e.jsx(l,{children:e.jsxs("div",{className:"text-sm",children:[t.whatsapp&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:"h-3 w-3 text-green-600"}),e.jsx("span",{"data-testid":`whatsapp-${t.id}`,children:t.whatsapp})]}),!t.whatsapp&&t.phone&&e.jsx("div",{"data-testid":`phone-${t.id}`,children:t.phone}),!t.whatsapp&&!t.phone&&e.jsx("span",{className:"text-muted-foreground",children:"No contact"})]})}),e.jsx(l,{children:me(t)}),e.jsx(l,{children:xe(t)}),e.jsx(l,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(P,{children:[e.jsx(D,{asChild:!0,children:e.jsx(o,{variant:"outline",size:"sm",onClick:()=>R(t),"data-testid":`button-preview-${t.id}`,children:"Preview"})}),e.jsxs(O,{className:"max-w-2xl",children:[e.jsxs(B,{children:[e.jsx(E,{children:"Message Preview"}),e.jsxs(H,{children:["This is the message that will be sent to ",t.nameEn||t.nameZh]})]}),e.jsx(M,{className:"h-[400px] mt-4",children:e.jsx("pre",{className:"whitespace-pre-wrap text-sm bg-muted p-4 rounded",children:he(t)})})]})]}),e.jsx(o,{size:"sm",onClick:()=>b.mutate(t.id),disabled:!t.whatsapp&&!t.phone||b.isPending,"data-testid":`button-send-${t.id}`,children:b.isPending?e.jsx(C,{className:"h-4 w-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-4 w-4 mr-1"}),"Send"]})})]})})]},t.id)),(c==null?void 0:c.length)===0&&e.jsx(y,{children:e.jsx(l,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No hospitals found matching your criteria"})})]})]})})})]})})]})]})]})}export{$e as default};
