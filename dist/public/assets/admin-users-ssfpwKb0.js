import{r as c,a as ue,h as _,j as e,a3 as k,B as t,C as m,b as j,I as S,E as R,G as q,H as z,J as O,K as l,q as pe,t as fe,N as ve,a6 as $,a7 as I,a8 as V,a9 as G,aa as J,a4 as g,ab as W,Q as B,O as X}from"./index-B6B5-wqG.js";import{u as Y}from"./useMutation-DUKQItlV.js";import{T as Ne,a as ye,b as Z,c as n,d as be,e as d}from"./table-Cr9KXtoW.js";import{B as u}from"./badge-BCk9M62I.js";import{S as we}from"./skeleton-QnbRUKoU.js";import{A as Ce}from"./arrow-left-BpE3PuIj.js";import{R as ke}from"./refresh-cw-Rle-BtDm.js";import{P as Se}from"./paw-print-CXCaKFJL.js";import{B as H}from"./building-2-BRlfl8Dq.js";import{S as Pe}from"./settings-hQnBrW0F.js";import{U as P}from"./users-d7mTDrPY.js";import{S as ee}from"./shield-C0Q1aaSd.js";import{S as Ue}from"./search-DTxsAJDX.js";import{M as De}from"./mail-jQLz4Ma3.js";import{C as Te}from"./calendar-BCAUg3Hi.js";import{S as Ee}from"./square-pen-BtBuq09c.js";import{T as Ae}from"./trash-2-CgsLVNDK.js";import{f as Me}from"./format-CoLFXwEe.js";function Ye(){const[U,ae]=c.useState(""),[D,se]=c.useState("all"),[o,p]=c.useState(1),[te,f]=c.useState(!1),[re,v]=c.useState(!1),[N,y]=c.useState(null),[r,x]=c.useState({name:"",email:"",phone:"",role:"user",languagePreference:"en"}),T=20,{toast:b}=ue(),{data:s,isLoading:ie}=_({queryKey:["/api/admin/users"]}),{data:E}=_({queryKey:["/api/clinics"]}),w={total:(s==null?void 0:s.length)??0,admins:((s==null?void 0:s.filter(a=>a.role==="admin"))??[]).length,clinicStaff:((s==null?void 0:s.filter(a=>a.role==="clinic_staff"))??[]).length,regularUsers:((s==null?void 0:s.filter(a=>a.role==="user"))??[]).length},A=(s==null?void 0:s.filter(a=>{var i,C,Q;if(U){const L=U.toLowerCase(),me=(i=a.name)==null?void 0:i.toLowerCase().includes(L),je=(C=a.email)==null?void 0:C.toLowerCase().includes(L),ge=(Q=a.phone)==null?void 0:Q.toLowerCase().includes(L);if(!me&&!je&&!ge)return!1}return!(D!=="all"&&a.role!==D)}))??[],h=Math.ceil(A.length/T),K=A.slice((o-1)*T,o*T),le=()=>{B.invalidateQueries({queryKey:["/api/admin/users"]})},ne=a=>{y(a),x({name:a.name||"",email:a.email||"",phone:a.phone||"",role:a.role,languagePreference:a.languagePreference||"en"}),f(!0)},de=a=>{y(a),v(!0)},M=Y({mutationFn:({id:a,data:i})=>X("PATCH",`/api/users/${a}`,i),onSuccess:()=>{B.invalidateQueries({queryKey:["/api/admin/users"]}),f(!1),y(null),b({title:"User updated successfully"})},onError:a=>{b({title:"Error updating user",description:a.message||"An error occurred",variant:"destructive"})}}),F=Y({mutationFn:a=>X("DELETE",`/api/users/${a}`),onSuccess:()=>{B.invalidateQueries({queryKey:["/api/admin/users"]}),v(!1),y(null),b({title:"User deleted successfully"})},onError:a=>{b({title:"Error deleting user",description:a.message||"An error occurred",variant:"destructive"})}}),ce=()=>{N&&M.mutate({id:N.id,data:r})},oe=()=>{N&&F.mutate(N.id)},xe=a=>{switch(a){case"admin":return e.jsxs(u,{variant:"destructive",children:[e.jsx(ee,{className:"h-3 w-3 mr-1"}),"Admin"]});case"clinic_staff":return e.jsxs(u,{variant:"secondary",className:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",children:[e.jsx(H,{className:"h-3 w-3 mr-1"}),"Clinic Staff"]});case"user":return e.jsxs(u,{variant:"outline",children:[e.jsx(P,{className:"h-3 w-3 mr-1"}),"User"]});default:return e.jsx(u,{variant:"outline",children:a})}},he=a=>{if(!a)return"N/A";const i=E==null?void 0:E.find(C=>C.id===a);return i?i.name:a};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-white to-gray-50 dark:from-gray-900 dark:to-gray-800",children:[e.jsx("header",{className:"border-b border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 sticky top-0 z-10",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(k,{href:"/admin",children:e.jsx(t,{variant:"ghost",size:"icon","data-testid":"button-back",children:e.jsx(Ce,{className:"h-5 w-5"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"User Management"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Manage pet owner accounts and profiles"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(t,{onClick:le,variant:"outline",size:"sm","data-testid":"button-refresh",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsx(k,{href:"/admin/pets",children:e.jsxs(t,{variant:"outline",size:"sm","data-testid":"button-admin-pets",children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Pets"]})}),e.jsx(k,{href:"/admin/clinics",children:e.jsxs(t,{variant:"outline",size:"sm","data-testid":"button-admin-clinics",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Clinics"]})}),e.jsx(k,{href:"/admin/config",children:e.jsxs(t,{variant:"outline",size:"sm","data-testid":"button-admin-config",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Config"]})})]})]})})}),e.jsxs("main",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"max-w-7xl mx-auto mb-8",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(m,{children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900 rounded-lg",children:e.jsx(P,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white","data-testid":"text-total-users",children:w.total})]})]})})}),e.jsx(m,{children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-red-100 dark:bg-red-900 rounded-lg",children:e.jsx(ee,{className:"h-6 w-6 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Admins"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:w.admins})]})]})})}),e.jsx(m,{children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-purple-100 dark:bg-purple-900 rounded-lg",children:e.jsx(H,{className:"h-6 w-6 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Clinic Staff"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:w.clinicStaff})]})]})})}),e.jsx(m,{children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900 rounded-lg",children:e.jsx(P,{className:"h-6 w-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Pet Owners"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:w.regularUsers})]})]})})})]})}),e.jsx("div",{className:"max-w-7xl mx-auto mb-6",children:e.jsx(m,{children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ue,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(S,{placeholder:"Search by name, email, or phone...",value:U,onChange:a=>{ae(a.target.value),p(1)},className:"pl-10","data-testid":"input-search"})]}),e.jsxs(R,{value:D,onValueChange:a=>{se(a),p(1)},children:[e.jsx(q,{"data-testid":"select-role-filter",children:e.jsx(z,{placeholder:"Filter by role"})}),e.jsxs(O,{children:[e.jsx(l,{value:"all",children:"All Roles"}),e.jsx(l,{value:"user",children:"Pet Owners"}),e.jsx(l,{value:"clinic_staff",children:"Clinic Staff"}),e.jsx(l,{value:"admin",children:"Admins"})]})]})]})})})}),e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs(m,{children:[e.jsx(pe,{children:e.jsxs(fe,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Users (",A.length,")"]}),h>1&&e.jsxs("span",{className:"text-sm font-normal text-gray-600 dark:text-gray-400",children:["Page ",o," of ",h]})]})}),e.jsx(j,{children:ie?e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((a,i)=>e.jsx(we,{className:"h-16 w-full"},i))}):K.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(P,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No users found"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ne,{children:[e.jsx(ye,{children:e.jsxs(Z,{children:[e.jsx(n,{children:"Name"}),e.jsx(n,{children:"Email"}),e.jsx(n,{children:"Phone"}),e.jsx(n,{children:"Role"}),e.jsx(n,{children:"Clinic"}),e.jsx(n,{children:"Language"}),e.jsx(n,{children:"Created"}),e.jsx(n,{className:"text-right",children:"Actions"})]})}),e.jsx(be,{children:K.map(a=>e.jsxs(Z,{"data-testid":`row-user-${a.id}`,children:[e.jsx(d,{className:"font-medium",children:a.name||e.jsx("span",{className:"text-gray-400",children:"No name"})}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-4 w-4 text-gray-400"}),a.email||e.jsx("span",{className:"text-gray-400",children:"No email"})]})}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4 text-gray-400"}),a.phone||e.jsx("span",{className:"text-gray-400",children:"No phone"})]})}),e.jsx(d,{children:xe(a.role)}),e.jsx(d,{className:"text-sm text-gray-600 dark:text-gray-400",children:he(a.clinicId)}),e.jsx(d,{children:e.jsx(u,{variant:"outline",children:a.languagePreference})}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(Te,{className:"h-4 w-4"}),Me(new Date(a.createdAt),"MMM d, yyyy")]})}),e.jsx(d,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>ne(a),"data-testid":`button-edit-${a.id}`,children:e.jsx(Ee,{className:"h-4 w-4"})}),e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>de(a),className:"text-red-600 hover:text-red-700 hover:bg-red-50","data-testid":`button-delete-${a.id}`,children:e.jsx(Ae,{className:"h-4 w-4"})})]})})]},a.id))})]})}),h>1&&e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsx(t,{variant:"outline",onClick:()=>p(a=>Math.max(1,a-1)),disabled:o===1,"data-testid":"button-prev-page",children:"Previous"}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Page ",o," of ",h]}),e.jsx(t,{variant:"outline",onClick:()=>p(a=>Math.min(h,a+1)),disabled:o===h,"data-testid":"button-next-page",children:"Next"})]})]})})]})})]}),e.jsx($,{open:te,onOpenChange:f,children:e.jsxs(I,{"data-testid":"dialog-edit-user",children:[e.jsxs(V,{children:[e.jsx(G,{children:"Edit User"}),e.jsx(J,{children:"Update user information"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"name",children:"Name"}),e.jsx(S,{id:"name",value:r.name,onChange:a=>x({...r,name:a.target.value}),"data-testid":"input-edit-name"})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"email",children:"Email"}),e.jsx(S,{id:"email",type:"email",value:r.email,onChange:a=>x({...r,email:a.target.value}),"data-testid":"input-edit-email"})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"phone",children:"Phone"}),e.jsx(S,{id:"phone",value:r.phone,onChange:a=>x({...r,phone:a.target.value}),"data-testid":"input-edit-phone"})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"role",children:"Role"}),e.jsxs(R,{value:r.role,onValueChange:a=>x({...r,role:a}),children:[e.jsx(q,{"data-testid":"select-edit-role",children:e.jsx(z,{})}),e.jsxs(O,{children:[e.jsx(l,{value:"user",children:"User"}),e.jsx(l,{value:"clinic_staff",children:"Clinic Staff"}),e.jsx(l,{value:"admin",children:"Admin"})]})]})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"language",children:"Language"}),e.jsxs(R,{value:r.languagePreference,onValueChange:a=>x({...r,languagePreference:a}),children:[e.jsx(q,{"data-testid":"select-edit-language",children:e.jsx(z,{})}),e.jsxs(O,{children:[e.jsx(l,{value:"en",children:"English"}),e.jsx(l,{value:"zh-HK",children:"中文"})]})]})]})]}),e.jsxs(W,{children:[e.jsx(t,{variant:"outline",onClick:()=>f(!1),"data-testid":"button-cancel-edit",children:"Cancel"}),e.jsx(t,{onClick:ce,disabled:M.isPending,"data-testid":"button-save-user",children:M.isPending?"Saving...":"Save Changes"})]})]})}),e.jsx($,{open:re,onOpenChange:v,children:e.jsxs(I,{"data-testid":"dialog-delete-user",children:[e.jsxs(V,{children:[e.jsx(G,{children:"Delete User"}),e.jsx(J,{children:"Are you sure you want to delete this user? This action cannot be undone. All associated pets and emergency requests will also be deleted."})]}),e.jsxs(W,{children:[e.jsx(t,{variant:"outline",onClick:()=>v(!1),"data-testid":"button-cancel-delete",children:"Cancel"}),e.jsx(t,{variant:"destructive",onClick:oe,disabled:F.isPending,"data-testid":"button-confirm-delete",children:F.isPending?"Deleting...":"Delete User"})]})]})})]})}export{Ye as default};
